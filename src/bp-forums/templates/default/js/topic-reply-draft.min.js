window.bp=window.bp||{},function(g){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media=bp.Nouveau.Media||{},bp.Nouveau.TopicReplyDraft={start:function(){void 0!==BP_Nouveau.forums.params.bb_current_user_id&&0!==parseInt(BP_Nouveau.forums.params.bb_current_user_id)&&(this.setupGlobals(),this.addListeners())},setupGlobals:function(){var t=g("body"),t=(this.bbp_forum_id=!1,this.bbp_topic_id=!1,this.bbp_reply_to=!1,this.is_bb_theme=t.hasClass("buddyboss-theme"),this.topic_reply_local_interval=!1,this.topic_reply_ajax_interval=!1,this.draft_ajax_request=null,this.is_topic_reply_form_submit=!1,this.draft_content_changed=!1,this.all_draft_data={},this.bp_nouveau_forums_data=void 0!==BP_Nouveau.forums.draft?BP_Nouveau.forums.draft:{},this.topic_reply_draft={object:!1,data_key:!1,data:!1,post_action:"update",is_content_valid:!1},new Event(g("#new-post")));bp.Nouveau.TopicReplyDraft.setupTopicReplyDraftKeys(t),bp.Nouveau.TopicReplyDraft.getTopicReplyDraftData(),bp.Nouveau.TopicReplyDraft.syncTopicReplyDraftData()},addListeners:function(){this.is_bb_theme?(g(document).on("bbp_after_load_topic_form",this.setupOnOpenTopicReplyModal.bind(this)),g(document).on("bbp_after_load_reply_form",this.setupOnOpenTopicReplyModal.bind(this)),g(document).on("bbp_after_load_inline_reply_form",this.setupOnOpenTopicReplyModal.bind(this)),g(document).on("bbp_after_close_topic_reply_form",this.clearOnCloseTopicReplyModal.bind(this))):g(window).on("load",this.setupTopicReplyDraftIntervals.bind(this)),g("body").hasClass("activity")||(window.onbeforeunload=function(t){void 0!==t&&bp.Nouveau.TopicReplyDraft.setupOnReloadWindow()},window.unload=function(t){void 0!==t&&bp.Nouveau.TopicReplyDraft.setupOnReloadWindow()}),g(document).on("click","#new-post #bbp_topic_submit",this.submitTopicReplyDraftForm.bind(this)),g(document).on("click","#new-post #bbp_reply_submit",this.submitTopicReplyDraftForm.bind(this)),g(document).on("click","#new-post .bb_discard_topic_reply_draft",this.discardTopicReplyDraftForm.bind(this))},setupOnOpenTopicReplyModal:function(){bp.Nouveau.TopicReplyDraft.setupTopicReplyDraftKeys(),bp.Nouveau.TopicReplyDraft.getTopicReplyDraftData(),bp.Nouveau.TopicReplyDraft.syncTopicReplyDraftData(),bp.Nouveau.TopicReplyDraft.setupTopicReplyDraftIntervals(),bp.Nouveau.TopicReplyDraft.displayTopicReplyDraft()},setupTopicReplyDraftKeys:function(){0<g("#bbp_forum_id").length?(this.bbp_forum_id=parseInt(g("#bbp_forum_id").val()),this.topic_reply_draft.object="topic",this.topic_reply_draft.data_key="draft_topic",0<this.bbp_forum_id&&(this.topic_reply_draft.data_key="draft_discussion_"+this.bbp_forum_id)):0<g("#bbp_topic_id").length&&(this.bbp_topic_id=parseInt(g("#bbp_topic_id").val()),this.bbp_reply_to=parseInt(g("#bbp_reply_to").val()),this.topic_reply_draft.object="reply",this.topic_reply_draft.data_key="draft_reply",0<this.bbp_topic_id&&0===this.bbp_reply_to?this.topic_reply_draft.data_key="draft_reply_"+this.bbp_topic_id:0<this.bbp_topic_id&&0<this.bbp_reply_to&&(this.topic_reply_draft.data_key="draft_reply_"+this.bbp_topic_id+"_"+this.bbp_reply_to))},getTopicReplyDraftData:function(){var t;return this.topic_reply_draft.data_key&&""===this.topic_reply_draft.data_key||(t=localStorage.getItem(this.topic_reply_draft.data_key),!_.isUndefined(t)&&null!==t&&0<t.length&&(t=JSON.parse(t),this.topic_reply_draft.data=t.data,this.all_draft_data[this.topic_reply_draft.data_key]=t.data)),this.topic_reply_draft},syncTopicReplyDraftData:function(){void 0===this.all_draft_data[this.topic_reply_draft.data_key]&&void 0!==this.bp_nouveau_forums_data&&void 0!==this.bp_nouveau_forums_data[this.topic_reply_draft.data_key]&&(this.topic_reply_draft=this.bp_nouveau_forums_data[this.topic_reply_draft.data_key],this.all_draft_data[this.topic_reply_draft.data_key]=this.bp_nouveau_forums_data[this.topic_reply_draft.data_key].data,localStorage.setItem(this.topic_reply_draft.data_key,JSON.stringify(this.topic_reply_draft)))},setupTopicReplyDraftIntervals:function(){this.is_bb_theme&&g(".bb-modal-box").hasClass("bb-modal-open")?(window.topic_reply_local_interval||(window.topic_reply_local_interval=setInterval(function(){bp.Nouveau.TopicReplyDraft.collectTopicReplyDraftActivity()},3e3)),window.topic_reply_ajax_interval||(window.topic_reply_ajax_interval=setInterval(function(){bp.Nouveau.TopicReplyDraft.postTopicReplyDraft(!1,!1,!1)},2e4))):this.is_bb_theme||(window.topic_reply_local_interval||(window.topic_reply_local_interval=setInterval(function(){bp.Nouveau.TopicReplyDraft.collectTopicReplyDraftActivity()},3e3)),window.topic_reply_ajax_interval)||(window.topic_reply_ajax_interval=setInterval(function(){bp.Nouveau.TopicReplyDraft.postTopicReplyDraft(!1,!1,!1)},2e4))},clearOnCloseTopicReplyModal:function(){bp.Nouveau.Media.reply_topic_display_post="",bp.Nouveau.TopicReplyDraft.is_topic_reply_form_submit||(bp.Nouveau.TopicReplyDraft.collectTopicReplyDraftActivity(),bp.Nouveau.TopicReplyDraft.postTopicReplyDraft(!1,!0,!1)),bp.Nouveau.TopicReplyDraft.clearTopicReplyDraftIntervals(),setTimeout(function(){bp.Nouveau.TopicReplyDraft.resetTopicReplyDraftPostForm()},500),bp.Nouveau.Media.reply_topic_display_post="",bp.Nouveau.TopicReplyDraft.is_topic_reply_form_submit=!1},clearTopicReplyDraftIntervals:function(){clearInterval(window.topic_reply_local_interval),window.topic_reply_local_interval=!1,clearInterval(window.topic_reply_ajax_interval),window.topic_reply_ajax_interval=!1},resetLocalTopicReplyDraft:function(){bp.Nouveau.Media.reply_topic_allow_delete_media=!1,bp.Nouveau.Media.reply_topic_display_post="",bp.Nouveau.TopicReplyDraft.is_topic_reply_form_submit=!0,void 0!==this.all_draft_data[this.topic_reply_draft.data_key]&&delete this.all_draft_data[this.topic_reply_draft.data_key],void 0!==this.bp_nouveau_forums_data[this.topic_reply_draft.data_key]&&delete this.bp_nouveau_forums_data[this.topic_reply_draft.data_key],this.topic_reply_draft.data=!1,localStorage.removeItem(this.topic_reply_draft.data_key),bp.Nouveau.Media.reply_topic_display_post="edit",g("#new-post").removeClass("has-draft has-content has-media has-gif has-link-preview")},resetTopicReplyDraftPostForm:function(){var t,e=g("form#new-post"),i=e.find(".bbp-the-content").data("key"),o=e.find("#forums-post-media-uploader"),a=e.find("#forums-post-document-uploader"),p=e.find("#forums-post-video-uploader"),d=e.find("#whats-new-attachments .forums-attached-gif-container");void 0!==window.MediumEditor?"topic"===this.topic_reply_draft.object?(window.forums_medium_topic_editor&&window.forums_medium_topic_editor[i].setContent(""),(t=e.find("#bbp_editor_topic_content_"+i)).removeClass("error"),e.find("#bbp_topic_content").val(""),e.find("#bbp_topic_title").val(""),e.removeClass("has-title")):"reply"===this.topic_reply_draft.object&&(window.forums_medium_reply_editor&&window.forums_medium_reply_editor[i].setContent(""),(t=e.find("#bbp_editor_reply_content_"+i)).removeClass("error"),t=e.find("#bbp_editor_reply_content_"+i),e.find("#bbp_reply_content").val(""),setTimeout(function(){t.removeClass("error")},300)):(e.find(".bbp-the-content:not(.emojionearea)").empty(),e.find("#bbp_reply_content").val("")),("topic"===this.topic_reply_draft.object&&!g("#subscribe-"+this.bbp_forum_id).hasClass("is-subscribed")||"reply"===this.topic_reply_draft.object&&!g("#subscribe-"+this.bbp_topic_id).hasClass("is-subscribed"))&&e.find("#bbp_topic_subscription").prop("checked",!1),e.find("#bbp_topic_tags").val(""),e.find("#bbp_topic_tags_dropdown").val(""),e.find("#bbp_topic_tags_dropdown").trigger("change"),e.find("#bbp_media").val(""),void 0!==o.length&&0<o.length&&(i=o.data("key"),bp.Nouveau.Media.resetForumsMediaComponent(i),e.find("#forums-media-button"))&&e.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),e.find("#bbp_document").val(""),void 0!==a.length&&0<a.length&&(o=a.data("key"),bp.Nouveau.Media.resetForumsDocumentComponent(o),e.find("#forums-document-button"))&&e.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),e.find("#bbp_video").val(""),void 0!==p.length&&0<p.length&&(i=p.data("key"),bp.Nouveau.Media.resetForumsVideoComponent(i),e.find("#forums-video-button"))&&e.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),void 0!==a.length&&0<a.length&&(e.find("#whats-new-toolbar #forums-gif-button").removeClass("active"),e.find(".gif-media-search-dropdown").removeClass("open"),d.length&&(d.addClass("closed"),d.find(".gif-image-container img").attr("src",""),d[0].style="",e.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")),e.find("#bbp_media_gif").length)&&e.find("#bbp_media_gif").val(""),this.topic_reply_draft.data=!1,bp.Nouveau.Media.reply_topic_display_post="edit",e[0].reset(),e.removeClass("has-content")},resetTopicReplyDraftLinkPreview:function(){var t=g("form#new-post")[0];0<jQuery(t).find("#link_preview_data").length&&jQuery(t).find("#link_preview_data").val(""),jQuery(t).find(".bb-url-scrapper-container").remove(),jQuery(t).find("#bb_link_url").remove()},collectTopicReplyDraftActivity:function(){var t,e=g("#new-post"),i={},e=(_.each(e.serializeArray(),function(t){t.name=t.name.replace("[]",""),-1===_.indexOf(["_wpnonce","_wp_http_referer","_bbp_unfiltered_html_reply","redirect_to","_bbp_unfiltered_html_topic"],t.name)&&(void 0===i[t.name]?i[t.name]=t.value:(_.isArray(i[t.name])||(i[t.name]=[i[t.name]]),i[t.name].push(t.value)))}),void 0===i.bbp_topic_subscription&&(i.bbp_topic_subscription=""),!1),o=(void 0!==i.bbp_media&&""!==i.bbp_media&&"[]"!==i.bbp_media&&(e=!0),void 0!==i.bbp_document&&""!==i.bbp_document&&"[]"!==i.bbp_document&&(e=!0),void 0!==i.bbp_video&&""!==i.bbp_video&&"[]"!==i.bbp_video&&(e=!0),void 0!==i.bbp_media_gif&&""!==i.bbp_media_gif&&"[]"!==i.bbp_media_gif&&(e=!0),void 0!==i.link_preview_data&&""!==i.link_preview_data&&"[]"!==i.link_preview_data&&(e=!0,o=JSON.parse(i.link_preview_data),(t={}).embed=!1===o.link_embed?0:1,t.url=o.link_url,t.link_image_index_save=0,i.bb_link_url=JSON.stringify(t)),!0);(o=("topic"!==this.topic_reply_draft.object||void 0===i.bbp_topic_content||""!==g(g.parseHTML(i.bbp_topic_content)).text().trim()||e)&&("reply"!==this.topic_reply_draft.object||void 0===i.bbp_reply_content||""!==g(g.parseHTML(i.bbp_reply_content)).text().trim()||e)?o:!1)?(void 0!==i.bbp_video&&""!==i.bbp_video&&(t=JSON.parse(i.bbp_video).filter(function(t){return void 0!==t.js_preview&&delete t.js_preview,t}),i.bbp_video=JSON.stringify(t)),e={},void 0!==this.all_draft_data[this.topic_reply_draft.data_key]&&(e=this.all_draft_data[this.topic_reply_draft.data_key]),bp.Nouveau.TopicReplyDraft.checkedTopicReplyDataChanged(e,i),this.topic_reply_draft.data=i,this.all_draft_data[this.topic_reply_draft.data_key]=i,this.topic_reply_draft.is_content_valid=!0,localStorage.setItem(this.topic_reply_draft.data_key,JSON.stringify(this.topic_reply_draft))):(void 0!==this.all_draft_data[this.topic_reply_draft.data_key]&&delete this.all_draft_data[this.topic_reply_draft.data_key],this.topic_reply_draft.data=!1,localStorage.removeItem(this.topic_reply_draft.data_key))},checkedTopicReplyDataChanged:function(e,i){_.each(["bbp_topic_title","bbp_topic_content","bbp_stick_topic","bbp_topic_tags","bbp_reply_content","bbp_media","bbp_document","bbp_video","bbp_media_gif","link_embed","link_description","link_image","link_title","link_url"],function(t){void 0!==e[t]&&void 0===i[t]||void 0===e[t]&&void 0!==i[t]?bp.Nouveau.TopicReplyDraft.draft_content_changed=!0:void 0!==e[t]&&void 0!==i[t]&&(-1!==_.indexOf(["bbp_topic_content","bbp_reply_content"],t)?g(g.parseHTML(e[t])).text().trim()!==g(g.parseHTML(i[t])).text().trim()&&(bp.Nouveau.TopicReplyDraft.draft_content_changed=!0):e[t]!==i[t]&&(bp.Nouveau.TopicReplyDraft.draft_content_changed=!0))})},postTopicReplyDraft:function(t,e,i){!t&&void 0===this.all_draft_data[this.topic_reply_draft.data_key]||!t&&!bp.Nouveau.TopicReplyDraft.draft_content_changed||(this.topic_reply_draft.data=this.all_draft_data[this.topic_reply_draft.data_key],e?((t=new FormData).append("_wpnonce_post_topic_reply_draft",BP_Nouveau.forums.nonces.post_topic_reply_draft),t.append("action","post_topic_reply_draft"),t.append("draft_topic_reply",JSON.stringify(this.topic_reply_draft)),i&&t.append("all_data",JSON.stringify(this.all_draft_data)),navigator.sendBeacon(BP_Nouveau.ajaxurl,t)):(this.draft_ajax_request&&this.draft_ajax_request.abort(),e={_wpnonce_post_topic_reply_draft:BP_Nouveau.forums.nonces.post_topic_reply_draft,action:"post_topic_reply_draft",draft_topic_reply:this.topic_reply_draft},this.draft_ajax_request=g.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(){}})),bp.Nouveau.TopicReplyDraft.draft_content_changed=!1)},displayTopicReplyDraft:function(){bp.Nouveau.Media.reply_topic_allow_delete_media=!0,_.isUndefined(this.topic_reply_draft)||("topic"===this.topic_reply_draft.object?bp.Nouveau.TopicReplyDraft.appendTopicDraftData():bp.Nouveau.TopicReplyDraft.appendReplyDraftData())},appendTopicDraftData:function(){bp.Nouveau.TopicReplyDraft.getTopicReplyDraftData();var t,e,i=g("form#new-post"),o={},a=i.find(".bbp-the-content").data("key"),a=i.find("#bbp_editor_topic_content_"+a);void 0===(o=void 0!==this.all_draft_data[this.topic_reply_draft.data_key]?this.all_draft_data[this.topic_reply_draft.data_key]:o).bbp_topic_title&&void 0===o.bbp_topic_content||(i.addClass("has-draft"),void 0!==o.bbp_topic_title&&(i.find("#bbp_topic_title").val(o.bbp_topic_title),i.addClass("has-title")),void 0!==o.bbp_topic_content&&(a=a.get(0),null!==(t=window.MediumEditor?window.MediumEditor.getEditorFromElement(a):null)?(t.setContent(o.bbp_topic_content),""!==g(a).text()&&i.addClass("has-content")):(i.find("#bbp_topic_content").focus(),i.find("#bbp_topic_content").val(o.bbp_topic_content),""!==g(a).val()&&i.addClass("has-content"))),i.find('#bbp_stick_topic_select option[value="'+o.bbp_stick_topic+'"]').prop("selected",!0),void 0!==o.bbp_topic_subscription&&""!==o.bbp_topic_subscription?i.find("#bbp_topic_subscription").prop("checked",!0):(void 0!==o.bbp_topic_subscription&&""===o.bbp_topic_subscription||0<this.bbp_forum_id&&!g("#subscribe-"+this.bbp_forum_id).hasClass("is-subscribed"))&&i.find("#bbp_topic_subscription").prop("checked",!1),void 0!==o.bbp_topic_tags&&""!==o.bbp_topic_tags&&(i.find("#bbp_topic_tags").val(o.bbp_topic_tags),e=i.find("#bbp_topic_tags_dropdown"),_.each(o.bbp_topic_tags.split(","),function(t){e.append(new Option(t,t,!1,!0))}),e.trigger("change")),this.previewDraftMedia(i,o))},appendReplyDraftData:function(){bp.Nouveau.TopicReplyDraft.getTopicReplyDraftData();var t,e,i=g("form#new-post"),o={},a=i.find(".bbp-the-content").data("key"),a=i.find("#bbp_editor_reply_content_"+a);void 0===(o=void 0!==this.all_draft_data[this.topic_reply_draft.data_key]?this.all_draft_data[this.topic_reply_draft.data_key]:o).bbp_reply_content&&void 0===o.bb_link_url||(i.addClass("has-draft"),void 0!==o.bbp_reply_content&&(a=a.get(0),null!==(t=window.MediumEditor?window.MediumEditor.getEditorFromElement(a):null)?(t.setContent(o.bbp_reply_content),""!==g(a).text()&&i.addClass("has-content")):(i.find("#bbp_reply_content").focus(),i.find("#bbp_reply_content").val(o.bbp_reply_content),""!==g(a).val()&&i.addClass("has-content"))),void 0!==o.bbp_topic_subscription&&""!==o.bbp_topic_subscription?i.find("#bbp_topic_subscription").prop("checked",!0):(void 0!==o.bbp_topic_subscription&&""===o.bbp_topic_subscription||0<this.bbp_topic_id&&!g("#subscribe-"+this.bbp_topic_id).hasClass("is-subscribed"))&&i.find("#bbp_topic_subscription").prop("checked",!1),void 0!==o.bbp_topic_tags&&""!==o.bbp_topic_tags&&(i.find("#bbp_topic_tags").val(o.bbp_topic_tags),e=i.find("#bbp_topic_tags_dropdown"),_.each(o.bbp_topic_tags.split(","),function(t){e.append(new Option(t,t,!1,!0))}),e.trigger("change")),void 0!==o.bb_link_url&&""!==o.bb_link_url&&(i.find("#bb_link_url").remove(),g("<input>").attr({type:"hidden",id:"bb_link_url",name:"bb_link_url",value:o.bb_link_url}).appendTo(i)),bp.Nouveau.TopicReplyDraft.previewDraftMedia(i,o))},previewDraftMedia:function(t,e){var i=bp.Nouveau.Media,o=t.find("#forums-post-media-uploader"),a=t.find("#forums-post-document-uploader"),p=t.find("#forums-post-video-uploader"),d=t.find("#whats-new-attachments .forums-attached-gif-container");if(void 0!==o.length&&0<o.length&&void 0!==e.bbp_media&&""!==e.bbp_media){t.find("#bbp_media").val(e.bbp_media);var n=JSON.parse(e.bbp_media);if(n.length){t.find("a#forums-media-button").trigger("click");for(var r,s=o.data("key"),l=0;l<n.length;l++)i.dropzone_media[s].push({id:n[l].id,media_id:0,name:n[l].name,thumb:n[l].thumb,url:n[l].url,uuid:n[l].uuid,menu_order:n[l].menu_order,saved:!1}),r={name:n[l].name,accepted:!0,kind:"image",upload:{filename:n[l].name,uuid:n[l].uuid},dataURL:n[l].url,id:n[l].id},i.dropzone_obj[s].files.push(r),i.dropzone_obj[s].emit("addedfile",r),i.createThumbnailFromUrl(r,o),i.dropzone_obj[s].emit("dz-success",r),i.dropzone_obj[s].emit("dz-complete",r);i.addMediaIdsToForumsForm(o),_.isNull(i.dropzone_obj[s].files)||0===i.dropzone_obj[s].files.length||(t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("no-click")),t.addClass("has-media")}}if(void 0!==a.length&&0<a.length&&void 0!==e.bbp_document&&""!==e.bbp_document){t.find("#bbp_document").val(e.bbp_document);var c=JSON.parse(e.bbp_document);if(c.length){t.find("a#forums-document-button").trigger("click");for(var b,u=a.data("key"),f=0;f<c.length;f++)i.dropzone_media[u].push({id:c[f].id,document_id:0,name:c[f].full_name,full_name:c[f].full_name,type:"document",title:c[f].name,size:c[f].size,url:c[f].url,uuid:c[f].uuid,menu_order:c[f].menu_order,saved:!1}),b={name:c[f].full_name,size:c[f].size,accepted:!0,kind:"document",upload:{name:c[f].full_name,title:c[f].name,filename:c[f].full_name,size:c[f].size,uuid:c[f].uuid},dataURL:c[f].url,id:c[f].id},i.dropzone_obj[u].files.push(b),i.dropzone_obj[u].emit("addedfile",b),i.dropzone_obj[u].emit("dz-success",b),i.dropzone_obj[u].emit("complete",b);i.addDocumentIdsToForumsForm(a),_.isNull(i.dropzone_obj[u].files)||0===i.dropzone_obj[u].files.length||(t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("no-click")),t.addClass("has-media")}}if(void 0!==p.length&&0<p.length&&void 0!==e.bbp_video&&""!==e.bbp_video){t.find("#bbp_video").val(e.bbp_video);var m=JSON.parse(e.bbp_video);if(m.length){t.find("a#forums-video-button").trigger("click");for(var y,v=p.data("key"),h=0;h<m.length;h++)i.dropzone_media[v].push({id:m[h].id,video_id:0,name:m[h].name,type:"video",title:m[h].name,size:m[h].size,url:m[h].url,uuid:m[h].uuid,thumb:m[h].thumb,menu_order:m[h].menu_order,saved:!1}),y={name:m[h].name,size:m[h].size,accepted:!0,kind:"video",upload:{name:m[h].name,title:m[h].name,size:m[h].size,uuid:m[h].uuid},dataURL:m[h].url,dataThumb:m[h].thumb,id:m[h].id},i.dropzone_obj[v].files.push(y),i.dropzone_obj[v].emit("addedfile",y),i.dropzone_obj[v].emit("dz-success",y),i.dropzone_obj[v].emit("complete",y);i.addVideoIdsToForumsForm(p),_.isNull(i.dropzone_obj[v].files)||0===i.dropzone_obj[v].files.length||(t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("no-click")),t.addClass("has-media")}}void 0!==d.length&&0<d.length&&void 0!==e.bbp_media_gif&&""!==e.bbp_media_gif&&void 0!==(a=JSON.parse(e.bbp_media_gif)).images&&(t.find("a#forums-gif-button").trigger("click"),d[0].style.backgroundImage="url("+a.images.fixed_width.url+")",d[0].style.backgroundSize="contain",d[0].style.height=a.images.original.height+"px",d[0].style.width=a.images.original.width+"px",d.find(".gif-image-container img").attr("src",a.images.original.url),d.removeClass("closed"),g("#bbp_media_gif").length)&&(g("#bbp_media_gif").val(JSON.stringify(a)),t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("no-click"),t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),t.addClass("has-gif"))},submitTopicReplyDraftForm:function(){this.topic_reply_draft.post_action="delete",this.clearTopicReplyDraftIntervals(),this.resetLocalTopicReplyDraft()},discardTopicReplyDraftForm:function(){var t=g("a[data-modal-id]"),e=g(".bbp-reply-to-link");t.css("pointer-events","none"),e.css("pointer-events","none"),this.topic_reply_draft.post_action="delete",this.postTopicReplyDraft(!0,!0,!1),this.clearTopicReplyDraftIntervals(),this.resetLocalTopicReplyDraft(),this.resetTopicReplyDraftPostForm(),this.resetTopicReplyDraftLinkPreview(),this.topic_reply_draft.post_action="update",bp.Nouveau.TopicReplyDraft.setupTopicReplyDraftIntervals(),bp.Nouveau.TopicReplyDraft.is_topic_reply_form_submit=!1,t.css("pointer-events",""),e.css("pointer-events","")},setupOnReloadWindow:function(){"update"===bp.Nouveau.TopicReplyDraft.topic_reply_draft.post_action&&(bp.Nouveau.TopicReplyDraft.clearTopicReplyDraftIntervals(),bp.Nouveau.TopicReplyDraft.collectTopicReplyDraftActivity(),bp.Nouveau.TopicReplyDraft.postTopicReplyDraft(!1,!0,!0))}},bp.Nouveau.TopicReplyDraft.start())}((bp,jQuery));