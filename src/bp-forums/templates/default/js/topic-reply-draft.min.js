window.bp=window.bp||{},function(t,i){if("undefined"!=typeof BP_Nouveau){bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media=bp.Nouveau.Media||{},bp.Nouveau.TopicReplyDraft=function(t){t||(t=i("#new-post")),this.currentForm=t,this.start=function(){void 0!==BP_Nouveau.forums.params.bb_current_user_id&&0!==parseInt(BP_Nouveau.forums.params.bb_current_user_id)&&(this.setupGlobals(),this.addListeners())},this.setupGlobals=function(){this.bbp_forum_id=!1,this.bbp_topic_id=!1,this.bbp_reply_to=!1,this.is_bb_theme=i("body").hasClass("buddyboss-theme"),this.topic_reply_local_interval=!1,this.topic_reply_ajax_interval=!1,this.draft_ajax_request=null,this.is_topic_reply_form_submit=!1,this.draft_content_changed=!1,this.all_draft_data={},this.bbp_lead_topic_tags="",this.bp_nouveau_forums_data=void 0!==BP_Nouveau.forums.draft?BP_Nouveau.forums.draft:{},this.topic_reply_draft={object:!1,data_key:!1,data:!1,post_action:"update",is_content_valid:!1};var t=new Event(this.currentForm);this.setupTopicReplyDraftKeys(t),this.getTopicReplyDraftData(),this.syncTopicReplyDraftData()},this.addListeners=function(){var t=this;this.is_bb_theme?(this.currentForm.closest(".bbp-topic-form").on("bbp_after_load_topic_form",function(){t.setupOnOpenTopicReplyModal()}),this.currentForm.closest(".bbp-reply-form").on("bbp_after_load_reply_form",function(){t.setupOnOpenTopicReplyModal()}),this.currentForm.closest(".bbp-reply-form").on("bbp_after_load_inline_reply_form",function(){t.setupOnOpenTopicReplyModal()}),this.currentForm.find(".js-modal-close").on("bbp_after_close_topic_reply_form",function(){t.clearOnCloseTopicReplyModal()}),i(document).on("bbp_after_close_topic_reply_form_on_overlay",function(){t.clearOnCloseTopicReplyModal()})):(i(window).on("load",function(){t.setupTopicReplyDraftIntervals()}),t.displayTopicReplyDraft()),i("body").hasClass("activity")||(window.onbeforeunload=function(i){void 0!==i&&t.setupOnReloadWindow()},window.unload=function(i){void 0!==i&&t.setupOnReloadWindow()}),this.currentForm.on("click","#bbp_topic_submit",function(){t.submitTopicReplyDraftForm()}),this.currentForm.on("click","#bbp_reply_submit",function(){t.submitTopicReplyDraftForm()}),this.currentForm.on("click",".bb_discard_topic_reply_draft",function(){t.discardTopicReplyDraftForm()})},this.setupOnOpenTopicReplyModal=function(){this.setupTopicReplyDraftKeys(),this.getTopicReplyDraftData(),this.syncTopicReplyDraftData(),this.setupTopicReplyDraftIntervals(),this.displayTopicReplyDraft()},this.setupTopicReplyDraftKeys=function(){this.currentForm&&(this.currentForm.find("#bbp_forum_id").length>0?(this.bbp_forum_id=parseInt(this.currentForm.find("#bbp_forum_id").val()),this.topic_reply_draft.object="topic",this.topic_reply_draft.data_key="draft_topic",0<this.bbp_forum_id&&(this.topic_reply_draft.data_key="draft_discussion_"+this.bbp_forum_id)):this.currentForm.find("#bbp_topic_id").length>0&&(this.bbp_topic_id=parseInt(this.currentForm.find("#bbp_topic_id").val()),this.bbp_reply_to=parseInt(this.currentForm.find("#bbp_reply_to").val()),this.topic_reply_draft.object="reply",this.topic_reply_draft.data_key="draft_reply",0<this.bbp_topic_id&&0===this.bbp_reply_to?this.topic_reply_draft.data_key="draft_reply_"+this.bbp_topic_id:0<this.bbp_topic_id&&0<this.bbp_reply_to&&(this.topic_reply_draft.data_key="draft_reply_"+this.bbp_topic_id+"_"+this.bbp_reply_to)),this.currentForm.hasClass("has-draft")&&this.currentForm.removeClass("has-draft"),this.updateLeadDiscussionTagsInForm(),this.bbp_topic_id&&e.length>1&&this.updateSubscriptionCheckboxes())},this.updateSubscriptionCheckboxes=function(){var t=this.currentForm.find("#bbp_topic_subscription");t.prop("id","bbp_topic_subscription_"+this.bbp_topic_id),t.siblings("label").prop("for","bbp_topic_subscription_"+this.bbp_topic_id)},this.updateLeadDiscussionTagsInForm=function(){if(this.currentForm){var t=[],e=this.is_bb_theme?".item-tags ul li":".bbp-topic-tags p a";this.currentForm.closest("#bbpress-forums").find(e).each(function(){t.push(i(this).text().trim())}),t.length>0?this.bbp_lead_topic_tags=t.join(","):this.bbp_lead_topic_tags="",this.currentForm.find("#bbp_topic_tags").val(this.bbp_lead_topic_tags);var o=this.currentForm.find("#bbp_topic_tags_dropdown");""!==this.bbp_lead_topic_tags&&(o.find("option").remove(),_.each(this.bbp_lead_topic_tags.split(","),function(t){o.append(new Option(t,t,!1,!0))})),o.trigger("change")}},this.getTopicReplyDraftData=function(){if(!this.topic_reply_draft.data_key||""!==this.topic_reply_draft.data_key){var t=localStorage.getItem(this.topic_reply_draft.data_key);if(!_.isUndefined(t)&&null!==t&&0<t.length){var i=JSON.parse(t);this.topic_reply_draft.data=i.data,this.all_draft_data[this.topic_reply_draft.data_key]=i.data}}return this.topic_reply_draft},this.syncTopicReplyDraftData=function(){void 0===this.all_draft_data[this.topic_reply_draft.data_key]&&void 0!==this.bp_nouveau_forums_data&&void 0!==this.bp_nouveau_forums_data[this.topic_reply_draft.data_key]&&(this.topic_reply_draft=this.bp_nouveau_forums_data[this.topic_reply_draft.data_key],this.all_draft_data[this.topic_reply_draft.data_key]=this.bp_nouveau_forums_data[this.topic_reply_draft.data_key].data,localStorage.setItem(this.topic_reply_draft.data_key,JSON.stringify(this.topic_reply_draft)))},this.setupTopicReplyDraftIntervals=function(){this.is_bb_theme&&i(".bb-modal-box").hasClass("bb-modal-open")?(window.topic_reply_local_interval||(window.topic_reply_local_interval=setInterval(function(){this.collectTopicReplyDraftActivity()}.bind(this),3e3)),window.topic_reply_ajax_interval||(window.topic_reply_ajax_interval=setInterval(function(){this.postTopicReplyDraft(!1,!1,!1)}.bind(this),2e4))):this.is_bb_theme||(window.topic_reply_local_interval||(window.topic_reply_local_interval=setInterval(function(){this.collectTopicReplyDraftActivity()}.bind(this),3e3)),window.topic_reply_ajax_interval||(window.topic_reply_ajax_interval=setInterval(function(){this.postTopicReplyDraft(!1,!1,!1)}.bind(this),2e4)))},this.clearOnCloseTopicReplyModal=function(){bp.Nouveau.Media.reply_topic_display_post="",this.is_topic_reply_form_submit||(this.collectTopicReplyDraftActivity(),this.postTopicReplyDraft(!1,!0,!1)),this.clearTopicReplyDraftIntervals(),setTimeout(function(){this.resetTopicReplyDraftLinkPreview(),this.resetTopicReplyDraftPostForm()}.bind(this),500),bp.Nouveau.Media.reply_topic_display_post="",this.is_topic_reply_form_submit=!1},this.clearTopicReplyDraftIntervals=function(){clearInterval(window.topic_reply_local_interval),window.topic_reply_local_interval=!1,clearInterval(window.topic_reply_ajax_interval),window.topic_reply_ajax_interval=!1},this.resetLocalTopicReplyDraft=function(){bp.Nouveau.Media.reply_topic_allow_delete_media=!1,bp.Nouveau.Media.reply_topic_display_post="",this.is_topic_reply_form_submit=!0,void 0!==this.all_draft_data[this.topic_reply_draft.data_key]&&delete this.all_draft_data[this.topic_reply_draft.data_key],void 0!==this.bp_nouveau_forums_data[this.topic_reply_draft.data_key]&&delete this.bp_nouveau_forums_data[this.topic_reply_draft.data_key],this.topic_reply_draft.data=!1,localStorage.removeItem(this.topic_reply_draft.data_key),bp.Nouveau.Media.reply_topic_display_post="edit";var t=this.currentForm?this.currentForm:i("form#new-post");i(t).find("#bb_link_url").length>0&&i(t).find("#bb_link_url").remove(),t.removeClass("has-draft has-content has-media has-gif has-link-preview")},this.resetTopicReplyDraftPostForm=function(){var t,o,a=this.currentForm?this.currentForm:i("form#new-post"),n=a.find(".bbp-the-content").data("key"),p=a.find("#forums-post-media-uploader"),r=a.find("#forums-post-document-uploader"),s=a.find("#forums-post-video-uploader"),d=a.find("#whats-new-attachments .forums-attached-gif-container");void 0!==window.MediumEditor?"topic"===this.topic_reply_draft.object?(window.forums_medium_topic_editor&&(o=window.forums_medium_topic_editor[n],o.setContent("")),t=a.find("#bbp_editor_topic_content_"+n),t.removeClass("error"),a.find("#bbp_topic_content").val(""),a.find("#bbp_topic_title").val(""),a.removeClass("has-title")):"reply"===this.topic_reply_draft.object&&(window.forums_medium_reply_editor&&(o=window.forums_medium_reply_editor[n],o.setContent("")),t=a.find("#bbp_editor_reply_content_"+n),t.removeClass("error"),t=a.find("#bbp_editor_reply_content_"+n),a.find("#bbp_reply_content").val(""),setTimeout(function(){t.removeClass("error")},300)):(a.find(".bbp-the-content:not(.emojionearea)").empty(),a.find("#bbp_reply_content").val(""));var _=e.length>1&&this.bbp_topic_id?"#bbp_topic_subscription_"+this.bbp_topic_id:"#bbp_topic_subscription";if(("topic"!==this.topic_reply_draft.object||i("#subscribe-"+this.bbp_forum_id).hasClass("is-subscribed"))&&("reply"!==this.topic_reply_draft.object||i("#subscribe-"+this.bbp_topic_id).hasClass("is-subscribed"))||a.find(_).prop("checked",!1),a.find("#bbp_topic_tags").val(""),a.find("#bbp_topic_tags_dropdown").val(""),a.find("#bbp_topic_tags_dropdown").trigger("change"),a.find("#bbp_media").val(""),void 0!==p.length&&0<p.length){var l=p.data("key");bp.Nouveau.Media.resetForumsMediaComponent(l),a.find("#forums-media-button")&&a.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click")}if(a.find("#bbp_document").val(""),void 0!==r.length&&0<r.length){var c=r.data("key");bp.Nouveau.Media.resetForumsDocumentComponent(c),a.find("#forums-document-button")&&a.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click")}if(a.find("#bbp_video").val(""),void 0!==s.length&&0<s.length){var b=s.data("key");bp.Nouveau.Media.resetForumsVideoComponent(b),a.find("#forums-video-button")&&a.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click")}void 0!==r.length&&0<r.length&&(a.find("#whats-new-toolbar #forums-gif-button").removeClass("active"),a.find(".gif-media-search-dropdown").removeClass("open"),d.length&&(d.addClass("closed"),d.find(".gif-image-container img").attr("src",""),d[0].style="",a.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")),a.find("#bbp_media_gif").length&&a.find("#bbp_media_gif").val("")),this.topic_reply_draft.data=!1,bp.Nouveau.Media.reply_topic_display_post="edit",a[0].reset(),a.removeClass("has-content")},this.resetTopicReplyDraftLinkPreview=function(){var t=this.currentForm?this.currentForm:i("form#new-post");i(t).find("#bb-close-link-suggestion").trigger("click"),i(t).find("#link_preview_data").length>0&&(i(t).find("#link_preview_data").val(""),i(t).find("#whats-new-attachments").val("")),i(t).find(".bb-url-scrapper-container").remove(),i(t).find("#bb_link_url").remove()},this.collectTopicReplyDraftActivity=function(){var t=this.currentForm?this.currentForm:i("#new-post"),e={};_.each(t.serializeArray(),function(t){t.name=t.name.replace("[]",""),-1===_.indexOf(["_wpnonce","_wp_http_referer","_bbp_unfiltered_html_reply","redirect_to","_bbp_unfiltered_html_topic"],t.name)&&(void 0===e[t.name]?e[t.name]=t.value:(_.isArray(e[t.name])||(e[t.name]=[e[t.name]]),e[t.name].push(t.value)))}),void 0===e.bbp_topic_subscription&&(e.bbp_topic_subscription="");var o=!1;if(void 0!==e.bbp_media&&""!==e.bbp_media&&"[]"!==e.bbp_media&&(o=!0),void 0!==e.bbp_document&&""!==e.bbp_document&&"[]"!==e.bbp_document&&(o=!0),void 0!==e.bbp_video&&""!==e.bbp_video&&"[]"!==e.bbp_video&&(o=!0),void 0!==e.bbp_media_gif&&""!==e.bbp_media_gif&&"[]"!==e.bbp_media_gif&&(o=!0),void 0!==e.link_preview_data&&""!==e.link_preview_data&&"[]"!==e.link_preview_data){o=!0;var a=JSON.parse(e.link_preview_data),n={};n.embed=!1===a.link_embed?0:1,n.url=a.link_url,n.link_image_index_save=0,e.bb_link_url=JSON.stringify(n)}var p=!0;if(("topic"!==this.topic_reply_draft.object||void 0===e.bbp_topic_content||""!==i(i.parseHTML(e.bbp_topic_content)).text().trim()||o)&&("reply"!==this.topic_reply_draft.object||void 0===e.bbp_reply_content||""!==i(i.parseHTML(e.bbp_reply_content)).text().trim()||o)||(p=!1),p){if(void 0!==e.bbp_video&&""!==e.bbp_video){var r=JSON.parse(e.bbp_video),s=r.filter(function(t){return void 0!==t.js_preview&&delete t.js_preview,t});e.bbp_video=JSON.stringify(s)}var d={};void 0!==this.all_draft_data[this.topic_reply_draft.data_key]&&(d=this.all_draft_data[this.topic_reply_draft.data_key]),this.checkedTopicReplyDataChanged(d,e),this.topic_reply_draft.data=e,this.all_draft_data[this.topic_reply_draft.data_key]=e,this.topic_reply_draft.is_content_valid=!0,localStorage.setItem(this.topic_reply_draft.data_key,JSON.stringify(this.topic_reply_draft))}},this.checkedTopicReplyDataChanged=function(t,e){var o=["bbp_topic_title","bbp_topic_content","bbp_stick_topic","bbp_topic_tags","bbp_reply_content","bbp_media","bbp_document","bbp_video","bbp_media_gif","link_embed","link_description","link_image","link_title","link_url"],a=this;_.each(o,function(o){void 0!==t[o]&&void 0===e[o]?a.draft_content_changed=!0:void 0===t[o]&&void 0!==e[o]?a.draft_content_changed=!0:void 0!==t[o]&&void 0!==e[o]&&(-1!==_.indexOf(["bbp_topic_content","bbp_reply_content"],o)?i(i.parseHTML(t[o])).text().trim()!==i(i.parseHTML(e[o])).text().trim()&&(a.draft_content_changed=!0):t[o]!==e[o]&&(a.draft_content_changed=!0))})},this.postTopicReplyDraft=function(t,e,o){if((t||void 0!==this.all_draft_data[this.topic_reply_draft.data_key])&&(t||this.draft_content_changed)){if(this.topic_reply_draft.data=this.all_draft_data[this.topic_reply_draft.data_key],e){var a=new FormData;a.append("_wpnonce_post_topic_reply_draft",BP_Nouveau.forums.nonces.post_topic_reply_draft),a.append("action","post_topic_reply_draft"),a.append("draft_topic_reply",JSON.stringify(this.topic_reply_draft)),o&&a.append("all_data",JSON.stringify(this.all_draft_data)),navigator.sendBeacon(BP_Nouveau.ajaxurl,a)}else{this.draft_ajax_request&&this.draft_ajax_request.abort();var n={_wpnonce_post_topic_reply_draft:BP_Nouveau.forums.nonces.post_topic_reply_draft,action:"post_topic_reply_draft",draft_topic_reply:this.topic_reply_draft};this.draft_ajax_request=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(){}})}this.draft_content_changed=!1}},this.displayTopicReplyDraft=function(){bp.Nouveau.Media.reply_topic_allow_delete_media=!0,_.isUndefined(this.topic_reply_draft)||("topic"===this.topic_reply_draft.object?this.appendTopicDraftData():this.appendReplyDraftData())},this.appendTopicDraftData=function(){this.getTopicReplyDraftData();var t=this.currentForm?this.currentForm:i("form#new-post"),o={},a=t.find(".bbp-the-content").data("key"),n=t.find("#bbp_editor_topic_content_"+a);if(void 0!==this.all_draft_data[this.topic_reply_draft.data_key]&&(o=this.all_draft_data[this.topic_reply_draft.data_key]),!(void 0===o.bbp_topic_title&&void 0===o.bbp_topic_content||""===o.bbp_topic_title&&""===o.bbp_topic_content)){if(t.addClass("has-draft"),void 0!==o.bbp_topic_title&&""!==o.bbp_topic_title&&(t.find("#bbp_topic_title").val(o.bbp_topic_title),t.addClass("has-title")),void 0!==o.bbp_topic_content&&""!==o.bbp_topic_content){var p=n.get(0),r=window.MediumEditor?window.MediumEditor.getEditorFromElement(p):null;null!==r?(r.setContent(o.bbp_topic_content),""!==i(p).text()&&t.addClass("has-content")):(n.html(o.bbp_topic_content),t.find("#bbp_topic_content").focus(),t.find("#bbp_topic_content").val(o.bbp_topic_content),""!==i(p).val()&&t.addClass("has-content"))}t.find('#bbp_stick_topic_select option[value="'+o.bbp_stick_topic+'"]').prop("selected",!0);var s=e.length>1&&this.bbp_topic_id?"#bbp_topic_subscription_"+this.bbp_topic_id:"#bbp_topic_subscription";if(void 0!==o.bbp_topic_subscription&&""!==o.bbp_topic_subscription?t.find(s).prop("checked",!0):void 0!==o.bbp_topic_subscription&&""===o.bbp_topic_subscription?t.find(s).prop("checked",!1):0<this.bbp_forum_id&&!i("#subscribe-"+this.bbp_forum_id).hasClass("is-subscribed")&&t.find(s).prop("checked",!1),void 0!==o.bbp_topic_tags&&null!==o.bbp_topic_tags){t.find("#bbp_topic_tags").val(o.bbp_topic_tags);var d=t.find("#bbp_topic_tags_dropdown");d.val(""),""!==o.bbp_topic_tags&&_.each(o.bbp_topic_tags.split(","),function(t){d.append(new Option(t,t,!1,!0))}),d.trigger("change")}void 0!==o.bb_link_url&&""!==o.bb_link_url&&(t.find("#bb_link_url").length>0&&t.find("#bb_link_url").remove(),i("<input>").attr({type:"hidden",id:"bb_link_url",name:"bb_link_url",value:o.bb_link_url}).appendTo(t)),this.previewDraftMedia(t,o)}},this.appendReplyDraftData=function(){this.getTopicReplyDraftData();var t=this.currentForm?this.currentForm:i("form#new-post"),o={},a=t.find(".bbp-the-content").data("key"),n=t.find("#bbp_editor_reply_content_"+a);if(void 0!==this.all_draft_data[this.topic_reply_draft.data_key]&&(o=this.all_draft_data[this.topic_reply_draft.data_key]),!(void 0===o.bbp_reply_content&&void 0===o.bb_link_url||""===o.bbp_reply_content&&""===o.bb_link_url)){if(t.addClass("has-draft"),void 0!==o.bbp_reply_content&&""!==o.bbp_reply_content){var p=n.get(0),r=window.MediumEditor?window.MediumEditor.getEditorFromElement(p):null;null!==r?(r.setContent(o.bbp_reply_content),""!==i(p).text()&&t.addClass("has-content")):(n.html(o.bbp_reply_content),t.find("#bbp_reply_content").focus(),t.find("#bbp_reply_content").val(o.bbp_reply_content),""!==i(p).val()&&t.addClass("has-content"))}var s=e.length>1&&this.bbp_topic_id?"#bbp_topic_subscription_"+this.bbp_topic_id:"#bbp_topic_subscription";if(void 0!==o.bbp_topic_subscription&&""!==o.bbp_topic_subscription?t.find(s).prop("checked",!0):void 0!==o.bbp_topic_subscription&&""===o.bbp_topic_subscription?t.find(s).prop("checked",!1):0<this.bbp_topic_id&&!i("#subscribe-"+this.bbp_topic_id).hasClass("is-subscribed")&&t.find(s).prop("checked",!1),void 0!==o.bbp_topic_tags&&null!==o.bbp_topic_tags){t.find("#bbp_topic_tags").val(o.bbp_topic_tags);var d=t.find("#bbp_topic_tags_dropdown");d.val(""),""!==o.bbp_topic_tags&&_.each(o.bbp_topic_tags.split(","),function(t){d.append(new Option(t,t,!1,!0))}),d.trigger("change")}void 0!==o.bb_link_url&&""!==o.bb_link_url&&(t.find("#bb_link_url").remove(),i("<input>").attr({type:"hidden",id:"bb_link_url",name:"bb_link_url",value:o.bb_link_url}).appendTo(t)),this.previewDraftMedia(t,o)}},this.previewDraftMedia=function(t,e){var o=bp.Nouveau.Media,a=t.find("#forums-post-media-uploader"),n=t.find("#forums-post-document-uploader"),p=t.find("#forums-post-video-uploader"),r=t.find("#whats-new-attachments .forums-attached-gif-container");if(void 0!==a.length&&0<a.length&&void 0!==e.bbp_media&&""!==e.bbp_media){t.find("#bbp_media").val(e.bbp_media);var s=JSON.parse(e.bbp_media);if(s.length){t.find("a#forums-media-button").trigger("click");for(var d=!1,l=a.data("key"),c=0;c<s.length;c++)d=!1,o.dropzone_media[l].push({id:s[c].id,media_id:0,name:s[c].name,thumb:s[c].thumb,url:s[c].url,uuid:s[c].uuid,menu_order:s[c].menu_order,saved:!1}),d={name:s[c].name,accepted:!0,kind:"image",upload:{filename:s[c].name,uuid:s[c].uuid},dataURL:s[c].url,id:s[c].id},o.dropzone_obj[l].files.push(d),o.dropzone_obj[l].emit("addedfile",d),o.createThumbnailFromUrl(d,a),o.dropzone_obj[l].emit("dz-success",d),o.dropzone_obj[l].emit("dz-complete",d);o.addMediaIdsToForumsForm(a),_.isNull(o.dropzone_obj[l].files)||0===o.dropzone_obj[l].files.length||(t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("no-click")),t.addClass("has-media")}}if(void 0!==n.length&&0<n.length&&void 0!==e.bbp_document&&""!==e.bbp_document){t.find("#bbp_document").val(e.bbp_document);var b=JSON.parse(e.bbp_document);if(b.length){t.find("a#forums-document-button").trigger("click");for(var u=!1,f=n.data("key"),m=0;m<b.length;m++)u=!1,o.dropzone_media[f].push({id:b[m].id,document_id:0,name:b[m].full_name,full_name:b[m].full_name,type:"document",title:b[m].name,size:b[m].size,url:b[m].url,uuid:b[m].uuid,menu_order:b[m].menu_order,saved:!1,svg_icon:_.isUndefined(b[m].svg_icon)?"":b[m].svg_icon}),u={name:b[m].full_name,size:b[m].size,accepted:!0,kind:"document",upload:{name:b[m].full_name,title:b[m].name,filename:b[m].full_name,size:b[m].size,uuid:b[m].uuid},dataURL:b[m].url,id:b[m].id,svg_icon:_.isUndefined(b[m].svg_icon)?"":b[m].svg_icon},o.dropzone_obj[f].files.push(u),o.dropzone_obj[f].emit("addedfile",u),o.dropzone_obj[f].emit("dz-success",u),o.dropzone_obj[f].emit("complete",u);o.addDocumentIdsToForumsForm(n),_.isNull(o.dropzone_obj[f].files)||0===o.dropzone_obj[f].files.length||(t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("no-click")),t.addClass("has-media")}}if(void 0!==p.length&&0<p.length&&void 0!==e.bbp_video&&""!==e.bbp_video){t.find("#bbp_video").val(e.bbp_video);var h=JSON.parse(e.bbp_video);if(h.length){t.find("a#forums-video-button").trigger("click");for(var v=!1,y=p.data("key"),g=0;g<h.length;g++)v=!1,o.dropzone_media[y].push({id:h[g].id,video_id:0,name:h[g].name,type:"video",title:h[g].name,size:h[g].size,url:h[g].url,uuid:h[g].uuid,thumb:h[g].thumb,menu_order:h[g].menu_order,saved:!1}),v={name:h[g].name,size:h[g].size,accepted:!0,kind:"video",upload:{name:h[g].name,title:h[g].name,size:h[g].size,uuid:h[g].uuid},dataURL:h[g].url,dataThumb:h[g].thumb,id:h[g].id},o.dropzone_obj[y].files.push(v),o.dropzone_obj[y].emit("addedfile",v),o.dropzone_obj[y].emit("dz-success",v),o.dropzone_obj[y].emit("complete",v);o.addVideoIdsToForumsForm(p),_.isNull(o.dropzone_obj[y].files)||0===o.dropzone_obj[y].files.length||(t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("no-click")),t.addClass("has-media")}}if(void 0!==r.length&&0<r.length&&void 0!==e.bbp_media_gif&&""!==e.bbp_media_gif){var k=JSON.parse(e.bbp_media_gif);void 0!==k.images&&(t.find("a#forums-gif-button").trigger("click"),r[0].style.backgroundImage="url("+k.images.fixed_width.url+")",r[0].style.backgroundSize="contain",r[0].style.height=k.images.original.height+"px",r[0].style.width=k.images.original.width+"px",r.find(".gif-image-container img").attr("src",k.images.original.url),r.removeClass("closed"),i("#bbp_media_gif").length&&(i("#bbp_media_gif").val(JSON.stringify(k)),t.find("#forums-document-button")&&t.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-video-button")&&t.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable"),t.find("#forums-gif-button")&&t.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("no-click"),t.find("#forums-media-button")&&t.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable"),t.addClass("has-gif")))}},this.submitTopicReplyDraftForm=function(){this.topic_reply_draft.post_action="delete",this.clearTopicReplyDraftIntervals(),this.resetLocalTopicReplyDraft()},this.discardTopicReplyDraftForm=function(){var t=this.currentForm.find("a[data-modal-id]"),i=this.currentForm.find(".bbp-reply-to-link");t.css("pointer-events","none"),i.css("pointer-events","none"),this.topic_reply_draft.post_action="delete",this.postTopicReplyDraft(!0,!0,!1),this.clearTopicReplyDraftIntervals(),this.resetLocalTopicReplyDraft(),this.resetTopicReplyDraftPostForm(),this.resetTopicReplyDraftLinkPreview(),this.topic_reply_draft.post_action="update",this.setupTopicReplyDraftIntervals(),this.is_topic_reply_form_submit=!1,t.css("pointer-events",""),i.css("pointer-events","")},this.setupOnReloadWindow=function(){"update"===this.topic_reply_draft.post_action&&(this.clearTopicReplyDraftIntervals(),this.collectTopicReplyDraftActivity(),this.postTopicReplyDraft(!1,!0,!0))}};var e=i('form[name="new-post"]');e.each(function(){var t=new bp.Nouveau.TopicReplyDraft(i(this));t.start()})}}(bp,jQuery);