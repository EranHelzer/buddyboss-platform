window.bp=window.bp||{},function(O){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(O(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:O(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options)),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.dropzone_video_obj=null,this.dropzone_video=[],this.models=[],this.InitiatedCommentForms=[]},addListeners:function(){O("body").hasClass("activity-singular")||O("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),O("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),O('#buddypress [data-bp-list="activity"]').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),O("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),O("#activity-stream").on("click",".acomments-view-more",this.showActivity),O("body").on("click",".bb-close-action-popup",this.closeComments),O('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),O('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),O('#buddypress [data-bp-list="activity"], #activity-modal').on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),O('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #activity-modal').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),O("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),O(".bb-activity-model-wrapper").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),O(document).keydown(this.commentFormAction),O(document).click(this.togglePopupDropdown),O('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),O('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),O('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-video-button",this.openCommentsVideoUploader.bind(this)),O('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),O(document).on("click",this.toggleActivityOption.bind(this)),O(document).on("click",".activity-state-popup_overlay",bp.Nouveau,this.closeActivityState.bind(this)),O(document).on("click",".activity-state-popup .activity-state-popup_tab_panel a",this.ReactionStatePopupTab),_.isUndefined(BP_Nouveau.activity.params.autoload)||O(window).scroll(this.loadMoreActivities),O(".bb-activity-model-wrapper, .bb-media-model-wrapper").on("click",".acomments-view-more",this.viewMoreComments.bind(this)),O(document).on("click","#activity-stream .activity-comments > .view-more-comments, #activity-stream .activity-state-comments > .comments-count",function(e){e.preventDefault(),O(this).parents("li.activity-item").find(".activity-comments > ul > li.acomments-view-more").trigger("click")}),O("#activity-modal > .bb-modal-activity-body").scroll(this.autoloadMoreComments.bind(this))},heartbeatSend:function(e,t){this.heartbeat_data.first_recorded=O("#buddypress [data-bp-list] [data-bp-activity-id]:not(.bb-pinned)").first().data("bp-timestamp")||0;var a=O("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0;a>this.heartbeat_data.first_recorded&&(this.heartbeat_data.first_recorded=a),(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),t.bp_activity_last_recorded=this.heartbeat_data.last_recorded,O("#buddypress .dir-search input[type=search]").length&&(t.bp_activity_last_recorded_search_terms=O("#buddypress .dir-search input[type=search]").val()),O.extend(t,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(e,t){var a,i,o=bp.Nouveau.objects,d=bp.Nouveau.getStorage("bp-activity","scope"),s=this;void 0!==t&&t.bp_activity_newest_activities&&(this.heartbeat_data.newest=O.trim(t.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(t.bp_activity_newest_activities.last_recorded),i=O(this.heartbeat_data.newest).filter(".activity-item"),a=Number(i.length),o.push("mentions"),"all"===d?(O.each(i,function(e,a){a=O(a),O.each(o,function(e,t){-1!==O.inArray("bp-my-"+t,a.get(0).classList)&&(void 0===s.heartbeat_data.highlights[t]?s.heartbeat_data.highlights[t]=[a.data("bp-activity-id")]:-1===O.inArray(a.data("bp-activity-id"),s.heartbeat_data.highlights[t])&&s.heartbeat_data.highlights[t].push(a.data("bp-activity-id")))})}),t=new RegExp("bp-my-("+o.join("|")+")","g"),this.heartbeat_data.newest=this.heartbeat_data.newest.replace(t,""),O(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(a)):(this.heartbeat_data.highlights[d]=[],O.each(i,function(e,t){s.heartbeat_data.highlights[d].push(O(t).data("bp-activity-id"))})),O.each(o,function(e,t){var a;void 0!==s.heartbeat_data.highlights[t]&&s.heartbeat_data.highlights[t].length&&(a=0,"mentions"===t&&(a=s.mentions_count),O(bp.Nouveau.objectNavParent+' [data-bp-scope="'+t+'"]').find("a span").html(Number(s.heartbeat_data.highlights[t].length)+a))}),o.pop(),O(document).prop("title","("+a+") "+this.heartbeat_data.document_title),O('#buddypress [data-bp-list="activity"] li').first().hasClass("load-newest")?(i=O('#buddypress [data-bp-list="activity"] .load-newest a').html(),O('#buddypress [data-bp-list="activity"] .load-newest a').html(i.replace(/([0-9]+)/,a))):O('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+a+")</a></li>"),O('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),O('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp())},injectActivities:function(e){var t,a,i,o,d=bp.Nouveau.getStorage("bp-activity"),s=d.scope||null,d=d.filter||null;O(e.currentTarget).hasClass("load-newest")?(e.preventDefault(),O(e.currentTarget).remove(),i=O.parseHTML(this.heartbeat_data.newest),O.each(i,function(e,t){"LI"===t.nodeName&&O(t).hasClass("just-posted")&&O("#"+O(t).prop("id")).length&&O("#"+O(t).prop("id")).remove()}),(0<(i=O(e.delegateTarget).find(".activity-list .activity-item").first()).length&&i.hasClass("bb-pinned")?O(i).after(this.heartbeat_data.newest):O(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest)).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===s&&O(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===s&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),O(bp.Nouveau.objectNavParent+' [data-bp-scope="'+s+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[s]&&(this.heartbeat_data.highlights[s]=[]),setTimeout(function(){O(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+s+"_activity")},3e3),O(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()):O(e.currentTarget).hasClass("load-more")&&(t=+Number(this.current_page)+1,a=this,i="",e.preventDefault(),(o=O(e.currentTarget)).find("a").first().addClass("loading"),this.just_posted=[],O(e.delegateTarget).children(".just-posted").each(function(){a.just_posted.push(O(this).data("bp-activity-id"))}),O("#buddypress .dir-search input[type=search]").length&&(i=O("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:s,filter:d,search_terms:i,page:t,method:"append",exclude_just_posted:this.just_posted.join(","),target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(o.remove(),a.current_page=t,jQuery(window).scroll())})),O(".activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide()},hideComments:function(e){var a,i,o,e=O(e.target).find(".activity-comments");e.length&&e.each(function(e,t){o=O(t).children("ul").not(".conflict-activity-ul-li-comment"),(i=O(o).find("li").not(O(".document-action-class, .media-action-class, .video-action-class"))).length&&(O("body").hasClass("activity-singular")&&""!==window.location.hash&&O(window.location.hash).length&&0!==O(window.location.hash).closest(".activity-comments").length||(a=O(t).closest(".activity-item"),O("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html(),i.each(function(e,t){if(e<i.length-4){if(e||O(t).parent("ul").before('<div class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></div>"),window.location.hash&&"#"+O(t).attr("id")===window.location.hash)return O(t).parents("li.comment-item").show(),!1;O(t).addClass("bp-hidden").hide()}}),O(o).children(".bp-hidden").length===O(o).children("li").length-1&&O(o).find("li.show-all").length&&O(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle()))})},showActivity:function(e){e.preventDefault();var t=O(e.currentTarget).parent(),a=t.data("parent_comment_id"),t=O(t).data("activity_id");O(e.currentTarget).parents(".activity-comments").find(".ac-form").each(function(){var e=O(this);bp.Nouveau.Activity.resetActivityCommentForm(e,"hardReset")}),bp.Nouveau.Activity.launchActivityPopup(t,a)},closeComments:function(e){e.preventDefault();e=O(e.target).closest(".bb-activity-model-wrapper");e.closest("body").removeClass("acomments-modal-open"),e.hide(),e.find("ul.activity-list").empty()},scopeLoaded:function(e,a){this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(O.each(a.response.new_mentions,function(e,t){O("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&O.each(this.heartbeat_data.highlights[a.scope],function(e,t){O("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').length&&O("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",O.each(O(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,t){0===parseInt(O(t).html(),10)&&O(t).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),O(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){O("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),this.navigateToSpecificComment(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){var e,t;!_.isUndefined(BP_Nouveau.activity.params.is_activity_edit)&&0<BP_Nouveau.activity.params.is_activity_edit&&((t=O("#activity-"+BP_Nouveau.activity.params.is_activity_edit)).length&&(e=t.data("bp-activity"),t=""!==t.data("link-url")?t.data("link-url"):null,_.isUndefined(e)||bp.Nouveau.Activity.postForm.displayEditActivityForm(e,t)))},activityPrivacyChange:function(e){var t=e.data,a=O(e.target),i=O(e.currentTarget).closest(".activity-item"),o=i.data("bp-activity-id");if(e.preventDefault(),void 0===a.data("value")||""==O.trim(a.data("value")))return!1;i.find(".privacy").addClass("loading"),t.ajax({action:"activity_update_privacy",id:o,privacy:a.data("value")},"activity").done(function(e){i.find(".privacy").removeClass("loading"),!0===e.success&&(i.find(".activity-privacy li").removeClass("selected"),i.find(".privacy-wrap").attr("data-bp-tooltip",a.text()),a.addClass("selected"),i.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),i.find(".privacy").addClass(a.data("value")),void 0!==e&&void 0!==e.data&&void 0!==e.data.video_symlink&&(O(".document-description-wrap").length&&O(".document-description-wrap .bb-open-document-theatre").length&&(O(".document-description-wrap .bb-open-document-theatre").attr("data-video-preview",e.data.video_symlink),O(".document-description-wrap .bb-open-document-theatre").attr("data-extension",e.data.extension)),O(".document-description-wrap").length&&O(".document-detail-wrap.document-detail-wrap-description-popup").length&&(O(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-video-preview",e.data.video_symlink),O(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-extension",e.data.extension)),videojs(e.data.video_js_id).src({type:e.data.video_extension,src:e.data.video_symlink})))})},activityPrivacyRedirect:function(e){var t=O(e.target);if(e.preventDefault(),void 0===t.data("value")||""==O.trim(t.data("value")))return!1;window.location.href=t.data("value")},togglePrivacyDropdown:function(e){e.data,O(e.target);var t=O(e.currentTarget).closest(".activity-item");t.data("bp-activity-id");e.preventDefault(),O("ul.activity-privacy").not(t.find(".activity-privacy")).removeClass("bb-open"),t.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var s,a=e.data,r=O(e.target),n=O(e.currentTarget),l=n.data("bp-activity-id"),i=O(e.delegateTarget),c=n.find(".activity-state"),m=n.find(".comments-count"),p=this,t=0<r.closest("#activity-modal").length,o=0;if(!(r=O(r).is("span")||O(r).is("i")||O(r).is("img")?O(r).closest("a"):r).parent(".ac-emotion_btn")||r.hasClass("fav")||r.hasClass("unfav")||(o=r.parents(".ac-emotion_item").attr("data-reaction-id")),r.hasClass("fav")||r.hasClass("unfav")||0<o){if(e.preventDefault(),O("body").hasClass("bb-is-mobile")&&O("body").hasClass("bb-reactions-mode")&&0===r.closest(".ac-emotion_btn").length&&!0!==e.customTriggered)return;if((r=!O(r).is("a")?O(r).closest("a"):r).hasClass("loading"))return;r.addClass("loading");var d,u=r.hasClass("fav")?"fav":"unfav",v=!0,b="activity",f=r.parents(".acomment-display").first(),h=r.attr("data-reacted-id");if(0<o&&(u="fav"),r.parent(".ac-emotion_btn")&&(h=r.parents(".bp-generic-meta").find(".unfav").attr("data-reacted-id")),"fav"===u&&parseInt(o)===parseInt(h))return void r.removeClass("loading");0<f.length&&(v=!1,b="activity_comment");var y=v?(d=r.parents(".activity-item")).data("bp-activity-id"):(d=r.parents(".activity-comment").first()).data("bp-activity-comment-id"),f={action:"activity_mark_"+u,reaction_id:o,item_id:y,item_type:b};a.ajax(f,"activity").done(function(e){return!1===e.success?(r.removeClass("loading"),void alert(e.data)):(r.fadeOut(200,function(){"false"===O(this).attr("aria-pressed")?O(this).attr("aria-pressed","true"):O(this).attr("aria-pressed","false"),void 0!==e.data.reaction_count&&(v?(0<d.find(".activity-content .activity-state-reactions").length?d.find(".activity-content  .activity-state-reactions").replaceWith(e.data.reaction_count):d.find(".activity-content .activity-state").prepend(e.data.reaction_count),""!==e.data.reaction_count?c.addClass("has-likes"):c.removeClass("has-likes")):0<d.find("#acomment-display-"+y+" .comment-reactions .activity-state-reactions").length?d.find("#acomment-display-"+y+" .comment-reactions .activity-state-reactions").replaceWith(e.data.reaction_count):d.find("#acomment-display-"+y+" .comment-reactions").prepend(e.data.reaction_count)),e.data.reaction_button&&(v?d.find(".bp-generic-meta a.bp-like-button:first"):d.find("#acomment-display-"+y+" .bp-generic-meta a.bp-like-button")).replaceWith(e.data.reaction_button),d.find(".ac-emotions_list").removeClass("active"),O(this).fadeIn(200),r.removeClass("loading")}),void("fav"===u?void 0===e.data.directory_tab||""===e.data.directory_tab||O(a.objectNavParent+' [data-bp-scope="favorites"]').length||O(a.objectNavParent+' [data-bp-scope="all"]').after(e.data.directory_tab):"unfav"===u&&((t=O('[data-bp-user-scope="favorites"]').hasClass("selected")||O(a.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected"))&&n.remove(),void 0!==e.data.no_favorite&&(O(a.objectNavParent+' [data-bp-scope="all"]').length&&O(a.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?O(a.objectNavParent+' [data-bp-scope="favorites"]').remove():t&&i.append(e.data.no_favorite)))));var t}).fail(function(){r.removeClass("loading")})}if(r.hasClass("delete-activity")||r.hasClass("acomment-delete")||r.hasClass("spam-activity")||r.hasClass("spam-activity-comment")){var g,C,w,z,N=r.closest("[data-bp-activity-comment-id]"),P=N.data("bp-activity-comment-id"),j=0;if(e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;r.addClass("loading");var B={action:"delete_activity",id:l,_wpnonce:a.getLinkParams(r.prop("href"),"_wpnonce"),is_single:r.closest("[data-bp-single]").length};(r.hasClass("spam-activity")||r.hasClass("spam-activity-comment"))&&(B.action="bp_spam_activity"),g=n,P&&(delete B.is_single,B.id=P,B.is_comment=!0,g=N),a.ajax(B,"activity").done(function(e){if(r.removeClass("loading"),!1===e.success)g.prepend(e.data.feedback),g.find(".bp-feedback").hide().fadeIn(300);else{if(e.data.redirect)return window.location.href=e.data.redirect;var t;e.data.parent_activity_id&&e.data.activity&&O("#buddypress #activity-stream ul.activity-list li#activity-"+e.data.parent_activity_id).replaceWith(e.data.activity),P&&(j=1,n.append(N.find("form")),O.each(N.find("li.comment-item"),function(){j+=1}),C=c.find("span.comments-count"),w=C.text().length?C.text().match(/\d+/)[0]:0,w=Number(w-j),m.length&&(t=1<w?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,m.text(t.replace("%d",w))),(z=n.find("li.show-all a")).length&&z.html(BP_Nouveau.show_x_comments.replace("%d",w)),0===w&&(n.removeClass("has-comments"),c.removeClass("has-comments"),m.empty())),g.slideUp(300,function(){g.remove()}),P||n.data("bp-timestamp")!==a.Activity.heartbeat_data.last_recorded||(a.Activity.heartbeat_data.newest="",a.Activity.heartbeat_data.last_recorded=0),O(document).trigger("bp_activity_ajax_delete_request",O.extend(B,{response:e})),O(document).trigger("bp_activity_ajax_delete_request_video",O.extend(B,{response:e}))}})}if(r.closest("span").hasClass("activity-read-more")){var k=r.closest("div"),x=r.closest("span");if(y=null,O(k).hasClass("activity-inner")?y=l:O(k).hasClass("acomment-content")&&(y=r.closest("li").data("bp-activity-comment-id")),!y)return e;e.preventDefault(),O(x).addClass("loading"),a.ajax({action:"get_single_activity_content",id:y},"activity").done(function(e){"object"!=typeof e&&0<r.closest("div").find(".bb-activity-media-wrap").length&&(e=JSON.parse(e)),O(x).removeClass("loading"),k.parent().find(".bp-feedback").length&&k.parent().find(".bp-feedback").remove(),!1===e.success?(k.after(e.data.feedback),k.parent().find(".bp-feedback").hide().fadeIn(300)):(O(k).html(e.data.contents).slideDown(300),jQuery(window).scroll(),n.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+y))))})}if(r.hasClass("ac-form")&&r.hasClass("not-initialized")&&r.closest(".activity-item").find(".acomment-reply").eq(0).trigger("click"),r.hasClass("activity-state-comments")||r.hasClass("acomment-reply")||r.parent().hasClass("acomment-reply")||r.hasClass("acomment-edit")){if(r.parents(".activity-item").hasClass("bb-closed-comments"))return void e.preventDefault();var T,F;y=l,F=t?(T=O("#activity-modal").find("#ac-form-"+l),U=O("#activity-modal").find('[data-bp-activity-id="'+y+'"] .activity-comments'),"#activity-modal "):(T=O("#ac-form-"+l),U=O('[data-bp-activity-id="'+y+'"] .activity-comments'),"");b=!1;r.closest(".bb-media-model-container").length&&(T=r.closest(".bb-media-model-container").find("#ac-form-"+l),U=r.closest(".bb-media-model-container").find('[data-bp-activity-id="'+y+'"] .activity-comments')),r.closest(".activity-item").hasClass("has-comments")||r.closest(".activity-item").addClass("has-comments"),e.preventDefault(),p.resetActivityCommentForm(T,"hardReset"),r.parent().hasClass("acomment-reply")&&r.parent(),r.closest("li").data("bp-activity-comment-id")&&(y=r.closest("li").data("bp-activity-comment-id")),r.hasClass("acomment-edit")&&r.closest("li").data("bp-activity-comment")&&(b=r.closest("li").data("bp-activity-comment")),this.toggleMultiMediaOptions(T,r),T.removeClass("root"),O(".ac-form").addClass("not-initialized"),O.each(T.children("div"),function(e,t){O(t).hasClass("error")&&O(t).remove()}),r.hasClass("acomment-edit")&&!_.isNull(b)?((f=O('[data-bp-activity-comment-id="'+y+'"]')).find("#acomment-display-"+y).addClass("bp-hide"),f.find("#acomment-edit-form-"+y).append(T),T.addClass("acomment-edit").attr("data-item-id",y),p.editActivityCommentForm(T,b)):y===l?(U.append(T),T.addClass("root"),U.find(".acomment-display").removeClass("display-focus")):(t?O("#activity-modal").find('[data-bp-activity-comment-id="'+y+'"]'):O('[data-bp-activity-comment-id="'+y+'"]')).append(T),T.removeClass("not-initialized");var U=T.find(".post-elements-buttons-item.post-emoji").prevAll().not(":hidden").length+1;T.find(".post-elements-buttons-item.post-emoji").attr("data-nth-child",U);U=T.find(".post-elements-buttons-item.post-gif").prevAll().not(":hidden").length+1;T.find(".post-elements-buttons-item.post-gif").attr("data-nth-child",U);var A,U=T.find(".ac-input[contenteditable]");0<U.length&&(A=U.get(0),M=O(A).attr("id")+(O(A).closest(".bb-media-model-inner").length?"-theater":""),-1===O.inArray(M,p.InitiatedCommentForms)||O(A).closest("form").hasClass("events-initiated")||(U=p.InitiatedCommentForms.indexOf(M),p.InitiatedCommentForms.splice(U,1)),-1!=O.inArray(M,p.InitiatedCommentForms)||O(A).closest("form").hasClass("events-initiated")||(A.addEventListener("paste",function(e){e.preventDefault();e=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)}),A.addEventListener("input",function(e){var t=jQuery(e.currentTarget).html();k=(k=O.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),""!==jQuery(e.currentTarget).text().trim()||0<=k.indexOf("emojioneemoji")?jQuery(e.currentTarget).closest("form").addClass("has-content"):jQuery(e.currentTarget).closest("form").removeClass("has-content")}),O(A).closest("form").addClass("events-initiated"),p.InitiatedCommentForms.push(M))),r.attr("aria-expanded","true"),r.closest(".activity-comments").find(".acomment-display").removeClass("display-focus"),r.closest(".acomment-display").addClass("display-focus");var E,M={offset:-(O(window).height()/2-75),easing:"swing"};jQuery("body").hasClass("bb-is-mobile")?setTimeout(function(){var e=300<jQuery(window).height()?200:100;jQuery("html, body").animate({scrollTop:jQuery(A).offset().top-e},500)},500):(t?O(".bb-modal-activity-body"):O).scrollTo(T,500,M),O(F+"#ac-form-"+l+" #ac-input-"+l).focus(),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||void 0!==O(F+"#ac-input-"+l).data("emojioneArea")||(M=O(F+"#ac-input-"+l).html(),O(F+"#ac-input-"+l).emojioneArea({standalone:!0,hideSource:!1,container:F+"#ac-reply-emoji-button-"+l,autocomplete:!1,pickerPosition:"top",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){O(F+"#ac-input-"+l)[0].emojioneArea.hidePicker();var e=O(F+"#ac-form-"+l+" #ac-input-"+l),t=e.html();k=(k=O.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," "),""!==e.text()||0<=k.indexOf("emojioneemoji")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},picker_show:function(){O(this.button[0]).closest(".post-emoji").addClass("active")},picker_hide:function(){O(this.button[0]).closest(".post-emoji").removeClass("active")}}}),r.hasClass("acomment-edit")&&!_.isNull(b)&&O(F+"#ac-input-"+l).html(M)),void 0!==window.getSelection&&void 0!==document.createRange&&r.hasClass("acomment-edit")&&!_.isNull(b)&&((E=document.createRange()).selectNodeContents(O(F+"#ac-input-"+l)[0]),E.collapse(!1),(b=window.getSelection()).removeAllRanges(),b.addRange(E)),_.isUndefined(window.MediumEditor)||O(F+"#ac-input-"+l).hasClass("medium-editor-element")||(window.activity_comment_editor=new window.MediumEditor(O(F+"#ac-input-"+l)[0],{placeholder:!1,toolbar:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},keyboardCommands:!1,imageDragging:!1,anchorPreview:!1}))}if(r.hasClass("activity-state-no-comments")&&e.preventDefault(),r.hasClass("ac-reply-cancel")&&((E=O(r).closest(".ac-form")).addClass("not-initialized"),O(".acomment-reply").attr("aria-expanded","false"),p.destroyCommentMediaUploader(l),p.destroyCommentDocumentUploader(l),p.resetActivityCommentForm(E),e.preventDefault()),"ac_form_submit"===r.prop("name")){T=r.closest("form"),y=l,e.preventDefault(),r.closest("li").data("bp-activity-comment-id")&&(y=r.closest("li").data("bp-activity-comment-id"));for(var D,L=(D=O(T).find(".ac-input").first()).find("span.atwho-query"),G=0;G<L.length;G++)O(L[G]).replaceWith(L[G].innerText);D.find("img.emoji").each(function(e,t){O(t).addClass("emojioneemoji");var a=O(t).attr("alt");O(t).attr("data-emoji-char",a),O(t).removeClass("emoji")}),D.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),r.parent().addClass("loading").prop("disabled",!0),D.addClass("loading").prop("disabled",!0);var I=D[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""),R={action:"new_activity_comment",_wpnonce_new_activity_comment:O("#_wpnonce_new_activity_comment").val(),comment_id:y,form_id:l,content:I};O("#_bp_as_nonce_"+l).val()&&(R["_bp_as_nonce_"+l]=O("#_bp_as_nonce_"+l).val()),this.dropzone_media.length&&(R.media=this.dropzone_media),this.dropzone_document.length&&(R.document=this.dropzone_document),this.dropzone_video.length&&(R.video=this.dropzone_video,_.isEmpty(R.content)&&(R.content="&#8203;")),_.isUndefined(this.models[l])||(s=this.models[l],R.gif_data=this.models[l].get("gif_data")),R.content=R.content.replace(/&nbsp;/g," "),T.hasClass("acomment-edit")&&(R.edit_comment=!0),a.ajax(R,"activity").done(function(e){if(r.parent().removeClass("loading"),D.removeClass("loading"),O(".acomment-reply").attr("aria-expanded","false"),!1===e.success)T.append(O(e.data.feedback).hide().fadeIn(200));else{var t=T.parent(),a=O.trim(e.data.contents);t.find(".acomment-display").removeClass("display-focus"),T.addClass("not-initialized"),T.closest(".activity-comments").append(T),T.hasClass("acomment-edit")?(e=T.attr("data-item-id"),T.closest(".activity-comments").append(T),O("li#acomment-"+e).replaceWith(a)):(0===t.children("ul").length&&(t.hasClass("activity-comments")?t.prepend("<ul></ul>"):t.append("<ul></ul>")),t.children("ul").append(O(a).hide().fadeIn(200)),O(T).find(".ac-input").first().html(""),t.parent().addClass("has-comments"),t.parent().addClass("comments-loaded"),c.addClass("has-comments"));var t=T.find(".ac-reply-content");if(0<t.find(".ac-reply-toolbar .ac-reply-media-button").length&&t.find(".ac-reply-toolbar .ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),0<t.find(".ac-reply-toolbar .ac-reply-document-button").length&&t.find(".ac-reply-toolbar .ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),0<t.find(".ac-reply-toolbar .ac-reply-video-button").length&&t.find(".ac-reply-toolbar .ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),0<t.find(".ac-reply-toolbar .ac-reply-gif-button").length&&(t.find(".ac-reply-toolbar .ac-reply-gif-button").removeClass("active "),t.find(".ac-reply-toolbar .ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")),jQuery(window).scroll(),T.hasClass("acomment-edit")||(C=c.find("span.comments-count"),w=C.text().length?C.text().match(/\d+/)[0]:0,w=Number(w)+1,m.length&&(t=1<w?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,m.text(t.replace("%d",w||1))),(z=O(n).find(".show-all a"))&&z.html(BP_Nouveau.show_x_comments.replace("%d",w))),p.dropzone_media.length)for(var i=0;i<p.dropzone_media.length;i++)p.dropzone_media[i].saved=!0;if(p.dropzone_document.length)for(var o=0;o<p.dropzone_document.length;o++)p.dropzone_document[o].saved=!0;if(p.dropzone_video.length)for(var d=0;d<p.dropzone_video.length;d++)p.dropzone_video[d].saved=!0}_.isUndefined(s)||(s.set("gif_data",{}),O("#ac-reply-post-gif-"+l).find(".activity-attached-gif-container").removeAttr("style")),p.destroyCommentMediaUploader(l),p.destroyCommentDocumentUploader(l),p.destroyCommentVideoUploader(l),r.prop("disabled",!1),D.prop("disabled",!1)})}if(r.hasClass("edit")&&r.hasClass("edit-activity")&&(e.preventDefault(),I=n.data("bp-activity"),R=""!==n.data("link-url")?n.data("link-url"):null,void 0!==I&&(bp.Nouveau.Activity.postForm.displayEditActivityForm(I,R),r.closest("li").hasClass("groups")?O("#bp-nouveau-activity-form").addClass("group-activity"):O("#bp-nouveau-activity-form").removeClass("group-activity"),void 0!==bp.Nouveau.Media&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&(O(document).find(".bb-close-media-theatre").trigger("click"),O(document).find(".bb-close-document-theatre").trigger("click")))),r.hasClass("pin-activity")||r.hasClass("unpin-activity")){if(e.preventDefault(),!l)return e;r.closest(".activity-item").addClass("loading-pin");var S="pin";r.hasClass("unpin-activity")&&(S="unpin"),a.ajax({action:"activity_update_pinned_post",id:l,pin_action:S},"activity").done(function(e){var t,a,i,o,d,s,n;r.closest(".activity-item").removeClass("loading-pin"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(t=r.closest("#activity-stream > ul"),a=r.closest("#activity-stream"),e.success&&(i=bp.Nouveau.getStorage("bp-activity","scope"),d=o=!1,s="",r.closest("li.activity-item").hasClass("groups")&&(d=!0,s=(s=r.closest("li.activity-item").attr("class").match(/group-\d+/))[0].replace("group-","")),a.hasClass("single-user")?o=!1:(a.hasClass("activity")&&"all"===i&&!d||a.hasClass("single-group"))&&(o=!0),"pin"===S?(o&&t.find("li.activity-item").removeClass("bb-pinned"),n="li.activity-item:not(.groups)",d&&!a.hasClass("single-group")?n="li.activity-item.group-"+s:d&&a.hasClass("single-group")&&(n="li.activity-item"),t.find(n).each(function(){var e=O(this).find(".unpin-activity");e.removeClass("unpin-activity").addClass("pin-activity"),d?e.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):e.find("span").html(BP_Nouveau.activity.strings.pinPost)}),o&&r.closest("li.activity-item").addClass("bb-pinned"),r.addClass("unpin-activity"),r.removeClass("pin-activity"),r.closest("li.activity-item").hasClass("groups")?r.find("span").html(BP_Nouveau.activity.strings.unpinGroupPost):r.find("span").html(BP_Nouveau.activity.strings.unpinPost)):"unpin"===S&&(r.closest("li.activity-item").removeClass("bb-pinned"),r.addClass("pin-activity"),r.removeClass("unpin-activity"),r.closest("li.activity-item").hasClass("groups")?r.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):r.find("span").html(BP_Nouveau.activity.strings.pinPost)),"all"===i&&o&&(bp.Nouveau.Activity.heartbeat_data.last_recorded=0,bp.Nouveau.refreshActivities())),O(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>","success",null,!0]))}).fail(function(){r.closest(".activity-item").removeClass("loading-pin"),O(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.pinPostError+"</div>","error",null,!0])})}if(r.hasClass("bb-icon-bell-slash")||r.hasClass("bb-icon-bell")){if(e.preventDefault(),!l)return e;r.closest(".activity-item").addClass("loading-mute");var Q="mute";r.hasClass("bb-icon-bell")&&(Q="unmute"),a.ajax({action:"toggle_activity_notification_status",id:l,notification_toggle_action:Q},"activity").done(function(e){r.closest(".activity-item").removeClass("loading-mute"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(e.success&&("mute"===Q?(r.closest("li.activity-item").addClass("bb-muted"),r.removeClass("bb-icon-bell-slash"),r.addClass("bb-icon-bell"),r.find("span").html(BP_Nouveau.activity.strings.unmuteNotification)):"unmute"===Q&&(r.closest("li.activity-item").removeClass("bb-muted"),r.removeClass("bb-icon-bell"),r.addClass("bb-icon-bell-slash"),r.find("span").html(BP_Nouveau.activity.strings.muteNotification))),O(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>","success",null,!0]))}).fail(function(){r.closest(".activity-item").removeClass("loading-pin"),O(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.pinPostError+"</div>","error",null,!0])})}if(r.hasClass("close-activity-comment")||r.hasClass("unclose-activity-comment")){if(e.preventDefault(),!l)return e;r.closest(".activity-item").addClass("loading-pin");var V="close_comments";r.hasClass("unclose-activity-comment")&&(V="unclose_comments"),a.ajax({action:"activity_update_close_comments",id:l,close_comments_action:V},"activity").done(function(e){var t;r.closest(".activity-item").removeClass("loading-pin"),void 0!==(e="object"!=typeof e?JSON.parse(e):e).data&&void 0!==e.data.feedback&&(e.success&&(t=O("#activity-stream > .activity-list").find("[data-bp-activity-id="+l+"]"),r.closest(".activity-item").find(".bb-activity-closed-comments-notice").remove(),"close_comments"===V?(r.closest("li.activity-item").addClass("bb-closed-comments"),r.addClass("unclose-activity-comment"),r.removeClass("close-activity-comment"),r.find("span").html(BP_Nouveau.activity.strings.uncloseComments),r.closest("li.activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),r.closest(".activity-item").find(".activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"),0<r.parents(".bb-media-model-wrapper").length&&0<t.length&&(t.addClass("bb-closed-comments"),t.find(".bb-activity-more-options .close-activity-comment span").html(BP_Nouveau.activity.strings.uncloseComments),t.find(".bb-activity-more-options .close-activity-comment").addClass("unclose-activity-comment").removeClass("close-activity-comment"),t.find(".edit-activity, .acomment-edit").parents(".generic-button").hide(),t.find(".activity-comments").before('<div class="bb-activity-closed-comments-notice">'+e.data.feedback+"</div>"))):"unclose_comments"===V&&(r.closest("li.activity-item.bb-closed-comments").find(".edit-activity, .acomment-edit").parents(".generic-button").show(),r.closest("li.activity-item").removeClass("bb-closed-comments"),r.addClass("close-activity-comment"),r.removeClass("unclose-activity-comment"),r.find("span").html(BP_Nouveau.activity.strings.closeComments),0<r.parents(".bb-media-model-wrapper").length&&0<t.length&&(t.find(".edit-activity, .acomment-edit").parents(".generic-button").show(),t.removeClass("bb-closed-comments"),t.find(".bb-activity-more-options .unclose-activity-comment span").html(BP_Nouveau.activity.strings.closeComments),t.find(".bb-activity-more-options .unclose-activity-comment").addClass("close-activity-comment").removeClass("unclose-activity-comment"),t.find(".bb-activity-closed-comments-notice").html("")))),O(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>",e.success?"success":"error",null,!0]))}).fail(function(){r.closest(".activity-item").removeClass("loading-pin"),O(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.closeCommentsError+"</div>","error",null,!0])})}},commentFormAction:function(e){var t,a;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0!==e.altKey&&!0!==e.metaKey&&"TEXTAREA"===t.tagName&&O(t).hasClass("ac-input")?void(27===(a=e.keyCode||e.which)&&!1===e.ctrlKey?"TEXTAREA"===t.tagName&&O(t).closest("form").slideUp(200):e.ctrlKey&&13===a&&O(t).val()&&O(t).closest("form").find("[type=submit]").first().trigger("click")):e},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||O(t).hasClass("privacy-wrap")||O(t).parent().hasClass("privacy-wrap")?e:void O("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e,t=O(".load-more:visible").last(),a=O(window);t.closest(".activity-list").length&&t.get(0)&&!t.data("bp-autoloaded")&&(e=t.offset().top-50,a.scrollTop()+a.height()>e&&(t.data("bp-autoloaded",1),t.find("a").text(BP_Nouveau.activity.strings.loadingMore),t.find("a").trigger("click")))},destroyCommentMediaUploader:function(e){_.isNull(this.dropzone_obj)||(this.dropzone_obj.destroy(),O("#ac-reply-post-media-uploader-"+e).html(""),O("#ac-reply-post-media-uploader-1-"+e).html("")),this.dropzone_media=[],O("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed"),O("#ac-reply-media-button-"+e).removeClass("active")},destroyCommentDocumentUploader:function(e){_.isNull(this.dropzone_document_obj)||(this.dropzone_document_obj.destroy(),O("#ac-reply-post-document-uploader-"+e).html("")),this.dropzone_document=[],O("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed"),O("#ac-reply-document-button-"+e).removeClass("active")},destroyCommentVideoUploader:function(e){_.isNull(this.dropzone_video_obj)||(this.dropzone_video_obj.destroy(),O("#ac-reply-post-video-uploader-"+e).html("")),this.dropzone_video=[],O("#ac-reply-post-video-uploader-"+e).removeClass("open").addClass("closed"),O("#ac-reply-video-button-"+e).removeClass("active")},resetGifPicker:function(e){O("#ac-reply-gif-button-"+e).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open").empty(),O("#ac-reply-gif-button-"+e).removeClass("active"),_.isUndefined(this.models[e])||(this.models[e].set("gif_data",{}),O("#ac-reply-post-gif-"+e).find(".activity-attached-gif-container").removeAttr("style"))},openCommentsMediaUploader:function(e){var t,r=this,o=O(e.currentTarget),a=o.data("ac-id"),i=o.closest(".bp-ac-form-cotainer").find("#ac-reply-post-media-uploader-"+a),d=0<o.closest("#activity-modal").length?"#activity-modal ":"";e.preventDefault(),!i.hasClass("open")||e.isCustomEvent?(a=document.getElementsByClassName("ac-reply-post-default-template").length?document.getElementsByClassName("ac-reply-post-default-template")[0].innerHTML:"",void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,thumbnailWidth:140,thumbnailHeight:140,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:a,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},r.dropzone_obj=new Dropzone(d+"#ac-reply-post-media-uploader-"+o.data("ac-id"),t),r.dropzone_obj.on("addedfile",function(e){e.media_edit_data&&(r.dropzone_media.push(e.media_edit_data),(e=o.parents(".ac-reply-toolbar")).find(".ac-reply-media-button")&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"))}),r.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var i=o.parents(".ac-reply-toolbar"),a=o.closest(".ac-form");bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),a.addClass("has-media"),i.find(".ac-reply-document-button")&&i.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-video-button")&&i.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-gif-button")&&i.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),i.find(".ac-reply-media-button")&&i.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),r.dropzone_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),r.dropzone_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=O(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,r.dropzone_media.push(t.data),e.previewElement.classList.add("dz-success");var a,i,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],i=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<o;i++)a=d[i],s.push(a.textContent=n);return _.isNull(r.dropzone_obj.files)||0!==r.dropzone_obj.files.length||O(r.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),r.dropzone_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),r.dropzone_obj.on("error",function(e,t){var a;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?O(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&O(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):((a=o.closest(".ac-form")).find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+t+"</div>"),this.removeFile(e),a.removeClass("media-uploading"))}),r.dropzone_obj.on("removedfile",function(e){if(r.dropzone_media.length)for(var t in r.dropzone_media)if(e.upload.uuid==r.dropzone_media[t].uuid){void 0===r.dropzone_media[t].saved||r.dropzone_media[t].saved||bp.Nouveau.Media.removeAttachment(r.dropzone_media[t].id),r.dropzone_media.splice(t,1);break}var a,i;_.isNull(r.dropzone_obj)||_.isNull(r.dropzone_obj.files)||0!==r.dropzone_obj.files.length?o.closest(".ac-form").addClass("has-content"):(a=o.parents(".ac-reply-toolbar"),(i=o.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),O(r.dropzone_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),r.validateCommentContent(i.find(".ac-textarea").children(".ac-input")))}),r.dropzone_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),i.removeClass("closed").addClass("open")):(r.dropzone_obj&&void 0!==r.dropzone_obj&&r.dropzone_obj.destroy(),r.dropzone_media=[],i.html(""),i.addClass("closed").removeClass("open"))),t=e.currentTarget.id.match(/\d+$/)[0],this.destroyCommentDocumentUploader(t),this.destroyCommentVideoUploader(t),t=O(e.currentTarget).data("ac-id"),this.resetGifPicker(t),e.isCustomEvent||O(o).closest(".bp-ac-form-cotainer").find(".dropzone.media-dropzone").trigger("click")):i.trigger("click")},openCommentsDocumentUploader:function(e){var r=this,o=O(e.currentTarget),t=o.data("ac-id"),a=o.closest(".bp-ac-form-cotainer").find("#ac-reply-post-document-uploader-"+t),i=0<o.closest("#activity-modal").length?"#activity-modal ":"";if(e.preventDefault(),O(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(a.hasClass("open")&&!e.isCustomEvent)return void a.trigger("click")}else O(e.currentTarget).toggleClass("active");var t=document.getElementsByClassName("ac-reply-post-document-template").length?document.getElementsByClassName("ac-reply-post-document-template")[0].innerHTML:"";void 0!==window.Dropzone&&a.length&&(a.hasClass("closed")?(t={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:t,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation},r.dropzone_document_obj=new Dropzone(i+"#ac-reply-post-document-uploader-"+o.data("ac-id"),t),r.dropzone_document_obj.on("addedfile",function(e){e.document_edit_data&&r.dropzone_document.push(e.document_edit_data);var t=e.upload.filename,t=t.substr(t.lastIndexOf(".")+1);O(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass("bb-icon-file-"+t);t=o.parents(".ac-reply-toolbar");t.find(".ac-reply-document-button")&&t.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}),r.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);a=o.parents(".ac-reply-toolbar");o.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),r.dropzone_document_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),r.dropzone_document_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),r.dropzone_document_obj.on("success",function(e,t){if(t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=O(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,r.dropzone_document.push(t.data),e.previewElement.classList.add("dz-success");var a,i,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],i=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<o;i++)a=d[i],s.push(a.textContent=n);return _.isNull(r.dropzone_document_obj.files)||0!==r.dropzone_document_obj.files.length||O(r.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),r.dropzone_document_obj.on("error",function(e,t){var a;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?O(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&O(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):((a=o.closest(".ac-form")).find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+t+"</div>"),this.removeFile(e),a.removeClass("media-uploading"))}),r.dropzone_document_obj.on("removedfile",function(e){if(r.dropzone_document.length)for(var t in r.dropzone_document)if(e.upload.uuid==r.dropzone_document[t].uuid){void 0===r.dropzone_document[t].saved||r.dropzone_document[t].saved||bp.Nouveau.Media.removeAttachment(r.dropzone_document[t].id),r.dropzone_document.splice(t,1);break}var a,i;_.isNull(r.dropzone_document_obj)||_.isNull(r.dropzone_document_obj.files)||0!==r.dropzone_document_obj.files.length?o.closest(".ac-form").addClass("has-content"):(a=o.parents(".ac-reply-toolbar"),(i=o.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),O(r.dropzone_document_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),r.validateCommentContent(i.find(".ac-textarea").children(".ac-input")))}),r.dropzone_document_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),a.removeClass("closed").addClass("open")):(r.dropzone_document_obj&&r.dropzone_document_obj.destroy(),r.dropzone_document=[],a.html(""),a.addClass("closed").removeClass("open")));a=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(a),this.destroyCommentVideoUploader(a);a=O(e.currentTarget).data("ac-id");this.resetGifPicker(a),e.isCustomEvent||O(o).closest(".bp-ac-form-cotainer").find(".dropzone.document-dropzone").trigger("click")},openCommentsVideoUploader:function(e){var r=this,o=O(e.currentTarget),t=o.data("ac-id"),a=o.closest(".bp-ac-form-cotainer").find("#ac-reply-post-video-uploader-"+t),i=0<o.closest("#activity-modal").length?"#activity-modal ":"";if(e.preventDefault(),O(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(a.hasClass("open")&&!e.isCustomEvent)return void a.trigger("click")}else O(e.currentTarget).toggleClass("active");var t=document.getElementsByClassName("ac-reply-post-video-template").length?document.getElementsByClassName("ac-reply-post-video-template")[0].innerHTML:"";void 0!==window.Dropzone&&a.length&&(a.hasClass("closed")?(t={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:t,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation},r.dropzone_video_obj=new Dropzone(i+"#ac-reply-post-video-uploader-"+o.data("ac-id"),t),r.dropzone_video_obj.on("sending",function(e,t,a){a.append("action","video_upload"),a.append("_wpnonce",BP_Nouveau.nonces.video);a=o.parents(".ac-reply-toolbar");o.closest(".ac-form").addClass("has-media"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),r.dropzone_video_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.video.empty_video_type):t()}),r.dropzone_video_obj.on("addedfile",function(e){var t;e.video_edit_data&&(r.dropzone_video.push(e.video_edit_data),(t=o.parents(".ac-reply-toolbar")).find(".ac-reply-video-button")&&t.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")),e.dataURL&&e.video_edit_data.thumb.length?(O(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.video_edit_data.thumb+' " />'),O(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),r.dropzone_video_obj.on("uploadprogress",function(){o.closest(".ac-form").addClass("media-uploading"),bp.Nouveau.dropZoneGlobalProgress&&bp.Nouveau.dropZoneGlobalProgress(this)}),r.dropzone_video_obj.on("success",function(e,t){if(100===e.upload.progress&&(O(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,O(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),O(e.previewElement).closest(".dz-preview").addClass("dz-complete")),t.data.id)return e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=O(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,t.data.group_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,t.data.saved=!1,t.data.js_preview=O(e.previewElement).find(".dz-video-thumbnail img").attr("src"),r.dropzone_video.push(t.data),e.previewElement.classList.add("dz-success");var a,i,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],i=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<o;i++)a=d[i],s.push(a.textContent=n);return _.isNull(r.dropzone_video_obj.files)||0!==r.dropzone_video_obj.files.length||O(r.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),s}),r.dropzone_video_obj.on("error",function(e,t){var a;e.accepted?void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback?O(e.previewElement).find(".dz-error-message span").text(t.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&O(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error):((a=o.closest(".ac-form")).find(".ac-reply-content").after('<div class="bp-feedback bp-messages error">'+t+"</div>"),this.removeFile(e),a.removeClass("media-uploading"))}),r.dropzone_video_obj.on("removedfile",function(e){if(r.dropzone_video.length)for(var t in r.dropzone_video)if(e.upload.uuid==r.dropzone_video[t].uuid){void 0===r.dropzone_video[t].saved||r.dropzone_video[t].saved||bp.Nouveau.Media.removeAttachment(r.dropzone_video[t].id),r.dropzone_video.splice(t,1);break}var a,i;_.isNull(r.dropzone_video_obj)||_.isNull(r.dropzone_video_obj.files)||0!==r.dropzone_video_obj.files.length?o.closest(".ac-form").addClass("has-content"):(a=o.parents(".ac-reply-toolbar"),(i=o.closest(".ac-form")).removeClass("has-media"),a.find(".ac-reply-media-button")&&a.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-document-button")&&a.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-gif-button")&&a.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),a.find(".ac-reply-video-button")&&a.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),O(r.dropzone_video_obj.element).removeClass("files-uploaded dz-progress-view").find(".dz-global-progress").remove(),r.validateCommentContent(i.find(".ac-textarea").children(".ac-input")))}),r.dropzone_video_obj.on("complete",function(){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&0<this.files.length&&(o.closest(".ac-form").removeClass("media-uploading"),this.element.classList.add("files-uploaded"))}),a.removeClass("closed").addClass("open")):(r.dropzone_video_obj&&r.dropzone_video_obj.destroy(),r.dropzone_video=[],a.html(""),a.addClass("closed").removeClass("open")));a=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(a),this.destroyCommentDocumentUploader(a);a=O(e.currentTarget).data("ac-id");this.resetGifPicker(a),e.isCustomEvent||O(o).closest(".bp-ac-form-cotainer").find(".dropzone.video-dropzone").trigger("click")},openGifPicker:function(e){e.preventDefault();var t=e.currentTarget,a=0<O(t).closest("#activity-modal").length?"#activity-modal ":"",i=O(t).next(),o=t.id.match(/\d+$/)[0],d=O(a+"#ac-reply-post-gif-"+o);i.is(":empty")&&(s=new bp.Models.ACReply,e=new bp.Views.GifMediaSearchDropdown({model:s}),a=new bp.Views.ActivityAttachedGifPreview({model:s}),i.html(e.render().el),d.html(a.render().el),this.models[o]=s);var s=O(t).parents(".ac-textarea ").find(".ac-reply-attachments .activity-attached-gif-container");O(t).hasClass("active")&&s.length&&""==O.trim(s.html())?O(t).removeClass("active"):O(t).addClass("active"),i.toggleClass("open"),this.destroyCommentMediaUploader(o),this.destroyCommentDocumentUploader(o),this.destroyCommentVideoUploader(o)},toggleMultiMediaOptions:function(e,t){var a,i;_.isUndefined(BP_Nouveau.media)||(a=t.closest(".activity-item"),i=t.closest(".activity-item").data("bp-activity"),t.closest("li").data("bp-activity-comment")&&(i=t.closest("li").data("bp-activity-comment")),t.closest("li").hasClass("groups")||a.hasClass("groups")?(_.isUndefined(i.group_media)?!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.group_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(i.group_document)?!1===BP_Nouveau.media.group_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.group_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(i.group_video)?!1===BP_Nouveau.media.group_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===i.group_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(_.isNull(i)||_.isUndefined(i.profile_media)?!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isNull(i)||_.isUndefined(i.profile_document)?!1===BP_Nouveau.media.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isNull(i)||_.isUndefined(i.profile_video)?!1===BP_Nouveau.media.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===i.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")))},fixAtWhoActivity:function(){O(".acomment-content, .activity-content").each(function(){for(var e=O(this).find("span.atwho-query"),t=0;t<e.length;t++)O(e[t]).replaceWith(e[t].innerText)})},toggleActivityOption:function(e){!O(e.target).hasClass("bb-activity-more-options-action")&&!O(e.target).parent().hasClass("bb-activity-more-options-action")||O(e.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").hasClass("is_visible open")?(O(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible open"),O("body").removeClass("more_option_open")):(O(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible open"),O(e.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").addClass("is_visible open"),O("body").addClass("more_option_open"))},navigateToSpecificComment:function(){setTimeout(function(){var e,t;window.location.hash&&(e=window.location.hash,t=0!==O("#wpadminbar").length?O("#wpadminbar").innerHeight():0,0<O(e).length&&O("html, body").animate({scrollTop:parseInt(O(e).offset().top)-(80+t)},0))},200)},createThumbnailFromUrl:function(t){var a=this;a.dropzone_obj.createThumbnailFromUrl(t,a.dropzone_obj.options.thumbnailWidth,a.dropzone_obj.options.thumbnailHeight,a.dropzone_obj.options.thumbnailMethod,!0,function(e){a.dropzone_obj.emit("thumbnail",t,e),a.dropzone_obj.emit("complete",t)})},editActivityCommentForm:function(e,t){var a=e.find('input[name="comment_form_id"]').val(),i=e.find("#ac-reply-toolbar-"+a),o=e.find('input[name="ac_form_submit"]'),d=this;e.find("#ac-input-"+a).html(t.content);var s,n,r=o.attr("data-add-edit-label");if(o.attr("data-add-edit-label",o.val()).val(r),void 0!==t.media&&0<t.media.length){i.find(".ac-reply-media-button").trigger({type:"click",isCustomEvent:!0}),d.disabledCommentDocumentUploader(i),d.disabledCommentVideoUploader(i),d.disabledCommentGifPicker(i);for(var l=t.media.length,c=0;c<l;c++){var m={},m=0<parseInt(t.id)?{id:t.media[c].attachment_id,media_id:t.media[c].id,name:t.media[c].name,thumb:t.media[c].thumb,url:t.media[c].url,uuid:t.media[c].attachment_id,menu_order:t.media[c].menu_order,album_id:t.media[c].album_id,group_id:t.media[c].group_id,saved:!0}:{id:t.media[c].id,name:t.media[c].name,thumb:t.media[c].thumb,url:t.media[c].url,uuid:t.media[c].id,menu_order:t.media[c].menu_order,album_id:t.media[c].album_id,group_id:t.media[c].group_id,saved:!1};m={name:t.media[c].name,accepted:!0,kind:"image",upload:{filename:t.media[c].name,uuid:t.media[c].attachment_id},dataURL:t.media[c].url,id:t.media[c].attachment_id,media_edit_data:m},d.dropzone_obj&&(d.dropzone_obj.files.push(m),d.dropzone_obj.emit("addedfile",m),d.createThumbnailFromUrl(m),d.dropzone_obj.emit("dz-success"),d.dropzone_obj.emit("dz-complete"))}}if(void 0!==t.document&&0<t.document.length){i.find(".ac-reply-document-button").trigger({type:"click",isCustomEvent:!0}),d.disabledCommentMediaUploader(i),d.disabledCommentVideoUploader(i),d.disabledCommentGifPicker(i);for(var p=t.document.length,u=0;u<p;u++){var v={},v=0<parseInt(t.id)?{id:t.document[u].doc_id,name:t.document[u].full_name,full_name:t.document[u].full_name,type:"document",url:t.document[u].url,size:t.document[u].size,uuid:t.document[u].doc_id,document_id:t.document[u].id,menu_order:t.document[u].menu_order,folder_id:t.document[u].folder_id,group_id:t.document[u].group_id,saved:!0,svg_icon:_.isUndefined(t.document[u].svg_icon)?"":t.document[u].svg_icon}:{id:t.document[u].id,name:t.document[u].full_name,full_name:t.document[u].full_name,type:"document",url:t.document[u].url,size:t.document[u].size,uuid:t.document[u].id,menu_order:t.document[u].menu_order,folder_id:t.document[u].folder_id,group_id:t.document[u].group_id,saved:!1,svg_icon:_.isUndefined(t.document[u].svg_icon)?"":t.document[u].svg_icon};v={name:t.document[u].full_name,size:t.document[u].size,accepted:!0,kind:"file",upload:{filename:t.document[u].full_name,uuid:t.document[u].doc_id},dataURL:t.document[u].url,id:t.document[u].doc_id,document_edit_data:v,svg_icon:_.isUndefined(t.document[u].svg_icon)?"":t.document[u].svg_icon},d.dropzone_document_obj&&(d.dropzone_document_obj.files.push(v),d.dropzone_document_obj.emit("addedfile",v),d.dropzone_document_obj.emit("complete",v))}}if(void 0!==t.video&&0<t.video.length){i.find(".ac-reply-video-button").trigger({type:"click",isCustomEvent:!0}),d.disabledCommentMediaUploader(i),d.disabledCommentDocumentUploader(i),d.disabledCommentGifPicker(i);for(var b=t.video.length,f=0;f<b;f++){var h={},h=0<parseInt(t.id)?{id:t.video[f].vid_id,name:t.video[f].name,type:"video",thumb:t.video[f].thumb,url:t.video[f].url,size:t.video[f].size,uuid:t.video[f].vid_id,video_id:t.video[f].id,menu_order:t.video[f].menu_order,album_id:t.video[f].album_id,group_id:t.video[f].group_id,saved:!0}:{id:t.video[f].id,name:t.video[f].name,type:"video",thumb:t.video[f].thumb,url:t.video[f].url,size:t.video[f].size,uuid:t.video[f].id,menu_order:t.video[f].menu_order,album_id:t.video[f].album_id,group_id:t.video[f].group_id,saved:!1};h={name:t.video[f].name,size:t.video[f].size,accepted:!0,kind:"file",upload:{filename:t.video[f].name,uuid:t.video[f].vid_id},dataURL:t.video[f].url,id:t.video[f].vid_id,video_edit_data:h},console.log(h),console.log(d.dropzone_video_obj),d.dropzone_video_obj&&(d.dropzone_video_obj.files.push(h),d.dropzone_video_obj.emit("addedfile",h),d.dropzone_video_obj.emit("complete",h))}}void 0!==t.gif&&0<Object.keys(t.gif).length&&(s=i.find(".ac-reply-gif-button").next(),n=O("#ac-reply-post-gif-"+a),i.find(".ac-reply-gif-button").trigger("click"),d.disabledCommentMediaUploader(i),d.disabledCommentDocumentUploader(i),d.disabledCommentVideoUploader(i),o=new bp.Models.ACReply,r=new bp.Views.GifMediaSearchDropdown({model:o}),i=new bp.Views.ActivityAttachedGifPreview({model:o}),r.model.set("gif_data",t.gif),s.html(r.render().el),n.html(i.render().el),this.models[a]=o),void 0===t.media&&void 0===t.document&&void 0===t.video&&void 0===t.gif&&e.find(".ac-reply-toolbar .post-elements-buttons-item").removeClass("disable")},resetActivityCommentForm:function(e,t=""){var a,i,o;!e.hasClass("acomment-edit")&&"hardReset"!==t||(a=e.find('input[name="comment_form_id"]').val(),o=e.attr("data-item-id"),i=O('[data-bp-activity-comment-id="'+o+'"]'),t=e.find('input[name="ac_form_submit"]'),i.find("#acomment-display-"+o).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id"),o=t.attr("data-add-edit-label"),t.attr("data-add-edit-label",t.val()).val(o),e.find("#ac-input-"+a).html(""),e.removeClass("has-content"),this.destroyCommentMediaUploader(a),this.destroyCommentDocumentUploader(a),this.destroyCommentVideoUploader(a),this.resetGifPicker(a))},disabledCommentMediaUploader:function(e){e.find(".ac-reply-media-button")&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentDocumentUploader:function(e){e.find(".ac-reply-document-button")&&e.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentVideoUploader:function(e){e.find(".ac-reply-video-button")&&e.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentGifPicker:function(e){e.find(".ac-reply-gif-button")&&e.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")},validateCommentContent:function(e){var t=e.html(),t=(t=O.trim(t.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""))).replace(/&nbsp;/g," ");""!==e.text().trim()||0<=t.indexOf("emojioneemoji")?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},ReactionStatePopupTab:function(e){e.preventDefault(),O(this).closest(".activity-state-popup").find(".activity-state-popup_tab_panel li a").removeClass("active"),O(this).addClass("active"),O(this).closest(".activity-state-popup").find(".activity-state-popup_tab_content .activity-state-popup_tab_item").removeClass("active"),O(this).closest(".activity-state-popup").find("."+O(this).data("tab")).addClass("active")},closeActivityState:function(){O(".activity-state-popup").hide().removeClass("active")},launchActivityPopup:function(e,t){var a=O("#activity-"+e),i=O(".bb-activity-model-wrapper"),e=a[0].outerHTML,a='[data-parent_comment_id="'+t+'"]';i.closest("body").addClass("acomments-modal-open"),i.show(),i.find("ul.activity-list").html(e);t=i.find(".bb-activity-more-options-wrap").find(".bb-activity-more-options-action"),e=i.find(".privacy-wrap");t.attr("data-balloon-pos","left"),e.attr("data-bp-tooltip-pos","right"),i.find(a).children(".acomments-view-more").first().trigger("click")},viewMoreComments:function(e){e.preventDefault();var t=O(e.currentTarget).parent(),a=O(t).data("activity_id"),i=O(t).data("parent_comment_id"),o="",d=O(e.currentTarget);d.addClass("loading").removeClass("bp-hide"),d.html(`<div id="bp-ajax-loader">
					<div class="bb-activity-placeholder bb-activity-tiny-placeholder">
						<div class="bb-activity-placeholder_head">
							<div class="bb-activity-placeholder_avatar bb-bg-animation bb-loading-bg"></div>
							<div class="bb-activity-placeholder_details">
								<div class="bb-activity-placeholder_title bb-bg-animation bb-loading-bg"></div>
								<div class="bb-activity-placeholder_description bb-bg-animation bb-loading-bg"></div>
							</div>
						</div>
					</div>
				</div>`);t={action:"activity_loadmore_comments",activity_id:a,parent_comment_id:i,activity_type_is_blog:1<O(e.currentTarget).parents(".entry-content").length};0<O(e.currentTarget).prev("li.activity-comment").length&&(o=O(e.currentTarget).prev("li.activity-comment").data("bp-timestamp"),t.last_comment_timestamp=o),bp.Nouveau.ajax(t,"activity").done(function(e){var t;!1===e.success?d.html("").removeClass("loading"):void 0!==e.data&&void 0!==e.data.comments&&(t=O(".bb-internal-model .activity-comments").find("[data-activity_id='"+a+"'][data-parent_comment_id='"+i+"']"),e=O(O.parseHTML(e.data.comments)),0<t.length&&0<e.length&&(e.each(function(){var e;"LI"===this.nodeName&&"undefined"!==this.id&&""!==this.id&&(e=this.id,0<(e=t.children("#"+e)).length&&e.remove())}),""!==o?t.find("li.activity-comment[data-bp-timestamp='"+o+"']").after(e):0<t.children(".activity-comment.comment-item").length?t.children(".activity-comment.comment-item").first().before(e):t.html(e)),d.remove())}).fail(function(){d.html("").removeClass("loading")})},autoloadMoreComments:function(){var e,t,a,i,o;0<O(".bb-activity-model-wrapper").length&&"none"!==O(".bb-activity-model-wrapper").css("display")&&(e=O(".bb-modal-activity-body .activity-comments > ul > li.acomments-view-more:not(.loading)"),o=O(".bb-activity-model-wrapper .bb-modal-activity-body"),0<e.length&&0<o.length&&(t=O(e).offset().top,i=(a=O(o).scrollTop())+O(o).height(),(o=t-O(o).offset().top+a)<i&&o+O(e).outerHeight()>a&&O(e).trigger("click").addClass("loading")))}},bp.Nouveau.Activity.start())}((bp,jQuery));