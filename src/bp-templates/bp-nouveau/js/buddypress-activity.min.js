window.bp=window.bp||{};(function(a,b){if(typeof BP_Nouveau==="undefined"){return}bp.Nouveau=bp.Nouveau||{};bp.Models=bp.Models||{};bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}});bp.Nouveau.Activity={start:function(){this.setupGlobals();this.addListeners()},setupGlobals:function(){this.just_posted=[];this.current_page=1;this.mentions_count=Number(b(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0;this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:b(document).prop("title")};if(typeof window.Dropzone!=="undefined"&&typeof BP_Nouveau.media!=="undefined"){window.Dropzone.autoDiscover=false;this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.media.maxFiles!=="undefined"?BP_Nouveau.media.maxFiles:10,maxFilesize:typeof BP_Nouveau.media.max_upload_size!=="undefined"?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,};if(typeof BP_Nouveau.media.dropzone_options!=="undefined"){Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options)}}this.dropzone_obj=null;this.dropzone_media=[];this.dropzone_document_obj=null;this.dropzone_document=[];this.dropzone_video_obj=null;this.dropzone_video=[];this.models=[]},addListeners:function(){if(!b("body").hasClass("activity-singular")){b("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this))}b("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this));b('#buddypress [data-bp-list="activity"]').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this));b("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this));b('#buddypress [data-bp-list="activity"]').on("bp_ajax_append",this.hideComments);b('#buddypress [data-bp-list="activity"]').on("click",".show-all",this.showComments);b('#buddypress [data-bp-list="activity"]').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this));b('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this));b('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this));b('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this));b("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this));b(document).keydown(this.commentFormAction);b(document).click(this.togglePopupDropdown);b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this));b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this));b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-video-button",this.openCommentsVideoUploader.bind(this));b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this));b(document).on("click",this.toggleActivityOption.bind(this));if(!_.isUndefined(BP_Nouveau.activity.params.autoload)){b(window).scroll(this.loadMoreActivities)}},heartbeatSend:function(c,d){this.heartbeat_data.first_recorded=b("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0;if(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded){this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded}d.bp_activity_last_recorded=this.heartbeat_data.last_recorded;if(b("#buddypress .dir-search input[type=search]").length){d.bp_activity_last_recorded_search_terms=b("#buddypress .dir-search input[type=search]").val()}b.extend(d,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(c,d){var h,f,i=bp.Nouveau.objects,j=bp.Nouveau.getStorage("bp-activity","scope"),k=this;if(undefined===d||!d.bp_activity_newest_activities){return}this.heartbeat_data.newest=b.trim(d.bp_activity_newest_activities.activities)+this.heartbeat_data.newest;this.heartbeat_data.last_recorded=Number(d.bp_activity_newest_activities.last_recorded);f=b(this.heartbeat_data.newest).filter(".activity-item");h=Number(f.length);i.push("mentions");if("all"===j){b.each(f,function(l,m){m=b(m);b.each(i,function(p,n){if(-1!==b.inArray("bp-my-"+n,m.get(0).classList)){if(undefined===k.heartbeat_data.highlights[n]){k.heartbeat_data.highlights[n]=[m.data("bp-activity-id")]}else{if(-1===b.inArray(m.data("bp-activity-id"),k.heartbeat_data.highlights[n])){k.heartbeat_data.highlights[n].push(m.data("bp-activity-id"))}}}})});var g=new RegExp("bp-my-("+i.join("|")+")","g");this.heartbeat_data.newest=this.heartbeat_data.newest.replace(g,"");b(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(h)}else{this.heartbeat_data.highlights[j]=[];b.each(f,function(l,m){k.heartbeat_data.highlights[j].push(b(m).data("bp-activity-id"))})}b.each(i,function(n,l){if(undefined!==k.heartbeat_data.highlights[l]&&k.heartbeat_data.highlights[l].length){var m=0;if("mentions"===l){m=k.mentions_count}b(bp.Nouveau.objectNavParent+' [data-bp-scope="'+l+'"]').find("a span").html(Number(k.heartbeat_data.highlights[l].length)+m)}});i.pop();b(document).prop("title","("+h+") "+this.heartbeat_data.document_title);if(b('#buddypress [data-bp-list="activity"] li').first().hasClass("load-newest")){var e=b('#buddypress [data-bp-list="activity"] .load-newest a').html();b('#buddypress [data-bp-list="activity"] .load-newest a').html(e.replace(/([0-9]+)/,h))}else{b('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+h+")</a></li>")}b('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click");b('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data);if(typeof bp.Nouveau!=="undefined"){bp.Nouveau.reportPopUp()}},injectActivities:function(c){var g=bp.Nouveau.getStorage("bp-activity"),j=g.scope||null,d=g.filter||null;if(b(c.currentTarget).hasClass("load-newest")){c.preventDefault();b(c.currentTarget).remove();var e=b.parseHTML(this.heartbeat_data.newest);b.each(e,function(l,m){if("LI"===m.nodeName&&b(m).hasClass("just-posted")){if(b("#"+b(m).prop("id")).length){b("#"+b(m).prop("id")).remove()}}});b(c.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data);this.heartbeat_data.newest="";if("all"===j){b(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html("")}if("mentions"===j){bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity");this.mentions_count=0}b(bp.Nouveau.objectNavParent+' [data-bp-scope="'+j+'"]').find("a span").html("");if(undefined!==this.heartbeat_data.highlights[j]){this.heartbeat_data.highlights[j]=[]}setTimeout(function(){b(c.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+j+"_activity")},3000);b(document).prop("title",this.heartbeat_data.document_title);jQuery(window).scroll()}else{if(b(c.currentTarget).hasClass("load-more")){var f=(Number(this.current_page)*1)+1,k=this,h="";c.preventDefault();var i=b(c.currentTarget);i.find("a").first().addClass("loading");this.just_posted=[];b(c.delegateTarget).children(".just-posted").each(function(){k.just_posted.push(b(this).data("bp-activity-id"))});if(b("#buddypress .dir-search input[type=search]").length){h=b("#buddypress .dir-search input[type=search]").val()}bp.Nouveau.objectRequest({object:"activity",scope:j,filter:d,search_terms:h,page:f,method:"append",exclude_just_posted:this.just_posted.join(","),target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(l){if(true===l.success){i.remove();k.current_page=f;jQuery(window).scroll()}})}}},hideComments:function(d){var g=b(d.target).find(".activity-comments"),f,e,c,h;if(!g.length){return}g.each(function(j,i){h=b(i).children("ul").not(".conflict-activity-ul-li-comment");e=b(h).find("li").not(b(".document-action-class, .media-action-class, .video-action-class"));if(!e.length){return}f=b(i).closest(".activity-item");c=b("#acomment-comment-"+f.data("bp-activity-id")+" span.comment-count").html()||" ";e.each(function(k,l){if(k<e.length-4){b(l).addClass("bp-hidden").hide();if(!k){b(l).before('<li class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+f.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></li>")}}});if(b(h).children(".bp-hidden").length===b(h).children("li").length-1&&b(h).find("li.show-all").length){b(h).children("li:not(.show-all)").removeClass("bp-hidden").toggle()}})},showComments:function(c){c.preventDefault();b(c.target).addClass("loading");setTimeout(function(){b(c.target).closest("ul").find("li").removeClass("bp-hidden").fadeIn(300,function(){b(c.target).parent("li").remove()})},600)},scopeLoaded:function(c,d){this.hideComments(c);this.current_page=1;if("mentions"===d.scope&&undefined!==d.response.new_mentions){b.each(d.response.new_mentions,function(e,f){b("#buddypress #activity-stream").find('[data-bp-activity-id="'+f+'"]').addClass("newest_mentions_activity")});this.mentions_count=0}else{if(undefined!==this.heartbeat_data.highlights[d.scope]&&this.heartbeat_data.highlights[d.scope].length){b.each(this.heartbeat_data.highlights[d.scope],function(e,f){if(b("#buddypress #activity-stream").find('[data-bp-activity-id="'+f+'"]').length){b("#buddypress #activity-stream").find('[data-bp-activity-id="'+f+'"]').addClass("newest_"+d.scope+"_activity")}})}}this.heartbeat_data.newest="";b.each(b(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,f){if(0===parseInt(b(f).html(),10)){b(f).html("")}});if(undefined!==this.heartbeat_data.highlights[d.scope]){this.heartbeat_data.highlights[d.scope]=[]}b(document).prop("title",this.heartbeat_data.document_title);setTimeout(function(){b("#buddypress #activity-stream .activity-item").removeClass("newest_"+d.scope+"_activity")},3000);if(typeof window.instgrm!=="undefined"){window.instgrm.Embeds.process()}if(typeof window.FB!=="undefined"&&typeof window.FB.XFBML!=="undefined"){window.FB.XFBML.parse()}this.fixAtWhoActivity();this.openEditActivityPopup();setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){if(!_.isUndefined(BP_Nouveau.activity.params.is_activity_edit)&&0<BP_Nouveau.activity.params.is_activity_edit){var c=b("#activity-"+BP_Nouveau.activity.params.is_activity_edit);if(c.length){var d=c.data("bp-activity");if(!_.isUndefined(d)){bp.Nouveau.Activity.postForm.displayEditActivityForm(d)}}}},activityPrivacyChange:function(e){var d=e.data,g=b(e.target),f=b(e.currentTarget).closest(".activity-item"),c=f.data("bp-activity-id");e.preventDefault();if(typeof g.data("value")==="undefined"||b.trim(g.data("value"))==""){return false}f.find(".privacy").addClass("loading");d.ajax({action:"activity_update_privacy",id:c,privacy:g.data("value")},"activity").done(function(h){f.find(".privacy").removeClass("loading");if(true===h.success){f.find(".activity-privacy li").removeClass("selected");f.find(".privacy-wrap").attr("data-bp-tooltip",g.text());g.addClass("selected");f.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends");f.find(".privacy").addClass(g.data("value"));if(typeof h!=="undefined"&&typeof h.data!=="undefined"&&typeof h.data.video_symlink!=="undefined"){if(b(".document-description-wrap").length&&b(".document-description-wrap .bb-open-document-theatre").length){b(".document-description-wrap .bb-open-document-theatre").attr("data-video-preview",h.data.video_symlink);b(".document-description-wrap .bb-open-document-theatre").attr("data-extension",h.data.extension)}if(b(".document-description-wrap").length&&b(".document-detail-wrap.document-detail-wrap-description-popup").length){b(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-video-preview",h.data.video_symlink);b(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-extension",h.data.extension)}var i=videojs(h.data.video_js_id);i.src({type:h.data.video_extension,src:h.data.video_symlink})}}})},activityPrivacyRedirect:function(c){var d=b(c.target);c.preventDefault();if(typeof d.data("value")==="undefined"||b.trim(d.data("value"))==""){return false}else{window.location.href=d.data("value")}},togglePrivacyDropdown:function(e){var d=e.data,g=b(e.target),f=b(e.currentTarget).closest(".activity-item"),c=f.data("bp-activity-id");e.preventDefault();b("ul.activity-privacy").not(f.find(".activity-privacy")).removeClass("bb-open");f.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(E){var s=E.data,K=b(E.target),w=b(E.currentTarget),u=w.data("bp-activity-id"),n=b(E.delegateTarget),x=w.find(".activity-state"),I=w.find(".comments-count"),G=w.find(".like-text"),D,g,l,B=this;if(b(K).is("span")){K=b(K).closest("a")}if(K.hasClass("fav")||K.hasClass("unfav")){var k=K.hasClass("fav")?"fav":"unfav";E.preventDefault();K.addClass("loading");s.ajax({action:"activity_mark_"+k,id:u},"activity").done(function(i){K.removeClass("loading");if(false===i.success){return}else{K.fadeOut(200,function(){if(b(this).find("span").first().length){b(this).find("span").first().html(i.data.content)}else{b(this).html(i.data.content)}if("false"===b(this).attr("aria-pressed")){b(this).attr("aria-pressed","true")}else{b(this).attr("aria-pressed","false")}if(G.length){i.data.like_count?G.text(i.data.like_count)&&x.addClass("has-likes"):G.empty()&&x.removeClass("has-likes");var N=b("<textarea/>").html(i.data.tooltip).text();G.attr("data-hint",N)}if(b(this).find(".like-count").length){b(this).find(".like-count").html(i.data.content)}b(this).fadeIn(200)})}if("fav"===k){if(undefined!==i.data.directory_tab){if(!b(s.objectNavParent+' [data-bp-scope="favorites"]').length){b(s.objectNavParent+' [data-bp-scope="all"]').after(i.data.directory_tab)}}K.removeClass("fav");K.addClass("unfav")}else{if("unfav"===k){var M=b('[data-bp-user-scope="favorites"]').hasClass("selected")||b(s.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected");if(M){w.remove()}if(undefined!==i.data.no_favorite){if(b(s.objectNavParent+' [data-bp-scope="all"]').length&&b(s.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")){b(s.objectNavParent+' [data-bp-scope="favorites"]').remove()}else{if(M){n.append(i.data.no_favorite)}}}K.removeClass("unfav");K.addClass("fav")}}})}if(K.hasClass("delete-activity")||K.hasClass("acomment-delete")||K.hasClass("spam-activity")||K.hasClass("spam-activity-comment")){var f=K.closest("[data-bp-activity-comment-id]"),j=f.data("bp-activity-comment-id"),h,r,z,p,e=0;E.preventDefault();if(undefined!==BP_Nouveau.confirm&&false===window.confirm(BP_Nouveau.confirm)){return false}K.addClass("loading");var m={action:"delete_activity",id:u,_wpnonce:s.getLinkParams(K.prop("href"),"_wpnonce"),is_single:K.closest("[data-bp-single]").length};if(K.hasClass("spam-activity")||K.hasClass("spam-activity-comment")){m.action="bp_spam_activity"}h=w;if(j){delete m.is_single;m.id=j;m.is_comment=true;h=f}s.ajax(m,"activity").done(function(i){K.removeClass("loading");if(false===i.success){h.prepend(i.data.feedback);h.find(".bp-feedback").hide().fadeIn(300)}else{if(i.data.redirect){return window.location.href=i.data.redirect}if(i.data.parent_activity_id&&i.data.activity){b("#buddypress #activity-stream ul.activity-list li#activity-"+i.data.parent_activity_id).replaceWith(i.data.activity)}if(j){e=1;w.append(f.find("form"));b.each(f.find("li.comment-item"),function(){e+=1});r=x.find("span.comments-count");z=r.text().length?r.text().match(/\d+/)[0]:0;z=Number(z-e);if(I.length){var M=z>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;I.text(M.replace("%d",z))}p=w.find("li.show-all a");if(p.length){p.html(BP_Nouveau.show_x_comments.replace("%d",z))}if(0===z){w.removeClass("has-comments");x.removeClass("has-comments");I.empty()}}h.slideUp(300,function(){h.remove()});if(!j&&w.data("bp-timestamp")===s.Activity.heartbeat_data.last_recorded){s.Activity.heartbeat_data.newest="";s.Activity.heartbeat_data.last_recorded=0}b(document).trigger("bp_activity_ajax_delete_request",b.extend(m,{response:i}));b(document).trigger("bp_activity_ajax_delete_request_video",b.extend(m,{response:i}))}})}if(K.closest("span").hasClass("activity-read-more")){var C=K.closest("div"),v=K.closest("span");D=null;if(b(C).hasClass("activity-inner")){D=u}else{if(b(C).hasClass("acomment-content")){D=K.closest("li").data("bp-activity-comment-id")}}if(!D){return E}E.preventDefault();b(v).addClass("loading");s.ajax({action:"get_single_activity_content",id:D},"activity").done(function(i){if(typeof i!=="object"&&K.closest("div").find(".bb-activity-media-wrap").length>0){i=JSON.parse(i)}b(v).removeClass("loading");if(C.parent().find(".bp-feedback").length){C.parent().find(".bp-feedback").remove()}if(false===i.success){C.after(i.data.feedback);C.parent().find(".bp-feedback").hide().fadeIn(300)}else{b(C).html(i.data.contents).slideDown(300);jQuery(window).scroll();if(w.hasClass("wp-link-embed")){if(typeof window.instgrm!=="undefined"){window.instgrm.Embeds.process()}if(typeof window.FB!=="undefined"&&typeof window.FB.XFBML!=="undefined"){window.FB.XFBML.parse(document.getElementById("activity-"+D))}}}})}if(K.hasClass("activity-state-comments")||K.hasClass("acomment-reply")||K.parent().hasClass("acomment-reply")){var q=K;D=u;g=b("#ac-form-"+u);var o=b('[data-bp-activity-id="'+D+'"] .activity-comments');if(K.closest(".bb-media-model-container").length){g=K.closest(".bb-media-model-container").find("#ac-form-"+u);o=K.closest(".bb-media-model-container").find('[data-bp-activity-id="'+D+'"] .activity-comments')}E.preventDefault();if(K.parent().hasClass("acomment-reply")){q=K.parent()}if(K.closest("li").data("bp-activity-comment-id")){D=K.closest("li").data("bp-activity-comment-id")}this.toggleMultiMediaOptions(g,K);g.removeClass("root");b(".ac-form").hide();b.each(g.children("div"),function(M,i){if(b(i).hasClass("error")){b(i).remove()}});if(D===u){o.append(g);g.addClass("root")}else{b('[data-bp-activity-comment-id="'+D+'"]').append(g)}g.slideDown(200);var y=g.find(".ac-input[contenteditable]");if(y.length>0){var t=y.get(0);t.addEventListener("paste",function(i){i.preventDefault();var M=i.clipboardData.getData("text/plain");document.execCommand("insertText",false,M)})}K.attr("aria-expanded","true");var L=(b(window).height()/2-75);b.scrollTo(g,500,{offset:-L,easing:"swing"});b("#ac-form-"+u+" #ac-input-"+u).focus();if(!_.isUndefined(BP_Nouveau.media)&&!_.isUndefined(BP_Nouveau.media.emoji)&&"undefined"==typeof b("#ac-input-"+u).data("emojioneArea")){b("#ac-input-"+u).emojioneArea({standalone:true,hideSource:false,container:"#ac-reply-emoji-button-"+u,autocomplete:false,pickerPosition:"bottom",hidePickerOnBlur:true,useInternalCDN:false,events:{emojibtn_click:function(){b("#ac-input-"+u)[0].emojioneArea.hidePicker()},}})}}if(K.hasClass("activity-state-no-comments")){E.preventDefault()}if(K.hasClass("ac-reply-cancel")){b(K).closest(".ac-form").slideUp(200);b(".acomment-reply").attr("aria-expanded","false");B.destroyCommentMediaUploader(u);B.destroyCommentDocumentUploader(u);E.preventDefault()}if("ac_form_submit"===K.prop("name")){var J,c;g=K.closest("form");D=u;E.preventDefault();if(K.closest("li").data("bp-activity-comment-id")){D=K.closest("li").data("bp-activity-comment-id")}J=b(g).find(".ac-input").first();var d=J.find("span.atwho-query");for(var F=0;F<d.length;F++){b(d[F]).replaceWith(d[F].innerText)}J.find("img.emoji").each(function(M,N){b(N).addClass("emojioneemoji");var i=b(N).attr("alt");b(N).attr("data-emoji-char",i);b(N).removeClass("emoji")});J.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar});K.addClass("loading").prop("disabled",true);J.addClass("loading").prop("disabled",true);var H=J[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"");c={action:"new_activity_comment",_wpnonce_new_activity_comment:b("#_wpnonce_new_activity_comment").val(),comment_id:D,form_id:u,content:H};if(b("#_bp_as_nonce_"+u).val()){c["_bp_as_nonce_"+u]=b("#_bp_as_nonce_"+u).val()}if(this.dropzone_media.length){c.media=this.dropzone_media}if(this.dropzone_document.length){c.document=this.dropzone_document}if(this.dropzone_video.length){c.video=this.dropzone_video;if(_.isEmpty(c.content)){c.content="​"}}if(!_.isUndefined(this.models[u])){l=this.models[u];c.gif_data=this.models[u].get("gif_data")}s.ajax(c,"activity").done(function(O){K.removeClass("loading");J.removeClass("loading");b(".acomment-reply").attr("aria-expanded","false");if(false===O.success){g.append(b(O.data.feedback).hide().fadeIn(200))}else{var Q=g.parent();var M=b.trim(O.data.contents);g.fadeOut(200,function(){if(0===Q.children("ul").length){if(Q.hasClass("activity-comments")){Q.prepend("<ul></ul>")}else{Q.append("<ul></ul>")}}Q.children("ul").append(b(M).hide().fadeIn(200));b(g).find(".ac-input").first().html("");Q.parent().addClass("has-comments");Q.parent().addClass("comments-loaded");x.addClass("has-comments");var S=Q.find(".ac-reply-content");if(S.find(".ac-reply-toolbar .ac-reply-media-button")){S.find(".ac-reply-toolbar .ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click")}if(S.find(".ac-reply-toolbar .ac-reply-document-button")){S.find(".ac-reply-toolbar .ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click")}if(S.find(".ac-reply-toolbar .ac-reply-video-button")){S.find(".ac-reply-toolbar .ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click")}if(S.find(".ac-reply-toolbar .ac-reply-gif-button")){S.find(".ac-reply-toolbar .ac-reply-gif-button").removeClass("active ");S.find(".ac-reply-toolbar .ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")}jQuery(window).scroll()});r=x.find("span.comments-count");z=r.text().length?r.text().match(/\d+/)[0]:0;z=Number(z)+1;if(I.length){var P=z>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;I.text(P.replace("%d",z||1))}p=b(w).find(".show-all a");if(p){p.html(BP_Nouveau.show_x_comments.replace("%d",z))}if(B.dropzone_media.length){for(var i=0;i<B.dropzone_media.length;i++){B.dropzone_media[i].saved=true}}if(B.dropzone_document.length){for(var R=0;R<B.dropzone_document.length;R++){B.dropzone_document[R].saved=true}}if(B.dropzone_video.length){for(var N=0;N<B.dropzone_video.length;N++){B.dropzone_video[N].saved=true}}}if(!_.isUndefined(l)){l.set("gif_data",{});b("#ac-reply-post-gif-"+u).find(".activity-attached-gif-container").removeAttr("style")}B.destroyCommentMediaUploader(u);B.destroyCommentDocumentUploader(u);B.destroyCommentVideoUploader(u);K.prop("disabled",false);J.prop("disabled",false)})}if(K.hasClass("edit")&&K.hasClass("edit-activity")){E.preventDefault();var A=w.data("bp-activity");if(typeof A!=="undefined"){bp.Nouveau.Activity.postForm.displayEditActivityForm(A);if(K.closest("li").hasClass("groups")){b("#bp-nouveau-activity-form").addClass("group-activity")}else{b("#bp-nouveau-activity-form").removeClass("group-activity")}if(typeof bp.Nouveau.Media!=="undefined"&&typeof bp.Nouveau.Media.Theatre!=="undefined"&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)){b(document).find(".bb-close-media-theatre").trigger("click");b(document).find(".bb-close-document-theatre").trigger("click")}}}},commentFormAction:function(d){var c,e;d=d||window.event;if(d.target){c=d.target}else{if(d.srcElement){c=d.srcElement}}if(c.nodeType===3){c=c.parentNode}if(d.altKey===true||d.metaKey===true){return d}if(c.tagName!=="TEXTAREA"||!b(c).hasClass("ac-input")){return d}e=(d.keyCode)?d.keyCode:d.which;if(27===e&&false===d.ctrlKey){if(c.tagName==="TEXTAREA"){b(c).closest("form").slideUp(200)}}else{if(d.ctrlKey&&13===e&&b(c).val()){b(c).closest("form").find("[type=submit]").first().trigger("click")}}},togglePopupDropdown:function(d){var c;d=d||window.event;if(d.target){c=d.target}else{if(d.srcElement){c=d.srcElement}}if(c.nodeType===3){c=c.parentNode}if(d.altKey===true||d.metaKey===true){return d}if(b(c).hasClass("privacy-wrap")||b(c).parent().hasClass("privacy-wrap")){return d}b("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var c=b(".load-more:visible").last(),e=b(window);if(!c.closest(".activity-list").length){return}if(!c.get(0)||c.data("bp-autoloaded")){return}var f=c.offset();var d=f.top-50;if(e.scrollTop()+e.height()>d){c.data("bp-autoloaded",1);c.find("a").text(BP_Nouveau.activity.strings.loadingMore);c.find("a").trigger("click")}},destroyCommentMediaUploader:function(d){var c=this;if(!_.isNull(c.dropzone_obj)){c.dropzone_obj.destroy();b("#ac-reply-post-media-uploader-"+d).html("");b("#ac-reply-post-media-uploader-1-"+d).html("")}c.dropzone_media=[];b("#ac-reply-post-media-uploader-"+d).removeClass("open").addClass("closed");b("#ac-reply-media-button-"+d).removeClass("active")},destroyCommentDocumentUploader:function(d){var c=this;if(!_.isNull(c.dropzone_document_obj)){c.dropzone_document_obj.destroy();b("#ac-reply-post-document-uploader-"+d).html("")}c.dropzone_document=[];b("#ac-reply-post-document-uploader-"+d).removeClass("open").addClass("closed");b("#ac-reply-document-button-"+d).removeClass("active")},destroyCommentVideoUploader:function(d){var c=this;if(!_.isNull(c.dropzone_video_obj)){c.dropzone_video_obj.destroy();b("#ac-reply-post-video-uploader-"+d).html("")}c.dropzone_video=[];b("#ac-reply-post-video-uploader-"+d).removeClass("open").addClass("closed");b("#ac-reply-video-button-"+d).removeClass("active")},resetGifPicker:function(d){b("#ac-reply-gif-button-"+d).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open");b("#ac-reply-gif-button-"+d).removeClass("active");if(!_.isUndefined(this.models[d])){var c=this.models[d];c.set("gif_data",{});b("#ac-reply-post-gif-"+d).find(".activity-attached-gif-container").removeAttr("style")}},openCommentsMediaUploader:function(c){var l=this,g=b(c.currentTarget),i=g.data("ac-id"),e=g.closest(".ac-reply-content").find("#ac-reply-post-media-uploader-"+i);c.preventDefault();b(c.currentTarget).toggleClass("active");var h=document.getElementsByClassName("ac-reply-post-default-template").length?document.getElementsByClassName("ac-reply-post-default-template")[0].innerHTML:"";if(typeof window.Dropzone!=="undefined"&&e.length){if(e.hasClass("closed")){var j={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.media.maxFiles!=="undefined"?BP_Nouveau.media.maxFiles:10,maxFilesize:typeof BP_Nouveau.media.max_upload_size!=="undefined"?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:h,};l.dropzone_obj=new Dropzone("#ac-reply-post-media-uploader-"+g.data("ac-id"),j);l.dropzone_obj.on("sending",function(n,p,o){o.append("action","media_upload");o.append("_wpnonce",BP_Nouveau.nonces.media);var m=g.parents(".ac-reply-toolbar");if(m.find(".ac-reply-document-button")){m.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-video-button")){m.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-gif-button")){m.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-media-button")){m.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click")}});l.dropzone_obj.on("uploadprogress",function(o){var p=b(o.previewElement).find(".dz-progress-ring circle")[0];var m=p.r.baseVal.value;var n=m*2*Math.PI;p.style.strokeDasharray=n+" "+n;p.style.strokeDashoffset=n;var q=n-o.upload.progress.toFixed(0)/100*n;p.style.strokeDashoffset=q});l.dropzone_obj.on("success",function(p,o){if(o.data.id){p.id=o.id;o.data.uuid=p.upload.uuid;o.data.menu_order=b(p.previewElement).closest(".dropzone").find(p.previewElement).index()-1;o.data.album_id=typeof BP_Nouveau.media!=="undefined"&&typeof BP_Nouveau.media.album_id!=="undefined"?BP_Nouveau.media.album_id:false;o.data.group_id=typeof BP_Nouveau.media!=="undefined"&&typeof BP_Nouveau.media.group_id!=="undefined"?BP_Nouveau.media.group_id:false;o.data.saved=false;l.dropzone_media.push(o.data);return p.previewElement.classList.add("dz-success")}else{var r,t,n,s,m;var q=o.data.feedback;p.previewElement.classList.add("dz-error");s=p.previewElement.querySelectorAll("[data-dz-errormessage]");m=[];for(t=0,n=s.length;t<n;t++){r=s[t];m.push(r.textContent=q)}return m}});l.dropzone_obj.on("accept",function(n,m){if(n.size==0){m(BP_Nouveau.media.empty_document_type)}else{m()}});l.dropzone_obj.on("error",function(n,m){if(n.accepted){if(typeof m!=="undefined"&&typeof m.data!=="undefined"&&typeof m.data.feedback!=="undefined"){b(n.previewElement).find(".dz-error-message span").text(m.data.feedback)}}else{if(!jQuery(".comment-media-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+m+"</p></div></div></div></div></transition></div>")}this.removeFile(n)}});l.dropzone_obj.on("removedfile",function(o){if(l.dropzone_media.length){for(var n in l.dropzone_media){if(o.upload.uuid==l.dropzone_media[n].uuid){if(typeof l.dropzone_media[n].saved!=="undefined"&&!l.dropzone_media[n].saved){bp.Nouveau.Media.removeAttachment(l.dropzone_media[n].id)}l.dropzone_media.splice(n,1);break}}}if(!_.isNull(l.dropzone_obj)&&!_.isNull(l.dropzone_obj.files)&&l.dropzone_obj.files.length===0){var m=g.parents(".ac-reply-toolbar");if(m.find(".ac-reply-document-button")){m.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-video-button")){m.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-gif-button")){m.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-media-button")){m.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});e.removeClass("closed").addClass("open")}else{if(l.dropzone_obj&&typeof l.dropzone_obj!=="undefined"){l.dropzone_obj.destroy()}l.dropzone_media=[];e.html("");e.addClass("closed").removeClass("open")}}var d=c.currentTarget,f=d.id.match(/\d+$/)[0];this.destroyCommentDocumentUploader(f);this.destroyCommentVideoUploader(f);var k=b(c.currentTarget).data("ac-id");this.resetGifPicker(k)},openCommentsDocumentUploader:function(c){var l=this,g=b(c.currentTarget),i=g.data("ac-id"),e=g.closest(".ac-reply-content").find("#ac-reply-post-document-uploader-"+i);c.preventDefault();b(c.currentTarget).toggleClass("active");var h=document.getElementsByClassName("ac-reply-post-document-template").length?document.getElementsByClassName("ac-reply-post-document-template")[0].innerHTML:"";if(typeof window.Dropzone!=="undefined"&&e.length){if(e.hasClass("closed")){var j={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:false,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.document.maxFiles!=="undefined"?BP_Nouveau.document.maxFiles:10,maxFilesize:typeof BP_Nouveau.document.max_upload_size!=="undefined"?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:h,};l.dropzone_document_obj=new Dropzone("#ac-reply-post-document-uploader-"+g.data("ac-id"),j);l.dropzone_document_obj.on("sending",function(n,p,o){o.append("action","document_document_upload");o.append("_wpnonce",BP_Nouveau.nonces.media);var m=g.parents(".ac-reply-toolbar");if(m.find(".ac-reply-media-button")){m.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-video-button")){m.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-gif-button")){m.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-document-button")){m.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click")}});l.dropzone_document_obj.on("uploadprogress",function(o){var p=b(o.previewElement).find(".dz-progress-ring circle")[0];var m=p.r.baseVal.value;var n=m*2*Math.PI;p.style.strokeDasharray=n+" "+n;p.style.strokeDashoffset=n;var q=n-o.upload.progress.toFixed(0)/100*n;p.style.strokeDashoffset=q});l.dropzone_document_obj.on("accept",function(n,m){if(n.size==0){m(BP_Nouveau.media.empty_document_type)}else{m()}});l.dropzone_document_obj.on("success",function(p,o){if(o.data.id){p.id=o.id;o.data.uuid=p.upload.uuid;o.data.menu_order=b(p.previewElement).closest(".dropzone").find(p.previewElement).index()-1;o.data.album_id=typeof BP_Nouveau.media!=="undefined"&&typeof BP_Nouveau.media.album_id!=="undefined"?BP_Nouveau.media.album_id:false;o.data.group_id=typeof BP_Nouveau.media!=="undefined"&&typeof BP_Nouveau.media.group_id!=="undefined"?BP_Nouveau.media.group_id:false;o.data.saved=false;l.dropzone_document.push(o.data);return p.previewElement.classList.add("dz-success")}else{var r,t,n,s,m;var q=o.data.feedback;p.previewElement.classList.add("dz-error");s=p.previewElement.querySelectorAll("[data-dz-errormessage]");m=[];for(t=0,n=s.length;t<n;t++){r=s[t];m.push(r.textContent=q)}return m}});l.dropzone_document_obj.on("error",function(n,m){if(n.accepted){if(typeof m!=="undefined"&&typeof m.data!=="undefined"&&typeof m.data.feedback!=="undefined"){b(n.previewElement).find(".dz-error-message span").text(m.data.feedback)}}else{if(!jQuery(".comment-document-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-document"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+m+"</p></div></div></div></div></transition></div>")}this.removeFile(n)}});l.dropzone_document_obj.on("removedfile",function(o){if(l.dropzone_document.length){for(var n in l.dropzone_document){if(o.upload.uuid==l.dropzone_document[n].uuid){if(typeof l.dropzone_document[n].saved!=="undefined"&&!l.dropzone_document[n].saved){bp.Nouveau.Media.removeAttachment(l.dropzone_document[n].id)}l.dropzone_document.splice(n,1);break}}}if(!_.isNull(l.dropzone_obj)&&!_.isNull(l.dropzone_obj.files)&&l.dropzone_obj.files.length===0){var m=g.parents(".ac-reply-toolbar");if(m.find(".ac-reply-media-button")){m.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-video-button")){m.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-gif-button")){m.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-document-button")){m.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});e.removeClass("closed").addClass("open")}else{if(l.dropzone_document_obj){l.dropzone_document_obj.destroy()}l.dropzone_document=[];e.html("");e.addClass("closed").removeClass("open")}}var d=c.currentTarget,f=d.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(f);this.destroyCommentVideoUploader(f);var k=b(c.currentTarget).data("ac-id");this.resetGifPicker(k)},openCommentsVideoUploader:function(c){var l=this,h=b(c.currentTarget),i=h.data("ac-id"),e=h.closest(".ac-reply-content").find("#ac-reply-post-video-uploader-"+i);c.preventDefault();b(c.currentTarget).toggleClass("active");var g=document.getElementsByClassName("ac-reply-post-video-template").length?document.getElementsByClassName("ac-reply-post-video-template")[0].innerHTML:"";if(typeof window.Dropzone!=="undefined"&&e.length){if(e.hasClass("closed")){var j={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:false,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.video.maxFiles!=="undefined"?BP_Nouveau.video.maxFiles:10,maxFilesize:typeof BP_Nouveau.video.max_upload_size!=="undefined"?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:g,};l.dropzone_video_obj=new Dropzone("#ac-reply-post-video-uploader-"+h.data("ac-id"),j);l.dropzone_video_obj.on("sending",function(n,p,o){o.append("action","video_upload");o.append("_wpnonce",BP_Nouveau.nonces.video);var m=h.parents(".ac-reply-toolbar");if(m.find(".ac-reply-media-button")){m.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-document-button")){m.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-gif-button")){m.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find(".ac-reply-video-button")){m.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click")}});l.dropzone_video_obj.on("accept",function(n,m){if(n.size==0){m(BP_Nouveau.video.empty_video_type)}else{m()}});l.dropzone_video_obj.on("addedfile",function(m){if(m.dataURL){}else{if(bp.Nouveau.getVideoThumb){bp.Nouveau.getVideoThumb(m,".dz-video-thumbnail")}}});l.dropzone_video_obj.on("uploadprogress",function(p,o){b(p.previewElement).find(".dz-progress-count").text(p.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text);var q=b(p.previewElement).find(".dz-progress-ring circle")[0];var m=q.r.baseVal.value;var n=m*2*Math.PI;q.style.strokeDasharray=n+" "+n;q.style.strokeDashoffset=n;var r=n-p.upload.progress.toFixed(0)/100*n;q.style.strokeDashoffset=r;if(p.upload.progress===100){b(o.previewElement).closest(".dz-preview").addClass("dz-complete")}});l.dropzone_video_obj.on("success",function(p,o){if(o.data.id){p.id=o.id;o.data.uuid=p.upload.uuid;o.data.menu_order=b(p.previewElement).closest(".dropzone").find(p.previewElement).index()-1;o.data.album_id=typeof BP_Nouveau.video!=="undefined"&&typeof BP_Nouveau.video.album_id!=="undefined"?BP_Nouveau.video.album_id:false;o.data.group_id=typeof BP_Nouveau.video!=="undefined"&&typeof BP_Nouveau.video.group_id!=="undefined"?BP_Nouveau.video.group_id:false;o.data.saved=false;o.data.js_preview=b(p.previewElement).find(".dz-video-thumbnail img").attr("src");l.dropzone_video.push(o.data);return p.previewElement.classList.add("dz-success")}else{var r,t,n,s,m;var q=o.data.feedback;p.previewElement.classList.add("dz-error");s=p.previewElement.querySelectorAll("[data-dz-errormessage]");m=[];for(t=0,n=s.length;t<n;t++){r=s[t];m.push(r.textContent=q)}return m}});l.dropzone_video_obj.on("error",function(n,m){if(n.accepted){if(typeof m!=="undefined"&&typeof m.data!=="undefined"&&typeof m.data.feedback!=="undefined"){b(n.previewElement).find(".dz-error-message span").text(m.data.feedback)}}else{if(!jQuery(".comment-video-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-video"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+m+"</p></div></div></div></div></transition></div>")}this.removeFile(n)}});l.dropzone_video_obj.on("removedfile",function(o){if(l.dropzone_video.length){for(var n in l.dropzone_video){if(o.upload.uuid==l.dropzone_video[n].uuid){if(typeof l.dropzone_video[n].saved!=="undefined"&&!l.dropzone_video[n].saved){bp.Nouveau.Media.removeAttachment(l.dropzone_video[n].id)}l.dropzone_video.splice(n,1);break}}}if(!_.isNull(l.dropzone_obj)&&!_.isNull(l.dropzone_obj.files)&&l.dropzone_obj.files.length===0){var m=h.parents(".ac-reply-toolbar");if(m.find(".ac-reply-media-button")){m.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-document-button")){m.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-gif-button")){m.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(m.find(".ac-reply-video-button")){m.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});e.removeClass("closed").addClass("open")}else{if(l.dropzone_video_obj){l.dropzone_video_obj.destroy()}l.dropzone_video=[];e.html("");e.addClass("closed").removeClass("open")}}var d=c.currentTarget,f=d.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(f);this.destroyCommentDocumentUploader(f);var k=b(c.currentTarget).data("ac-id");this.resetGifPicker(k)},openGifPicker:function(e){e.preventDefault();var f=e.currentTarget,j=b(f).next(),h=f.id.match(/\d+$/)[0],d=b("#ac-reply-post-gif-"+h);if(j.is(":empty")){var g=new bp.Models.ACReply(),k=new bp.Views.GifMediaSearchDropdown({model:g}),i=new bp.Views.ActivityAttachedGifPreview({model:g});j.html(k.render().el);d.html(i.render().el);this.models[h]=g}var c=b(f).parents(".ac-textarea ").find(".ac-reply-attachments .activity-attached-gif-container");if(b(f).hasClass("active")&&c.length&&b.trim(c.html())==""){b(f).removeClass("active")}else{b(f).addClass("active")}j.toggleClass("open");this.destroyCommentMediaUploader(h);this.destroyCommentDocumentUploader(h);this.destroyCommentVideoUploader(h)},toggleMultiMediaOptions:function(d,e){if(!_.isUndefined(BP_Nouveau.media)){var c=e.closest(".activity-item");var f=e.closest(".activity-item").data("bp-activity");if(e.closest("li").hasClass("groups")||c.hasClass("groups")){if(!_.isUndefined(f.group_media)){if(f.group_media===true){d.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}}else{if(BP_Nouveau.media.group_media===false){d.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}}if(!_.isUndefined(f.group_document)){if(f.group_document===true){d.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}}else{if(BP_Nouveau.media.group_document===false){d.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}}if(!_.isUndefined(f.group_video)){if(f.group_video===true){d.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled")}else{d.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled")}}else{if(BP_Nouveau.media.group_video===false){d.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled")}else{d.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled")}}if(BP_Nouveau.media.gif.groups===false){d.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled")}else{d.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled")}if(BP_Nouveau.media.emoji.groups===false){d.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled")}else{d.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")}}else{if(!_.isNull(f)&&!_.isUndefined(f.profile_media)){if(f.profile_media===true){d.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}}else{if(BP_Nouveau.media.profile_media===false){d.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}}if(!_.isNull(f)&&!_.isUndefined(f.profile_document)){if(f.profile_document===true){d.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}}else{if(BP_Nouveau.media.profile_document===false){d.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled")}else{d.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled")}}if(!_.isNull(f)&&!_.isUndefined(f.profile_video)){if(f.profile_video===true){d.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled")}else{d.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled")}}else{if(BP_Nouveau.media.profile_video===false){d.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled")}else{d.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled")}}if(BP_Nouveau.media.gif.profile===false){d.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled")}else{d.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled")}if(BP_Nouveau.media.emoji.profile===false){d.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled")}else{d.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")}}}},fixAtWhoActivity:function(){b(".acomment-content, .activity-content").each(function(){var d=b(this).find("span.atwho-query");for(var c=0;c<d.length;c++){b(d[c]).replaceWith(d[c].innerText)}})},toggleActivityOption:function(c){if(b(c.target).hasClass("bb-activity-more-options-action")||b(c.target).parent().hasClass("bb-activity-more-options-action")){if(b(c.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").hasClass("is_visible")){b(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible")}else{b(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible");b(c.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").addClass("is_visible")}}else{b(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible")}},};bp.Nouveau.Activity.start()})(bp,jQuery);