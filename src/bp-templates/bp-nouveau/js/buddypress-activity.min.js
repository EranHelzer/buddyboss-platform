window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(t(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:t(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options)),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.dropzone_video_obj=null,this.dropzone_video=[],this.models=[],this.InitiatedCommentForms=[]},addListeners:function(){t("body").hasClass("activity-singular")||t("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),t("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),t("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),t('#buddypress [data-bp-list="activity"]').on("bp_ajax_append",this.hideComments),t('#buddypress [data-bp-list="activity"]').on("click",".show-all",this.showComments),t('#buddypress [data-bp-list="activity"]').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li.bb-edit-privacy a",bp.Nouveau,this.activityPrivacyRedirect.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li:not(.bb-edit-privacy)",bp.Nouveau,this.activityPrivacyChange.bind(this)),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),t("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t(document).keydown(this.commentFormAction),t(document).click(this.togglePopupDropdown),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-video-button",this.openCommentsVideoUploader.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),t(document).on("click",this.toggleActivityOption.bind(this)),t(document).on("click",".activity-state-popup_overlay",bp.Nouveau,this.closeActivityState.bind(this)),t(document).on("click",".activity-state-reactions",this.showActivityReactions),t(document).on("click",".activity-state-popup .activity-state-popup_tab_panel a",this.ReactionStatePopupTab),_.isUndefined(BP_Nouveau.activity.params.autoload)||t(window).scroll(this.loadMoreActivities)},heartbeatSend:function(e,a){this.heartbeat_data.first_recorded=t("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0,(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),a.bp_activity_last_recorded=this.heartbeat_data.last_recorded,t("#buddypress .dir-search input[type=search]").length&&(a.bp_activity_last_recorded_search_terms=t("#buddypress .dir-search input[type=search]").val()),t.extend(a,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(e,a){var i,o,d=bp.Nouveau.objects,s=bp.Nouveau.getStorage("bp-activity","scope"),n=this;if(void 0!==a&&a.bp_activity_newest_activities){if(this.heartbeat_data.newest=t.trim(a.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(a.bp_activity_newest_activities.last_recorded),o=t(this.heartbeat_data.newest).filter(".activity-item"),i=Number(o.length),d.push("mentions"),"all"===s){t.each(o,function(e,a){a=t(a),t.each(d,function(e,i){-1!==t.inArray("bp-my-"+i,a.get(0).classList)&&(void 0===n.heartbeat_data.highlights[i]?n.heartbeat_data.highlights[i]=[a.data("bp-activity-id")]:-1===t.inArray(a.data("bp-activity-id"),n.heartbeat_data.highlights[i])&&n.heartbeat_data.highlights[i].push(a.data("bp-activity-id")))})});var r=new RegExp("bp-my-("+d.join("|")+")","g");this.heartbeat_data.newest=this.heartbeat_data.newest.replace(r,""),t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(i)}else this.heartbeat_data.highlights[s]=[],t.each(o,function(e,a){n.heartbeat_data.highlights[s].push(t(a).data("bp-activity-id"))});if(t.each(d,function(e,a){if(void 0!==n.heartbeat_data.highlights[a]&&n.heartbeat_data.highlights[a].length){var i=0;"mentions"===a&&(i=n.mentions_count),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+a+'"]').find("a span").html(Number(n.heartbeat_data.highlights[a].length)+i)}}),d.pop(),t(document).prop("title","("+i+") "+this.heartbeat_data.document_title),t('#buddypress [data-bp-list="activity"] li').first().hasClass("load-newest")){var l=t('#buddypress [data-bp-list="activity"] .load-newest a').html();t('#buddypress [data-bp-list="activity"] .load-newest a').html(l.replace(/([0-9]+)/,i))}else t('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+i+")</a></li>");t('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),t('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data),void 0!==bp.Nouveau&&bp.Nouveau.reportPopUp()}},injectActivities:function(e){var a=bp.Nouveau.getStorage("bp-activity"),i=a.scope||null,o=a.filter||null;if(t(e.currentTarget).hasClass("load-newest")){e.preventDefault(),t(e.currentTarget).remove();var d=t.parseHTML(this.heartbeat_data.newest),s=!1;if(t.each(d,function(e,a){"LI"===a.nodeName&&t(a).hasClass("just-posted")&&t("#"+t(a).prop("id")).length&&t("#"+t(a).prop("id")).remove(),t(a).hasClass("bb-pinned")&&(s=!0)}),!0===s){var n=t(e.delegateTarget).find(".activity-list").find(".bb-pinned");n.each(function(){var e=t(this).find(".unpin-activity"),a=!1;e.removeClass("unpin-activity").addClass("pin-activity"),t(this).hasClass("groups")&&(a=!0),a?e.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):e.find("span").html(BP_Nouveau.activity.strings.pinPost)}),n.removeClass("bb-pinned")}t(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===i&&t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===i&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+i+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[i]&&(this.heartbeat_data.highlights[i]=[]),setTimeout(function(){t(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+i+"_activity")},3e3),t(document).prop("title",this.heartbeat_data.document_title),jQuery(window).scroll()}else if(t(e.currentTarget).hasClass("load-more")){var r=1*Number(this.current_page)+1,l=this,c="";e.preventDefault();var p=t(e.currentTarget);p.find("a").first().addClass("loading"),this.just_posted=[],t(e.delegateTarget).children(".just-posted").each(function(){l.just_posted.push(t(this).data("bp-activity-id"))}),t("#buddypress .dir-search input[type=search]").length&&(c=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:i,filter:o,search_terms:c,page:r,method:"append",exclude_just_posted:this.just_posted.join(","),target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(p.remove(),l.current_page=r,jQuery(window).scroll())})}},hideComments:function(e){var a,i,o,d=t(e.target).find(".activity-comments");d.length&&d.each(function(e,d){o=t(d).children("ul").not(".conflict-activity-ul-li-comment"),i=t(o).find("li").not(t(".document-action-class, .media-action-class, .video-action-class")),i.length&&(t("body").hasClass("activity-singular")&&""!==window.location.hash&&t(window.location.hash).length&&0!==t(window.location.hash).closest(".activity-comments").length||(a=t(d).closest(".activity-item"),t("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html()||" ",i.each(function(e,o){if(e<i.length-4){if(e||t(o).before('<li class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></li>"),window.location.hash&&"#"+t(o).attr("id")===window.location.hash)return t(o).parents("li.comment-item").show(),!1;t(o).addClass("bp-hidden").hide()}}),t(o).children(".bp-hidden").length===t(o).children("li").length-1&&t(o).find("li.show-all").length&&t(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle()))})},showComments:function(e){e.preventDefault(),t(e.target).addClass("loading"),setTimeout(function(){t(e.target).closest("ul").find("li").removeClass("bp-hidden").fadeIn(300,function(){t(e.target).parent("li").remove()})},600)},scopeLoaded:function(e,a){this.hideComments(e),this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(t.each(a.response.new_mentions,function(e,a){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+a+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&t.each(this.heartbeat_data.highlights[a.scope],function(e,i){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').length&&t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",t.each(t(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,a){0===parseInt(t(a).html(),10)&&t(a).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),t(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){t("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(),this.fixAtWhoActivity(),this.openEditActivityPopup(),this.navigateToSpecificComment(),setTimeout(function(){jQuery(window).scroll()},200)},openEditActivityPopup:function(){if(!_.isUndefined(BP_Nouveau.activity.params.is_activity_edit)&&0<BP_Nouveau.activity.params.is_activity_edit){var e=t("#activity-"+BP_Nouveau.activity.params.is_activity_edit);if(e.length){var a=e.data("bp-activity"),i=""!==e.data("link-url")?e.data("link-url"):null;_.isUndefined(a)||bp.Nouveau.Activity.postForm.displayEditActivityForm(a,i)}}},activityPrivacyChange:function(e){var a=e.data,i=t(e.target),o=t(e.currentTarget).closest(".activity-item"),d=o.data("bp-activity-id");if(e.preventDefault(),void 0===i.data("value")||""==t.trim(i.data("value")))return!1;o.find(".privacy").addClass("loading"),a.ajax({action:"activity_update_privacy",id:d,privacy:i.data("value")},"activity").done(function(e){if(o.find(".privacy").removeClass("loading"),!0===e.success&&(o.find(".activity-privacy li").removeClass("selected"),o.find(".privacy-wrap").attr("data-bp-tooltip",i.text()),i.addClass("selected"),o.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),o.find(".privacy").addClass(i.data("value")),void 0!==e&&void 0!==e.data&&void 0!==e.data.video_symlink)){t(".document-description-wrap").length&&t(".document-description-wrap .bb-open-document-theatre").length&&(t(".document-description-wrap .bb-open-document-theatre").attr("data-video-preview",e.data.video_symlink),t(".document-description-wrap .bb-open-document-theatre").attr("data-extension",e.data.extension)),t(".document-description-wrap").length&&t(".document-detail-wrap.document-detail-wrap-description-popup").length&&(t(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-video-preview",e.data.video_symlink),t(".document-detail-wrap.document-detail-wrap-description-popup").attr("data-extension",e.data.extension));var a=videojs(e.data.video_js_id);a.src({type:e.data.video_extension,src:e.data.video_symlink})}})},activityPrivacyRedirect:function(e){var a=t(e.target);if(e.preventDefault(),void 0===a.data("value")||""==t.trim(a.data("value")))return!1;window.location.href=a.data("value")},togglePrivacyDropdown:function(e){e.data,t(e.target);var a=t(e.currentTarget).closest(".activity-item");a.data("bp-activity-id");e.preventDefault(),t("ul.activity-privacy").not(a.find(".activity-privacy")).removeClass("bb-open"),a.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var a,i,o,d=e.data,s=t(e.target),n=t(e.currentTarget),r=n.data("bp-activity-id"),l=t(e.delegateTarget),c=n.find(".activity-state"),p=n.find(".comments-count"),m=this;t(s).is("span")&&(s=t(s).closest("a"));var u=0;if(!s.parent(".ac-emotion_btn")||s.hasClass("fav")||s.hasClass("unfav")||(u=s.parents(".ac-emotion_item").attr("data-reaction-id")),s.hasClass("fav")||s.hasClass("unfav")||u>0){if(e.preventDefault(),t("body").hasClass("bb-is-mobile")&&t("body").hasClass("bb-reactions-mode")&&0==s.parent(".ac-emotion_btn").length&&!0!==e.customTriggered)return;t(s).is("a")||(s=t(s).closest("a"));var v,b=s.hasClass("fav")?"fav":"unfav",f=!0,h="activity",y=s.parents(".acomment-display").first();u>0&&(b="fav"),0<y.length&&(f=!1,h="activity_comment"),f?(v=s.parents(".activity-item"),a=v.data("bp-activity-id")):(v=s.parents(".activity-comment").first(),a=v.data("bp-activity-comment-id")),s.addClass("loading");var g={action:"activity_mark_"+b,reaction_id:u,item_id:a,item_type:h};d.ajax(g,"activity").done(function(e){if(s.removeClass("loading"),!1!==e.success){if(s.fadeOut(200,function(){"false"===t(this).attr("aria-pressed")?t(this).attr("aria-pressed","true"):t(this).attr("aria-pressed","false"),void 0!==e.data.reaction_count&&(f?0<v.find(".activity-content .activity-state-reactions").length?v.find(".activity-content  .activity-state-reactions").replaceWith(e.data.reaction_count):v.find(".activity-content .activity-state").prepend(e.data.reaction_count):0<v.find("#acomment-display-"+a+" .comment-reactions").length&&v.find("#acomment-display-"+a+" .comment-reactions").html(e.data.reaction_count)),e.data.reaction_button&&(f?v.find(".bp-generic-meta a.bp-like-button:first").replaceWith(e.data.reaction_button):v.find("#acomment-display-"+a+" .bp-generic-meta a.bp-like-button").replaceWith(e.data.reaction_button)),v.find(".ac-emotions_list").removeClass("active"),t(this).fadeIn(200)}),"fav"===b)void 0===e.data.directory_tab||""===e.data.directory_tab||t(d.objectNavParent+' [data-bp-scope="favorites"]').length||t(d.objectNavParent+' [data-bp-scope="all"]').after(e.data.directory_tab);else if("unfav"===b){var i=t('[data-bp-user-scope="favorites"]').hasClass("selected")||t(d.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected");i&&n.remove(),void 0!==e.data.no_favorite&&(t(d.objectNavParent+' [data-bp-scope="all"]').length&&t(d.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?t(d.objectNavParent+' [data-bp-scope="favorites"]').remove():i&&l.append(e.data.no_favorite))}}else alert(e.data)})}if(s.hasClass("delete-activity")||s.hasClass("acomment-delete")||s.hasClass("spam-activity")||s.hasClass("spam-activity-comment")){var C,w,z,N,j=s.closest("[data-bp-activity-comment-id]"),P=j.data("bp-activity-comment-id"),B=0;if(e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;s.addClass("loading");var x={action:"delete_activity",id:r,_wpnonce:d.getLinkParams(s.prop("href"),"_wpnonce"),is_single:s.closest("[data-bp-single]").length};(s.hasClass("spam-activity")||s.hasClass("spam-activity-comment"))&&(x.action="bp_spam_activity"),C=n,P&&(delete x.is_single,x.id=P,x.is_comment=!0,C=j),d.ajax(x,"activity").done(function(e){if(s.removeClass("loading"),!1===e.success)C.prepend(e.data.feedback),C.find(".bp-feedback").hide().fadeIn(300);else{if(e.data.redirect)return window.location.href=e.data.redirect;if(e.data.parent_activity_id&&e.data.activity&&t("#buddypress #activity-stream ul.activity-list li#activity-"+e.data.parent_activity_id).replaceWith(e.data.activity),P){if(B=1,n.append(j.find("form")),t.each(j.find("li.comment-item"),function(){B+=1}),w=c.find("span.comments-count"),z=w.text().length?w.text().match(/\d+/)[0]:0,z=Number(z-B),p.length){var a=z>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(a.replace("%d",z))}N=n.find("li.show-all a"),N.length&&N.html(BP_Nouveau.show_x_comments.replace("%d",z)),0===z&&(n.removeClass("has-comments"),c.removeClass("has-comments"),p.empty())}C.slideUp(300,function(){C.remove()}),P||n.data("bp-timestamp")!==d.Activity.heartbeat_data.last_recorded||(d.Activity.heartbeat_data.newest="",d.Activity.heartbeat_data.last_recorded=0),t(document).trigger("bp_activity_ajax_delete_request",t.extend(x,{response:e})),t(document).trigger("bp_activity_ajax_delete_request_video",t.extend(x,{response:e}))}})}if(s.closest("span").hasClass("activity-read-more")){var k=s.closest("div"),T=s.closest("span");if(a=null,t(k).hasClass("activity-inner")?a=r:t(k).hasClass("acomment-content")&&(a=s.closest("li").data("bp-activity-comment-id")),!a)return e;e.preventDefault(),t(T).addClass("loading"),d.ajax({action:"get_single_activity_content",id:a},"activity").done(function(e){"object"!=typeof e&&s.closest("div").find(".bb-activity-media-wrap").length>0&&(e=JSON.parse(e)),t(T).removeClass("loading"),k.parent().find(".bp-feedback").length&&k.parent().find(".bp-feedback").remove(),!1===e.success?(k.after(e.data.feedback),k.parent().find(".bp-feedback").hide().fadeIn(300)):(t(k).html(e.data.contents).slideDown(300),jQuery(window).scroll(),n.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+a))))})}if(s.hasClass("activity-state-comments")||s.hasClass("acomment-reply")||s.parent().hasClass("acomment-reply")||s.hasClass("acomment-edit")){a=r,i=t("#ac-form-"+r);var F=t('[data-bp-activity-id="'+a+'"] .activity-comments'),U=!1;if(s.closest(".bb-media-model-container").length&&(i=s.closest(".bb-media-model-container").find("#ac-form-"+r),F=s.closest(".bb-media-model-container").find('[data-bp-activity-id="'+a+'"] .activity-comments')),e.preventDefault(),m.resetActivityCommentForm(i),s.parent().hasClass("acomment-reply")&&s.parent(),s.closest("li").data("bp-activity-comment-id")&&(a=s.closest("li").data("bp-activity-comment-id")),s.hasClass("acomment-edit")&&s.closest("li").data("bp-activity-comment")&&(U=s.closest("li").data("bp-activity-comment")),this.toggleMultiMediaOptions(i,s),i.removeClass("root"),t(".ac-form").hide(),t.each(i.children("div"),function(e,a){t(a).hasClass("error")&&t(a).remove()}),s.hasClass("acomment-edit")&&!_.isNull(U)){var E=t('[data-bp-activity-comment-id="'+a+'"]');E.find("#acomment-display-"+a).addClass("bp-hide"),E.find("#acomment-edit-form-"+a).append(i),i.addClass("acomment-edit").attr("data-item-id",a),m.editActivityCommentForm(i,U)}else a===r?(F.append(i),i.addClass("root")):t('[data-bp-activity-comment-id="'+a+'"]').append(i);i.slideDown(200);var D=i.find(".post-elements-buttons-item.post-emoji").prevAll().not(":hidden").length+1;i.find(".post-elements-buttons-item.post-emoji").attr("data-nth-child",D);var A=i.find(".post-elements-buttons-item.post-gif").prevAll().not(":hidden").length+1;i.find(".post-elements-buttons-item.post-gif").attr("data-nth-child",A);var M=i.find(".ac-input[contenteditable]");if(M.length>0){var L=M.get(0),I=t(L).attr("id")+(t(L).closest(".bb-media-model-inner").length?"-theater":"");if(-1!==t.inArray(I,m.InitiatedCommentForms)&&!t(L).closest("form").hasClass("events-initiated")){var R=m.InitiatedCommentForms.indexOf(I);m.InitiatedCommentForms.splice(R,1)}-1!=t.inArray(I,m.InitiatedCommentForms)||t(L).closest("form").hasClass("events-initiated")||(L.addEventListener("paste",function(e){e.preventDefault();var t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),L.addEventListener("input",function(e){var a=jQuery(e.currentTarget).html();k=t.trim(a.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"")),k=k.replace(/&nbsp;/g," ");var i=jQuery(e.currentTarget).text().trim();""!==i||k.indexOf("emojioneemoji")>=0?jQuery(e.currentTarget).closest("form").addClass("has-content"):jQuery(e.currentTarget).closest("form").removeClass("has-content")}),t(L).closest("form").addClass("events-initiated"),m.InitiatedCommentForms.push(I))}s.attr("aria-expanded","true");var Q=t(window).height()/2-75;if(jQuery("body").hasClass("bb-is-mobile")?setTimeout(function(){var e=jQuery(window).height()>300?200:100;jQuery("html, body").animate({scrollTop:jQuery(L).offset().top-e},500)},500):t.scrollTo(i,500,{offset:-Q,easing:"swing"}),t("#ac-form-"+r+" #ac-input-"+r).focus(),!_.isUndefined(BP_Nouveau.media)&&!_.isUndefined(BP_Nouveau.media.emoji)&&void 0===t("#ac-input-"+r).data("emojioneArea")){var S=t("#ac-input-"+r).html();t("#ac-input-"+r).emojioneArea({standalone:!0,hideSource:!1,container:"#ac-reply-emoji-button-"+r,autocomplete:!1,pickerPosition:"bottom",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){t("#ac-input-"+r)[0].emojioneArea.hidePicker();var e=t("#ac-form-"+r+" #ac-input-"+r),a=e.html();k=t.trim(a.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"")),k=k.replace(/&nbsp;/g," ");var i=e.text();""!==i||k.indexOf("emojioneemoji")>=0?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},picker_show:function(){t(this.button[0]).closest(".post-emoji").addClass("active")},picker_hide:function(){t(this.button[0]).closest(".post-emoji").removeClass("active")}}}),s.hasClass("acomment-edit")&&!_.isNull(U)&&t("#ac-input-"+r).html(S)}if(void 0!==window.getSelection&&void 0!==document.createRange&&s.hasClass("acomment-edit")&&!_.isNull(U)){var G=document.createRange();G.selectNodeContents(t("#ac-input-"+r)[0]),G.collapse(!1);var V=window.getSelection();V.removeAllRanges(),V.addRange(G)}_.isUndefined(window.MediumEditor)||t("#ac-input-"+r).hasClass("medium-editor-element")||(window.activity_comment_editor=new window.MediumEditor(t("#ac-input-"+r)[0],{placeholder:!1,toolbar:!1,paste:{forcePlainText:!1,cleanPastedHTML:!1},keyboardCommands:!1,imageDragging:!1,anchorPreview:!1}))}if(s.hasClass("activity-state-no-comments")&&e.preventDefault(),s.hasClass("ac-reply-cancel")){var O=t(s).closest(".ac-form");O.slideUp(200),t(".acomment-reply").attr("aria-expanded","false"),m.destroyCommentMediaUploader(r),m.destroyCommentDocumentUploader(r),m.resetActivityCommentForm(O),e.preventDefault()}if("ac_form_submit"===s.prop("name")){var W,H;i=s.closest("form"),a=r,e.preventDefault(),s.closest("li").data("bp-activity-comment-id")&&(a=s.closest("li").data("bp-activity-comment-id")),W=t(i).find(".ac-input").first();for(var q=W.find("span.atwho-query"),K=0;K<q.length;K++)t(q[K]).replaceWith(q[K].innerText);W.find("img.emoji").each(function(e,a){t(a).addClass("emojioneemoji");var i=t(a).attr("alt");t(a).attr("data-emoji-char",i),t(a).removeClass("emoji")}),W.find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),s.addClass("loading").prop("disabled",!0),W.addClass("loading").prop("disabled",!0);var X=W[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"");H={action:"new_activity_comment",_wpnonce_new_activity_comment:t("#_wpnonce_new_activity_comment").val(),comment_id:a,form_id:r,content:X},t("#_bp_as_nonce_"+r).val()&&(H["_bp_as_nonce_"+r]=t("#_bp_as_nonce_"+r).val()),this.dropzone_media.length&&(H.media=this.dropzone_media),this.dropzone_document.length&&(H.document=this.dropzone_document),this.dropzone_video.length&&(H.video=this.dropzone_video,_.isEmpty(H.content)&&(H.content="&#8203;")),_.isUndefined(this.models[r])||(o=this.models[r],H.gif_data=this.models[r].get("gif_data")),H.content=H.content.replace(/&nbsp;/g," "),i.hasClass("acomment-edit")&&(H.edit_comment=!0),d.ajax(H,"activity").done(function(e){if(s.removeClass("loading"),W.removeClass("loading"),t(".acomment-reply").attr("aria-expanded","false"),!1===e.success)i.append(t(e.data.feedback).hide().fadeIn(200));else{var a=i.parent(),d=t.trim(e.data.contents);if(i.fadeOut(200,function(){if(i.hasClass("acomment-edit")){var e=i.attr("data-item-id");i.closest(".activity-comments").append(i),t("li#acomment-"+e).replaceWith(d)}else 0===a.children("ul").length&&(a.hasClass("activity-comments")?a.prepend("<ul></ul>"):a.append("<ul></ul>")),a.children("ul").append(t(d).hide().fadeIn(200)),t(i).find(".ac-input").first().html(""),a.parent().addClass("has-comments"),a.parent().addClass("comments-loaded"),c.addClass("has-comments");var o=i.find(".ac-reply-content");o.find(".ac-reply-toolbar .ac-reply-media-button").length>0&&o.find(".ac-reply-toolbar .ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),o.find(".ac-reply-toolbar .ac-reply-document-button").length>0&&o.find(".ac-reply-toolbar .ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),o.find(".ac-reply-toolbar .ac-reply-video-button").length>0&&o.find(".ac-reply-toolbar .ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable no-click"),o.find(".ac-reply-toolbar .ac-reply-gif-button").length>0&&(o.find(".ac-reply-toolbar .ac-reply-gif-button").removeClass("active "),o.find(".ac-reply-toolbar .ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable no-click")),jQuery(window).scroll()}),!i.hasClass("acomment-edit")){if(w=c.find("span.comments-count"),z=w.text().length?w.text().match(/\d+/)[0]:0,z=Number(z)+1,p.length){var l=z>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(l.replace("%d",z||1))}N=t(n).find(".show-all a"),N&&N.html(BP_Nouveau.show_x_comments.replace("%d",z))}if(m.dropzone_media.length)for(var u=0;u<m.dropzone_media.length;u++)m.dropzone_media[u].saved=!0;if(m.dropzone_document.length)for(var v=0;v<m.dropzone_document.length;v++)m.dropzone_document[v].saved=!0;if(m.dropzone_video.length)for(var b=0;b<m.dropzone_video.length;b++)m.dropzone_video[b].saved=!0}_.isUndefined(o)||(o.set("gif_data",{}),t("#ac-reply-post-gif-"+r).find(".activity-attached-gif-container").removeAttr("style")),m.destroyCommentMediaUploader(r),m.destroyCommentDocumentUploader(r),m.destroyCommentVideoUploader(r),s.prop("disabled",!1),W.prop("disabled",!1)})}if(s.hasClass("edit")&&s.hasClass("edit-activity")){e.preventDefault();var $=n.data("bp-activity"),J=""!==n.data("link-url")?n.data("link-url"):null;void 0!==$&&(bp.Nouveau.Activity.postForm.displayEditActivityForm($,J),s.closest("li").hasClass("groups")?t("#bp-nouveau-activity-form").addClass("group-activity"):t("#bp-nouveau-activity-form").removeClass("group-activity"),void 0!==bp.Nouveau.Media&&void 0!==bp.Nouveau.Media.Theatre&&(bp.Nouveau.Media.Theatre.is_open_media||bp.Nouveau.Media.Theatre.is_open_document)&&(t(document).find(".bb-close-media-theatre").trigger("click"),t(document).find(".bb-close-document-theatre").trigger("click")))}if(s.hasClass("pin-activity")||s.hasClass("unpin-activity")){if(e.preventDefault(),!r)return e;s.closest(".activity-item").addClass("loading-pin");var Y="pin";s.hasClass("unpin-activity")&&(Y="unpin"),d.ajax({action:"activity_update_pinned_post",id:r,pin_action:Y},"activity").done(function(e){if(s.closest(".activity-item").removeClass("loading-pin"),"object"!=typeof e&&(e=JSON.parse(e)),void 0!==e.data&&void 0!==e.data.feedback){var a=s.closest("#activity-stream > ul"),i=s.closest("#activity-stream");if(e.success){var o=bp.Nouveau.getStorage("bp-activity","scope"),d=!1,n=!1,r="";if(s.closest("li.activity-item").hasClass("groups")&&(n=!0,r=s.closest("li.activity-item").attr("class").match(/group-\d+/),r=r[0].replace("group-","")),i.hasClass("single-user")?d=!1:i.hasClass("activity")&&"all"===o&&!n?d=!0:i.hasClass("single-group")&&(d=!0),"pin"===Y){d&&a.find("li.activity-item").removeClass("bb-pinned");var l="li.activity-item:not(.groups)";n&&!i.hasClass("single-group")?l="li.activity-item.group-"+r:n&&i.hasClass("single-group")&&(l="li.activity-item"),a.find(l).each(function(){var e=t(this).find(".unpin-activity");e.removeClass("unpin-activity").addClass("pin-activity"),n?e.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):e.find("span").html(BP_Nouveau.activity.strings.pinPost)}),d&&s.closest("li.activity-item").addClass("bb-pinned"),s.addClass("unpin-activity"),s.removeClass("pin-activity"),s.closest("li.activity-item").hasClass("groups")?s.find("span").html(BP_Nouveau.activity.strings.unpinGroupPost):s.find("span").html(BP_Nouveau.activity.strings.unpinPost)}else"unpin"===Y&&(s.closest("li.activity-item").removeClass("bb-pinned"),s.addClass("pin-activity"),s.removeClass("unpin-activity"),s.closest("li.activity-item").hasClass("groups")?s.find("span").html(BP_Nouveau.activity.strings.pinGroupPost):s.find("span").html(BP_Nouveau.activity.strings.pinPost))}t(document).trigger("bb_trigger_toast_message",["","<div>"+e.data.feedback+"</div>","success",null,!0])}}).fail(function(){s.closest(".activity-item").removeClass("loading-pin"),t(document).trigger("bb_trigger_toast_message",["","<div>"+BP_Nouveau.activity.strings.pinPostError+"</div>","error",null,!0])})}(s.hasClass("activity-state-likes")||s.parents(".activity-state-likes").length>0)&&(e.preventDefault(),s.closest(".activity-content ").find(".activity-state-popup").addClass("active")),(s.hasClass("comment-reactions")||s.parents(".comment-reactions").length>0)&&(e.preventDefault(),s.closest(".acomment-display").find(".activity-state-popup").addClass("active"))},commentFormAction:function(e){var a,i;return e=e||window.event,e.target?a=e.target:e.srcElement&&(a=e.srcElement),3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey?e:"TEXTAREA"===a.tagName&&t(a).hasClass("ac-input")?(i=e.keyCode?e.keyCode:e.which,void(27===i&&!1===e.ctrlKey?"TEXTAREA"===a.tagName&&t(a).closest("form").slideUp(200):e.ctrlKey&&13===i&&t(a).val()&&t(a).closest("form").find("[type=submit]").first().trigger("click"))):e},togglePopupDropdown:function(e){var a;return e=e||window.event,e.target?a=e.target:e.srcElement&&(a=e.srcElement),
3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey?e:t(a).hasClass("privacy-wrap")||t(a).parent().hasClass("privacy-wrap")?e:void t("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e=t(".load-more:visible").last(),a=t(window);if(e.closest(".activity-list").length&&e.get(0)&&!e.data("bp-autoloaded")){var i=e.offset(),o=i.top-50;a.scrollTop()+a.height()>o&&(e.data("bp-autoloaded",1),e.find("a").text(BP_Nouveau.activity.strings.loadingMore),e.find("a").trigger("click"))}},destroyCommentMediaUploader:function(e){var a=this;_.isNull(a.dropzone_obj)||(a.dropzone_obj.destroy(),t("#ac-reply-post-media-uploader-"+e).html(""),t("#ac-reply-post-media-uploader-1-"+e).html("")),a.dropzone_media=[],t("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-media-button-"+e).removeClass("active")},destroyCommentDocumentUploader:function(e){var a=this;_.isNull(a.dropzone_document_obj)||(a.dropzone_document_obj.destroy(),t("#ac-reply-post-document-uploader-"+e).html("")),a.dropzone_document=[],t("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-document-button-"+e).removeClass("active")},destroyCommentVideoUploader:function(e){var a=this;_.isNull(a.dropzone_video_obj)||(a.dropzone_video_obj.destroy(),t("#ac-reply-post-video-uploader-"+e).html("")),a.dropzone_video=[],t("#ac-reply-post-video-uploader-"+e).removeClass("open").addClass("closed"),t("#ac-reply-video-button-"+e).removeClass("active")},resetGifPicker:function(e){if(t("#ac-reply-gif-button-"+e).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open"),t("#ac-reply-gif-button-"+e).removeClass("active"),!_.isUndefined(this.models[e])){var a=this.models[e];a.set("gif_data",{}),t("#ac-reply-post-gif-"+e).find(".activity-attached-gif-container").removeAttr("style")}},openCommentsMediaUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),d=i.closest(".ac-reply-content").find("#ac-reply-post-media-uploader-"+o);if(e.preventDefault(),t(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(d.hasClass("open")&&!e.isCustomEvent)return void d.trigger("click")}else t(e.currentTarget).toggleClass("active");var s=document.getElementsByClassName("ac-reply-post-default-template").length?document.getElementsByClassName("ac-reply-post-default-template")[0].innerHTML:"";if(void 0!==window.Dropzone&&d.length)if(d.hasClass("closed")){var n={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictInvalidFileType:bp_media_dropzone.dictInvalidFileType,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.media.maxFiles?BP_Nouveau.media.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,thumbnailWidth:140,thumbnailHeight:140,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:s,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation,maxThumbnailFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2};a.dropzone_obj=new Dropzone("#ac-reply-post-media-uploader-"+i.data("ac-id"),n),a.dropzone_obj.on("addedfile",function(e){if(e.media_edit_data){a.dropzone_media.push(e.media_edit_data);var t=i.parents(".ac-reply-toolbar");t.find(".ac-reply-media-button")&&t.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}}),a.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i.parents(".ac-reply-toolbar"),d=i.closest(".ac-form");d.addClass("has-media"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),a.dropzone_obj.on("uploadprogress",function(e){var a=i.closest(".ac-form");a.addClass("media-uploading");var o=t(e.previewElement).find(".dz-progress-ring circle")[0],d=o.r.baseVal.value,s=2*d*Math.PI;o.style.strokeDasharray=s+" "+s,o.style.strokeDashoffset=s;var n=s-e.upload.progress.toFixed(0)/100*s;o.style.strokeDashoffset=n}),a.dropzone_obj.on("success",function(e,i){if(i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_media.push(i.data),e.previewElement.classList.add("dz-success");var o,d,s,n,r,l=i.data.feedback;for(e.previewElement.classList.add("dz-error"),n=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],d=0,s=n.length;d<s;d++)o=n[d],r.push(o.textContent=l);return _.isNull(a.dropzone_obj.files)||0!==a.dropzone_obj.files.length||t(a.dropzone_obj.element).removeClass("files-uploaded"),r}),a.dropzone_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),a.dropzone_obj.on("error",function(e,a){if(e.accepted)void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback?t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&t(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error);else{jQuery(".comment-media-error-popup").length||t("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a+"</p></div></div></div></div></transition></div>"),this.removeFile(e);var o=i.closest(".ac-form");o.removeClass("media-uploading")}}),a.dropzone_obj.on("removedfile",function(e){if(a.dropzone_media.length)for(var o in a.dropzone_media)if(e.upload.uuid==a.dropzone_media[o].uuid){void 0===a.dropzone_media[o].saved||a.dropzone_media[o].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_media[o].id),a.dropzone_media.splice(o,1);break}if(_.isNull(a.dropzone_obj)||_.isNull(a.dropzone_obj.files)||0!==a.dropzone_obj.files.length)i.closest(".ac-form").addClass("has-content");else{var d=i.parents(".ac-reply-toolbar"),s=i.closest(".ac-form");s.removeClass("has-media"),d.find(".ac-reply-document-button")&&d.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-video-button")&&d.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-gif-button")&&d.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-media-button")&&d.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),t(a.dropzone_obj.element).removeClass("files-uploaded"),a.validateCommentContent(s.find(".ac-textarea").children(".ac-input"))}}),a.dropzone_obj.on("complete",function(){if(0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0){var e=i.closest(".ac-form");e.removeClass("media-uploading"),this.element.classList.add("files-uploaded")}}),d.removeClass("closed").addClass("open")}else a.dropzone_obj&&void 0!==a.dropzone_obj&&a.dropzone_obj.destroy(),a.dropzone_media=[],d.html(""),d.addClass("closed").removeClass("open");var r=e.currentTarget,l=r.id.match(/\d+$/)[0];this.destroyCommentDocumentUploader(l),this.destroyCommentVideoUploader(l);var c=t(e.currentTarget).data("ac-id");this.resetGifPicker(c),t(i).closest("form.ac-form").hasClass("acomment-edit")&&!e.isCustomEvent&&t(i).closest(".ac-reply-content").find(".dropzone.media-dropzone").trigger("click")},openCommentsDocumentUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),d=i.closest(".ac-reply-content").find("#ac-reply-post-document-uploader-"+o);if(e.preventDefault(),t(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(d.hasClass("open")&&!e.isCustomEvent)return void d.trigger("click")}else t(e.currentTarget).toggleClass("active");var s=document.getElementsByClassName("ac-reply-post-document-template").length?document.getElementsByClassName("ac-reply-post-document-template")[0].innerHTML:"";if(void 0!==window.Dropzone&&d.length)if(d.hasClass("closed")){var n={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.document.maxFiles?BP_Nouveau.document.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.document.max_upload_size?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:s,dictCancelUploadConfirmation:BP_Nouveau.media.dictCancelUploadConfirmation};a.dropzone_document_obj=new Dropzone("#ac-reply-post-document-uploader-"+i.data("ac-id"),n),a.dropzone_document_obj.on("addedfile",function(e){e.document_edit_data&&a.dropzone_document.push(e.document_edit_data);var o=e.upload.filename,d=o.substr(o.lastIndexOf(".")+1);t(e.previewElement).find(".dz-details .dz-icon .bb-icon-file").removeClass("bb-icon-file").addClass("bb-icon-file-"+d);var s=i.parents(".ac-reply-toolbar");s.find(".ac-reply-document-button")&&s.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}),a.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media);var o=i.parents(".ac-reply-toolbar"),d=i.closest(".ac-form");d.addClass("has-media"),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),a.dropzone_document_obj.on("uploadprogress",function(e){var a=i.closest(".ac-form");a.addClass("media-uploading");var o=t(e.previewElement).find(".dz-progress-ring circle")[0],d=o.r.baseVal.value,s=2*d*Math.PI;o.style.strokeDasharray=s+" "+s,o.style.strokeDashoffset=s;var n=s-e.upload.progress.toFixed(0)/100*s;o.style.strokeDashoffset=n}),a.dropzone_document_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()}),a.dropzone_document_obj.on("success",function(e,i){if(i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_document.push(i.data),e.previewElement.classList.add("dz-success");var o,d,s,n,r,l=i.data.feedback;for(e.previewElement.classList.add("dz-error"),n=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],d=0,s=n.length;d<s;d++)o=n[d],r.push(o.textContent=l);return _.isNull(a.dropzone_document_obj.files)||0!==a.dropzone_document_obj.files.length||t(a.dropzone_document_obj.element).removeClass("files-uploaded"),r}),a.dropzone_document_obj.on("error",function(e,a){if(e.accepted)void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback?t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&t(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error);else{jQuery(".comment-document-error-popup").length||t("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-document"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a+"</p></div></div></div></div></transition></div>"),this.removeFile(e);var o=i.closest(".ac-form");o.removeClass("media-uploading")}}),a.dropzone_document_obj.on("removedfile",function(e){if(a.dropzone_document.length)for(var o in a.dropzone_document)if(e.upload.uuid==a.dropzone_document[o].uuid){void 0===a.dropzone_document[o].saved||a.dropzone_document[o].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_document[o].id),a.dropzone_document.splice(o,1);break}if(_.isNull(a.dropzone_document_obj)||_.isNull(a.dropzone_document_obj.files)||0!==a.dropzone_document_obj.files.length)i.closest(".ac-form").addClass("has-content");else{var d=i.parents(".ac-reply-toolbar"),s=i.closest(".ac-form");s.removeClass("has-media"),d.find(".ac-reply-media-button")&&d.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-video-button")&&d.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-gif-button")&&d.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-document-button")&&d.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),t(a.dropzone_document_obj.element).removeClass("files-uploaded"),a.validateCommentContent(s.find(".ac-textarea").children(".ac-input"))}}),a.dropzone_document_obj.on("complete",function(){if(0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0){var e=i.closest(".ac-form");e.removeClass("media-uploading"),this.element.classList.add("files-uploaded")}}),d.removeClass("closed").addClass("open")}else a.dropzone_document_obj&&a.dropzone_document_obj.destroy(),a.dropzone_document=[],d.html(""),d.addClass("closed").removeClass("open");var r=e.currentTarget,l=r.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(l),this.destroyCommentVideoUploader(l);var c=t(e.currentTarget).data("ac-id");this.resetGifPicker(c),t(i).closest("form.ac-form").hasClass("acomment-edit")&&!e.isCustomEvent&&t(i).closest(".ac-reply-content").find(".dropzone.document-dropzone").trigger("click")},openCommentsVideoUploader:function(e){var a=this,i=t(e.currentTarget),o=i.data("ac-id"),d=i.closest(".ac-reply-content").find("#ac-reply-post-video-uploader-"+o);if(e.preventDefault(),t(e.currentTarget).closest(".ac-form").hasClass("acomment-edit")){if(d.hasClass("open")&&!e.isCustomEvent)return void d.trigger("click")}else t(e.currentTarget).toggleClass("active");var s=document.getElementsByClassName("ac-reply-post-video-template").length?document.getElementsByClassName("ac-reply-post-video-template")[0].innerHTML:"";if(void 0!==window.Dropzone&&d.length)if(d.hasClass("closed")){var n={url:BP_Nouveau.ajaxurl,timeout:108e5,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:!1,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFiles:void 0!==BP_Nouveau.video.maxFiles?BP_Nouveau.video.maxFiles:10,maxFilesize:void 0!==BP_Nouveau.video.max_upload_size?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:s,dictCancelUploadConfirmation:BP_Nouveau.video.dictCancelUploadConfirmation};a.dropzone_video_obj=new Dropzone("#ac-reply-post-video-uploader-"+i.data("ac-id"),n),a.dropzone_video_obj.on("sending",function(e,t,a){a.append("action","video_upload"),a.append("_wpnonce",BP_Nouveau.nonces.video);var o=i.parents(".ac-reply-toolbar"),d=i.closest(".ac-form");d.addClass("has-media"),o.find(".ac-reply-media-button")&&o.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-document-button")&&o.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-gif-button")&&o.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable"),o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active"),this.element.classList.remove("files-uploaded")}),a.dropzone_video_obj.on("accept",function(e,t){0==e.size?t(BP_Nouveau.video.empty_video_type):t()}),a.dropzone_video_obj.on("addedfile",function(e){if(e.video_edit_data){a.dropzone_video.push(e.video_edit_data);var o=i.parents(".ac-reply-toolbar");o.find(".ac-reply-video-button")&&o.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("no-click").find(".toolbar-button").addClass("active")}e.dataURL&&e.video_edit_data.thumb.length?(t(e.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+e.video_edit_data.thumb+' " />'),t(e.previewElement).closest(".dz-preview").addClass("dz-has-thumbnail")):bp.Nouveau.getVideoThumb&&bp.Nouveau.getVideoThumb(e,".dz-video-thumbnail")}),a.dropzone_video_obj.on("uploadprogress",function(e){var a=i.closest(".ac-form");a.addClass("media-uploading");var o=t(e.previewElement).find(".dz-progress-ring circle")[0],d=o.r.baseVal.value,s=2*d*Math.PI;o.style.strokeDasharray=s+" "+s;var n=s-e.upload.progress.toFixed(0)/100*s;e.upload.progress<=99?(t(e.previewElement).find(".dz-progress-count").text(e.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),o.style.strokeDashoffset=n):100===e.upload.progress&&(o.style.strokeDashoffset=s-.99*s,t(e.previewElement).find(".dz-progress-count").text("99% "+BP_Nouveau.video.i18n_strings.video_uploaded_text))}),a.dropzone_video_obj.on("success",function(e,i){if(100===e.upload.progress&&(t(e.previewElement).find(".dz-progress-ring circle")[0].style.strokeDashoffset=0,t(e.previewElement).find(".dz-progress-count").text("100% "+BP_Nouveau.video.i18n_strings.video_uploaded_text),t(e.previewElement).closest(".dz-preview").addClass("dz-complete")),i.data.id)return e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.album_id&&BP_Nouveau.video.album_id,i.data.group_id=void 0!==BP_Nouveau.video&&void 0!==BP_Nouveau.video.group_id&&BP_Nouveau.video.group_id,i.data.saved=!1,i.data.js_preview=t(e.previewElement).find(".dz-video-thumbnail img").attr("src"),a.dropzone_video.push(i.data),e.previewElement.classList.add("dz-success");var o,d,s,n,r,l=i.data.feedback;for(e.previewElement.classList.add("dz-error"),n=e.previewElement.querySelectorAll("[data-dz-errormessage]"),r=[],d=0,s=n.length;d<s;d++)o=n[d],r.push(o.textContent=l);return _.isNull(a.dropzone_video_obj.files)||0!==a.dropzone_video_obj.files.length||t(a.dropzone_video_obj.element).removeClass("files-uploaded"),r}),a.dropzone_video_obj.on("error",function(e,a){if(e.accepted)void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback?t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):"error"==e.status&&e.xhr&&0==e.xhr.status&&t(e.previewElement).find(".dz-error-message span").text(BP_Nouveau.media.connection_lost_error);else{jQuery(".comment-video-error-popup").length||t("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup comment-video"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+a+"</p></div></div></div></div></transition></div>"),this.removeFile(e);var o=i.closest(".ac-form");o.removeClass("media-uploading")}}),a.dropzone_video_obj.on("removedfile",function(e){if(a.dropzone_video.length)for(var o in a.dropzone_video)if(e.upload.uuid==a.dropzone_video[o].uuid){void 0===a.dropzone_video[o].saved||a.dropzone_video[o].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_video[o].id),a.dropzone_video.splice(o,1);break}if(_.isNull(a.dropzone_video_obj)||_.isNull(a.dropzone_video_obj.files)||0!==a.dropzone_video_obj.files.length)i.closest(".ac-form").addClass("has-content");else{var d=i.parents(".ac-reply-toolbar"),s=i.closest(".ac-form");s.removeClass("has-media"),d.find(".ac-reply-media-button")&&d.find(".ac-reply-media-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-document-button")&&d.find(".ac-reply-document-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-gif-button")&&d.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").removeClass("disable"),d.find(".ac-reply-video-button")&&d.find(".ac-reply-video-button").parents(".post-elements-buttons-item").removeClass("no-click").find(".toolbar-button").removeClass("active"),t(a.dropzone_video_obj.element).removeClass("files-uploaded"),a.validateCommentContent(s.find(".ac-textarea").children(".ac-input"))}}),a.dropzone_video_obj.on("complete",function(){if(0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&this.files.length>0){var e=i.closest(".ac-form");e.removeClass("media-uploading"),this.element.classList.add("files-uploaded")}}),d.removeClass("closed").addClass("open")}else a.dropzone_video_obj&&a.dropzone_video_obj.destroy(),a.dropzone_video=[],d.html(""),d.addClass("closed").removeClass("open");var r=e.currentTarget,l=r.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(l),this.destroyCommentDocumentUploader(l);var c=t(e.currentTarget).data("ac-id");this.resetGifPicker(c),t(i).closest("form.ac-form").hasClass("acomment-edit")&&!e.isCustomEvent&&t(i).closest(".ac-reply-content").find(".dropzone.video-dropzone").trigger("click")},openGifPicker:function(e){e.preventDefault();var a=e.currentTarget,i=t(a).next(),o=a.id.match(/\d+$/)[0],d=t("#ac-reply-post-gif-"+o);if(i.is(":empty")){var s=new bp.Models.ACReply,n=new bp.Views.GifMediaSearchDropdown({model:s}),r=new bp.Views.ActivityAttachedGifPreview({model:s});i.html(n.render().el),d.html(r.render().el),this.models[o]=s}var l=t(a).parents(".ac-textarea ").find(".ac-reply-attachments .activity-attached-gif-container");t(a).hasClass("active")&&l.length&&""==t.trim(l.html())?t(a).removeClass("active"):t(a).addClass("active"),i.toggleClass("open"),this.destroyCommentMediaUploader(o),this.destroyCommentDocumentUploader(o),this.destroyCommentVideoUploader(o)},toggleMultiMediaOptions:function(e,t){if(!_.isUndefined(BP_Nouveau.media)){var a=t.closest(".activity-item"),i=t.closest(".activity-item").data("bp-activity");t.closest("li").data("bp-activity-comment")&&(i=t.closest("li").data("bp-activity-comment")),t.closest("li").hasClass("groups")||a.hasClass("groups")?(_.isUndefined(i.group_media)?!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.group_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(i.group_document)?!1===BP_Nouveau.media.group_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.group_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isUndefined(i.group_video)?!1===BP_Nouveau.media.group_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===i.group_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(_.isNull(i)||_.isUndefined(i.profile_media)?!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isNull(i)||_.isUndefined(i.profile_document)?!1===BP_Nouveau.media.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):!0===i.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"),_.isNull(i)||_.isUndefined(i.profile_video)?!1===BP_Nouveau.media.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):!0===i.profile_video?e.find(".ac-reply-toolbar .post-video.video-support").show().parent(".ac-reply-toolbar").removeClass("post-video-disabled"):e.find(".ac-reply-toolbar .post-video.video-support").hide().parent(".ac-reply-toolbar").addClass("post-video-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled"))}},fixAtWhoActivity:function(){t(".acomment-content, .activity-content").each(function(){for(var e=t(this).find("span.atwho-query"),a=0;a<e.length;a++)t(e[a]).replaceWith(e[a].innerText)})},toggleActivityOption:function(e){t(e.target).hasClass("bb-activity-more-options-action")||t(e.target).parent().hasClass("bb-activity-more-options-action")?t(e.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").hasClass("is_visible open")?(t(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible open"),t("body").removeClass("more_option_open")):(t(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible open"),t(e.target).closest(".bb-activity-more-options-wrap").find(".bb-activity-more-options").addClass("is_visible open"),t("body").addClass("more_option_open")):(t(".bb-activity-more-options-wrap").find(".bb-activity-more-options").removeClass("is_visible open"),t("body").removeClass("more_option_open"))},navigateToSpecificComment:function(){setTimeout(function(){if(window.location.hash){var e=window.location.hash,a=0!==t("#wpadminbar").length?t("#wpadminbar").innerHeight():0;t(e).length>0&&t("html, body").animate({scrollTop:parseInt(t(e).offset().top)-(80+a)},0)}},200)},createThumbnailFromUrl:function(e){var t=this;t.dropzone_obj.createThumbnailFromUrl(e,t.dropzone_obj.options.thumbnailWidth,t.dropzone_obj.options.thumbnailHeight,t.dropzone_obj.options.thumbnailMethod,!0,function(a){t.dropzone_obj.emit("thumbnail",e,a),t.dropzone_obj.emit("complete",e)})},editActivityCommentForm:function(e,a){var i=e.find('input[name="comment_form_id"]').val(),o=e.find("#ac-reply-toolbar-"+i),d=e.find('input[name="ac_form_submit"]'),s=this;e.find("#ac-input-"+i).html(a.content);var n=d.attr("data-add-edit-label");if(d.attr("data-add-edit-label",d.val()).val(n),void 0!==a.media&&0<a.media.length){o.find(".ac-reply-media-button").trigger({type:"click",isCustomEvent:!0}),s.disabledCommentDocumentUploader(o),s.disabledCommentVideoUploader(o),s.disabledCommentGifPicker(o);for(var r=!1,l=a.media.length,c=0;c<l;c++){r=!1;var p={};p=0<parseInt(a.id)?{id:a.media[c].attachment_id,media_id:a.media[c].id,name:a.media[c].name,thumb:a.media[c].thumb,url:a.media[c].url,uuid:a.media[c].attachment_id,menu_order:a.media[c].menu_order,album_id:a.media[c].album_id,group_id:a.media[c].group_id,saved:!0}:{id:a.media[c].id,name:a.media[c].name,thumb:a.media[c].thumb,url:a.media[c].url,uuid:a.media[c].id,menu_order:a.media[c].menu_order,album_id:a.media[c].album_id,group_id:a.media[c].group_id,saved:!1},r={name:a.media[c].name,accepted:!0,kind:"image",upload:{filename:a.media[c].name,uuid:a.media[c].attachment_id},dataURL:a.media[c].url,id:a.media[c].attachment_id,media_edit_data:p},s.dropzone_obj&&(s.dropzone_obj.files.push(r),s.dropzone_obj.emit("addedfile",r),s.createThumbnailFromUrl(r),
s.dropzone_obj.emit("dz-success"),s.dropzone_obj.emit("dz-complete"))}}if(void 0!==a.document&&0<a.document.length){o.find(".ac-reply-document-button").trigger({type:"click",isCustomEvent:!0}),s.disabledCommentMediaUploader(o),s.disabledCommentVideoUploader(o),s.disabledCommentGifPicker(o);for(var m=!1,u=a.document.length,v=0;v<u;v++){m=!1;var b={};b=0<parseInt(a.id)?{id:a.document[v].doc_id,name:a.document[v].full_name,full_name:a.document[v].full_name,type:"document",url:a.document[v].url,size:a.document[v].size,uuid:a.document[v].doc_id,document_id:a.document[v].id,menu_order:a.document[v].menu_order,folder_id:a.document[v].folder_id,group_id:a.document[v].group_id,saved:!0,svg_icon:_.isUndefined(a.document[v].svg_icon)?"":a.document[v].svg_icon}:{id:a.document[v].id,name:a.document[v].full_name,full_name:a.document[v].full_name,type:"document",url:a.document[v].url,size:a.document[v].size,uuid:a.document[v].id,menu_order:a.document[v].menu_order,folder_id:a.document[v].folder_id,group_id:a.document[v].group_id,saved:!1,svg_icon:_.isUndefined(a.document[v].svg_icon)?"":a.document[v].svg_icon},m={name:a.document[v].full_name,size:a.document[v].size,accepted:!0,kind:"file",upload:{filename:a.document[v].full_name,uuid:a.document[v].doc_id},dataURL:a.document[v].url,id:a.document[v].doc_id,document_edit_data:b,svg_icon:_.isUndefined(a.document[v].svg_icon)?"":a.document[v].svg_icon},s.dropzone_document_obj&&(s.dropzone_document_obj.files.push(m),s.dropzone_document_obj.emit("addedfile",m),s.dropzone_document_obj.emit("complete",m))}}if(void 0!==a.video&&0<a.video.length){o.find(".ac-reply-video-button").trigger({type:"click",isCustomEvent:!0}),s.disabledCommentMediaUploader(o),s.disabledCommentDocumentUploader(o),s.disabledCommentGifPicker(o);for(var f=!1,h=a.video.length,y=0;y<h;y++){f=!1;var g={};g=0<parseInt(a.id)?{id:a.video[y].vid_id,name:a.video[y].name,type:"video",thumb:a.video[y].thumb,url:a.video[y].url,size:a.video[y].size,uuid:a.video[y].vid_id,video_id:a.video[y].id,menu_order:a.video[y].menu_order,album_id:a.video[y].album_id,group_id:a.video[y].group_id,saved:!0}:{id:a.video[y].id,name:a.video[y].name,type:"video",thumb:a.video[y].thumb,url:a.video[y].url,size:a.video[y].size,uuid:a.video[y].id,menu_order:a.video[y].menu_order,album_id:a.video[y].album_id,group_id:a.video[y].group_id,saved:!1},f={name:a.video[y].name,size:a.video[y].size,accepted:!0,kind:"file",upload:{filename:a.video[y].name,uuid:a.video[y].vid_id},dataURL:a.video[y].url,id:a.video[y].vid_id,video_edit_data:g},console.log(f),console.log(s.dropzone_video_obj),s.dropzone_video_obj&&(s.dropzone_video_obj.files.push(f),s.dropzone_video_obj.emit("addedfile",f),s.dropzone_video_obj.emit("complete",f))}}if(void 0!==a.gif&&0<Object.keys(a.gif).length){var C=o.find(".ac-reply-gif-button").next(),w=t("#ac-reply-post-gif-"+i);o.find(".ac-reply-gif-button").trigger("click"),s.disabledCommentMediaUploader(o),s.disabledCommentDocumentUploader(o),s.disabledCommentVideoUploader(o);var z=new bp.Models.ACReply,N=new bp.Views.GifMediaSearchDropdown({model:z}),j=new bp.Views.ActivityAttachedGifPreview({model:z});N.model.set("gif_data",a.gif),C.html(N.render().el),w.html(j.render().el),this.models[i]=z}void 0===a.media&&void 0===a.document&&void 0===a.video&&void 0===a.gif&&e.find(".ac-reply-toolbar .post-elements-buttons-item").removeClass("disable")},resetActivityCommentForm:function(e){if(e.hasClass("acomment-edit")){var a=e.find('input[name="comment_form_id"]').val(),i=e.attr("data-item-id"),o=t('[data-bp-activity-comment-id="'+i+'"]'),d=e.find('input[name="ac_form_submit"]');o.find("#acomment-display-"+i).removeClass("bp-hide"),e.removeClass("acomment-edit").removeAttr("data-item-id");var s=d.attr("data-add-edit-label");d.attr("data-add-edit-label",d.val()).val(s),e.find("#ac-input-"+a).html(""),e.removeClass("has-content"),this.destroyCommentMediaUploader(a),this.destroyCommentDocumentUploader(a),this.destroyCommentVideoUploader(a),this.resetGifPicker(a)}},disabledCommentMediaUploader:function(e){e.find(".ac-reply-media-button")&&e.find(".ac-reply-media-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentDocumentUploader:function(e){e.find(".ac-reply-document-button")&&e.find(".ac-reply-document-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentVideoUploader:function(e){e.find(".ac-reply-video-button")&&e.find(".ac-reply-video-button").parents(".post-elements-buttons-item").addClass("disable")},disabledCommentGifPicker:function(e){e.find(".ac-reply-gif-button")&&e.find(".ac-reply-gif-button").parents(".post-elements-buttons-item").addClass("disable")},validateCommentContent:function(e){var a=e.html(),i=t.trim(a.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""));i=i.replace(/&nbsp;/g," ");var o=e.text().trim();""!==o||i.indexOf("emojioneemoji")>=0?e.closest("form").addClass("has-content"):e.closest("form").removeClass("has-content")},showActivityReactions:function(e){e.preventDefault();var a,i,o=t(this),d=!0,s="activity",n=0,r=o.parents(".acomment-display").first();if(0<r.length&&(d=!1,s="activity_comment"),d?(a=o.parents(".activity-item"),n=a.data("bp-activity-id"),i=a.find(".activity-content")):(a=o.parents(".activity-comment").first(),n=a.data("bp-activity-comment-id"),i=a.find("#acomment-display-"+n)),i.find(".activity-state-popup").length<=0){var l=wp.template("activity-reactions-popup"),c=l();i.append(c),i.find(".activity-state-popup").addClass("active"),i.find(".activity-state-popup").hasClass("loaded")||t.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"bb_get_reactions",item_id:n,item_type:s,_wpnonce:BP_Nouveau.nonces.activity},success:function(e){if(console.log(e.data.reactions),void 0!==e.data.reactions){var a=e.data,o=l(a);i.find(".activity-state-popup").replaceWith(o),i.find(".activity-state-popup").addClass("loaded active");var d=i.find(".activity-state-popup .activity-state-popup_tab_item ul");d.on("scroll",function(){bp.Nouveau.Activity.ReactionLoadMore(t(this),n,s)})}}})}else i.find(".activity-state-popup").addClass("active")},ReactionLoadMore:function(e,a,i){if(!e.hasClass("loading")){var o=e[0].scrollHeight-e.scrollTop()-e.outerHeight(),d=10,s=e.parent().data("reaction-id"),n=e.parent().data("total-pages"),r=e.parent().attr("data-paged"),l=wp.template("activity-user-reactions-popup-list");(void 0===r||0>=r)&&(r=1),o<=d&&r<n&&!e.hasClass("loading")&&(e.append('<li class="reactions_loader"><i class="b-icon-l bb-icon-spinner animate-spin"></i></li>'),e.addClass("loading"),r=parseInt(r,10)+1,t.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"bb_get_reactions",reaction_id:s,item_id:a,item_type:i,paged:r,_wpnonce:BP_Nouveau.nonces.activity},success:function(t){void 0!==t.data.reactions&&(e.parent().attr("data-paged",r),e.append(l(t.data.reactions)),e.find(".reactions_loader").remove(),e.removeClass("loading"))}}))}},ReactionStatePopupTab:function(e){e.preventDefault(),t(this).closest(".activity-state-popup").find(".activity-state-popup_tab_panel li a").removeClass("active"),t(this).addClass("active"),t(this).closest(".activity-state-popup").find(".activity-state-popup_tab_content .activity-state-popup_tab_item").removeClass("active"),t(this).closest(".activity-state-popup").find("."+t(this).data("tab")).addClass("active")},closeActivityState:function(){t(".activity-state-popup").removeClass("active")}},bp.Nouveau.Activity.start())}(bp,jQuery);