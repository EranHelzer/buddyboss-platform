window.wp=window.wp||{},window.bp=window.bp||{},function(o){"undefined"!=typeof BP_Nouveau&&(_.extend(bp,_.pick(wp,"Backbone","ajax","template")),bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.Nouveau=bp.Nouveau||{},bp.Nouveau.ActivityReaction={start:function(){this.views=new Backbone.Collection,this.collections=[],this.types=[],this.fetchXhr=[],this.loader=[],this.loader_html=o('<p class="reaction-loader"><i className="bb-icon-l bb-icon-spinner animate-spin"></i></p>'),this.addListeners(),this.Initialize()},addListeners:function(){o(document).on("click",".activity-state-reactions",this.showActivityReactions)},Initialize:function(){},showActivityReactions:function(t){t.preventDefault();var e=bp.Nouveau.ActivityReaction,i=o(t.currentTarget),a=i.next(".activity-state-popup"),n=i.parents(".activity-item").data("bp-activity-id").toString(),t=i.parents("li").hasClass("activity-comment"),i=n+"_0";""==o.trim(a.find("#reaction-content-"+n).html())&&(e.collections[i]=new bp.Collections.ActivityReactionCollection,e.loader[n]=new bp.Views.ReactionPopup({collection:e.collections[i],item_id:n,targetElement:a.find("#reaction-content-"+n),item_type:!0===t?"activity_comment":"activity"})),a.show()}},bp.Models.reactedItems=Backbone.Model.extend({}),bp.Collections.ActivityReactionCollection=Backbone.Collection.extend({model:bp.Models.reactedItems,options:{},per_page:20,this:this,url:BP_Nouveau.ajaxurl,initialize:function(){this.options={page:1,per_page:this.per_page,action:"bb_get_reactions",total_pages:1,item_type:"activity"}},sync:function(t,e,i){return(i=i||{}).context=this,i.data=i.data||{},i.path=BP_Nouveau.ajaxurl,i.method="POST",i.data=_.extend(i.data,e.options),i.data._wpnonce=BP_Nouveau.nonces.activity,Backbone.sync(t,e,i)},parse:function(t){t=t.success?t.data:{};return _.isUndefined(t.reacted_users)?{}:t.reacted_users}}),bp.Views.ReactionPopup=Backbone.View.extend({tagName:"div",className:"",template:bp.template("activity-reacted-popup-loader"),targetElement:"",options:{},initialize:function(t){this.loader=bp.Nouveau.ActivityReaction.loader_html,this.options=t,this.targetElement=t.targetElement,this.targetElement.append(this.loader),this.collection.fetch({data:_.pick(t,["page","per_page","item_id","item_type"]),success:_.bind(this.render,this),error:_.bind(this.failedRender,this)})},render:function(t,e,i){this.loader.hide();var a={collection:this.options.collection,item_id:this.options.item_id,item_type:this.options.item_type,model:this.collection.last(),data:e.success?e.data:{}},e=new bp.Views.ReactionPopupHeading(a);this.targetElement.append(e.render().el);a=new bp.Views.ReactionPopupContent(a);return this.targetElement.append(a.render().el),this},failedRender:function(t,e,i){}}),bp.Views.ReactionPopupHeading=Backbone.View.extend({tagName:"div",className:"activity-state-popup_title",template:bp.template("activity-reacted-popup-heading"),initialize:function(t){this.data=t.data},render:function(){return this.$el.html(this.template(this.data)),this}}),bp.Views.ReactionPopupContent=Backbone.View.extend({tagName:"div",template:_.template(""),className:"activity-state-popup_tab",options:{},initialize:function(t){this.options=t,this.data=t.data},render:function(){var t={collection:this.options.collection,item_id:this.options.item_id,item_type:this.options.item_type,model:this.model,data:this.data},e=new bp.Views.ReactionPopupTabs(t);this.$el.append(e.render().el);t=new bp.Views.ReactionPopupLists(t);return this.$el.append(t.render().el),this}}),bp.Views.ReactionPopupTabs=Backbone.View.extend({tagName:"div",className:"activity-state-popup_tab_panel",template:bp.template("activity-reacted-popup-tab"),model:this.model,options:{},collection:{},targetElement:"",initialize:function(t){this.loader=bp.Nouveau.ActivityReaction.loader_html,this.options=t,this.collection=t.collection,this.$el.on("click","li > a",_.bind(this.LoadTabData,this)),this.args={collection:this.options.collection,item_id:this.options.item_id,item_type:this.options.item_type,model:this.model}},render:function(){return this.$el.html(this.template(this.options.data)),this},LoadTabData:function(t){var arguments,e=o(t.currentTarget),i=e.data("tab");this.targetElement=e.parents(".activity-state-popup_tab").find("."+i),0<this.targetElement.length&&0===this.targetElement.find(".activity-state_users li").length&&(this.targetElement.append(this.loader.show()),i=(arguments={item_id:this.options.item_id,item_type:this.options.item_type,reaction_id:this.targetElement.data("reaction-id"),page:this.targetElement.data("paged")}).item_id+"_"+arguments.reaction_id,void 0===bp.Nouveau.ActivityReaction.collections[i]&&(bp.Nouveau.ActivityReaction.collections[i]=new bp.Collections.ActivityReactionCollection),this.collection=bp.Nouveau.ActivityReaction.collections[i],this.args.collection=this.collection,this.collection.on("sync",this.renderLoad,this),this.collection.fetch({data:_.pick(arguments,["page","per_page","item_id","item_type","reaction_id"])}))},renderLoad:function(){this.loader.hide(),this.args.model=this.collection;var t=new bp.Views.ReactionItem(this.args);return this.targetElement.find(".activity-state_users").append(t.render().el),this}}),bp.Views.ReactionPopupLists=Backbone.View.extend({tagName:"div",className:"activity-state-popup_tab_content",template:bp.template("activity-reacted-popup-tab-content"),initialize:function(t){this.options=t,this.data=t.data},render:function(){return this.$el.html(this.template(this.data)),this}}),bp.Views.ReactionItem=Backbone.View.extend({template:bp.template("activity-reacted-item"),render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),bp.Nouveau.ActivityReaction.start())}((bp,jQuery));