window.bp=window.bp||{};(function(a,b){if(typeof BP_Nouveau==="undefined"){return}bp.Nouveau=bp.Nouveau||{};bp.Nouveau.Media={start:function(){this.setupGlobals();this.addListeners()},setupGlobals:function(){var c=b("body");this.current_page=1;this.current_page_existing_media=1;this.current_page_albums=1;this.current_tab=c.hasClass("single-topic")||c.hasClass("single-forum")?false:"bp-dropzone-content";this.sort_by="";this.order_by="";this.currentTargetParent=BP_Nouveau.media.current_folder;this.moveToIdPopup=BP_Nouveau.media.move_to_id_popup;this.moveToTypePopup=BP_Nouveau.media.current_type;this.privacySelectorSelect="";this.privacySelectorSpan="";this.currentAlbum=BP_Nouveau.media.current_album;if(typeof window.Dropzone!=="undefined"){window.Dropzone.autoDiscover=false}var f=document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:"";this.documentOptions={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:false,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.document.maxFiles!=="undefined"?BP_Nouveau.document.maxFiles:10,maxFilesize:typeof BP_Nouveau.document.max_upload_size!=="undefined"?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:f,};var d=document.getElementsByClassName("forum-post-video-template").length?document.getElementsByClassName("forum-post-video-template")[0].innerHTML:"";this.videoOptions={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictFileTooBig:BP_Nouveau.video.dictFileTooBig,acceptedFiles:BP_Nouveau.video.video_type,createImageThumbnails:false,dictDefaultMessage:BP_Nouveau.video.dropzone_video_message,autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.video.maxFiles!=="undefined"?BP_Nouveau.video.maxFiles:10,maxFilesize:typeof BP_Nouveau.video.max_upload_size!=="undefined"?BP_Nouveau.video.max_upload_size:2,dictInvalidFileType:BP_Nouveau.video.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.video.video_dict_file_exceeded,previewTemplate:d,};if(b("#bp-media-uploader").hasClass("bp-media-document-uploader")){var g=document.getElementsByClassName("forum-post-document-template").length?document.getElementsByClassName("forum-post-document-template")[0].innerHTML:"";this.options={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,acceptedFiles:BP_Nouveau.media.document_type,createImageThumbnails:false,dictDefaultMessage:BP_Nouveau.media.dropzone_document_message,autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.document.maxFiles!=="undefined"?BP_Nouveau.document.maxFiles:10,maxFilesize:typeof BP_Nouveau.document.max_upload_size!=="undefined"?BP_Nouveau.document.max_upload_size:2,dictInvalidFileType:BP_Nouveau.document.dictInvalidFileType,dictMaxFilesExceeded:BP_Nouveau.media.document_dict_file_exceeded,previewTemplate:g,}}else{var e=document.getElementsByClassName("forum-post-media-template").length?document.getElementsByClassName("forum-post-media-template")[0].innerHTML:"";this.options={url:BP_Nouveau.ajaxurl,timeout:3*60*60*1000,dictFileTooBig:BP_Nouveau.media.dictFileTooBig,dictDefaultMessage:BP_Nouveau.media.dropzone_media_message,acceptedFiles:"image/*",autoProcessQueue:true,addRemoveLinks:true,uploadMultiple:false,maxFiles:typeof BP_Nouveau.media.maxFiles!=="undefined"?BP_Nouveau.media.maxFiles:10,maxFilesize:typeof BP_Nouveau.media.max_upload_size!=="undefined"?BP_Nouveau.media.max_upload_size:2,dictMaxFilesExceeded:BP_Nouveau.media.media_dict_file_exceeded,previewTemplate:e,}}if(typeof BP_Nouveau.media.dropzone_options!=="undefined"){Object.assign(this.options,BP_Nouveau.media.dropzone_options)}this.dropzone_obj=[];this.dropzone_media=[];this.album_id=typeof BP_Nouveau.media.album_id!=="undefined"?BP_Nouveau.media.album_id:false;this.current_folder=typeof BP_Nouveau.media.current_folder!=="undefined"?BP_Nouveau.media.current_folder:false;this.current_group_id=typeof BP_Nouveau.media.current_group_id!=="undefined"?BP_Nouveau.media.current_group_id:false;this.group_id=typeof BP_Nouveau.media.group_id!=="undefined"?BP_Nouveau.media.group_id:false;this.bbp_is_reply_edit=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.bbp_is_reply_edit!=="undefined"&&window.BP_Forums_Nouveau.media.bbp_is_reply_edit;this.bbp_is_topic_edit=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.bbp_is_topic_edit!=="undefined"&&window.BP_Forums_Nouveau.media.bbp_is_topic_edit;this.bbp_is_forum_edit=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.bbp_is_forum_edit!=="undefined"&&window.BP_Forums_Nouveau.media.bbp_is_forum_edit;this.bbp_reply_edit_media=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.reply_edit_media!=="undefined"?window.BP_Forums_Nouveau.media.reply_edit_media:[];this.bbp_reply_edit_document=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.reply_edit_document!=="undefined"?window.BP_Forums_Nouveau.media.reply_edit_document:[];this.bbp_reply_edit_video=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.reply_edit_video!=="undefined"?window.BP_Forums_Nouveau.media.reply_edit_video:[];this.bbp_topic_edit_media=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.topic_edit_media!=="undefined"?window.BP_Forums_Nouveau.media.topic_edit_media:[];this.bbp_topic_edit_video=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.topic_edit_video!=="undefined"?window.BP_Forums_Nouveau.media.topic_edit_video:[];this.bbp_topic_edit_document=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.topic_edit_document!=="undefined"?window.BP_Forums_Nouveau.media.topic_edit_document:[];this.bbp_forum_edit_media=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.forum_edit_media!=="undefined"?window.BP_Forums_Nouveau.media.forum_edit_media:[];this.bbp_forum_edit_document=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.forum_edit_document!=="undefined"?window.BP_Forums_Nouveau.media.forum_edit_document:[];this.bbp_forum_edit_video=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.forum_edit_video!=="undefined"?window.BP_Forums_Nouveau.media.forum_edit_video:[];this.bbp_reply_edit_gif_data=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.reply_edit_gif_data!=="undefined"?window.BP_Forums_Nouveau.media.reply_edit_gif_data:[];this.bbp_topic_edit_gif_data=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.topic_edit_gif_data!=="undefined"?window.BP_Forums_Nouveau.media.topic_edit_gif_data:[];this.bbp_forum_edit_gif_data=typeof window.BP_Forums_Nouveau!=="undefined"&&typeof window.BP_Forums_Nouveau.media.forum_edit_gif_data!=="undefined"?window.BP_Forums_Nouveau.media.forum_edit_gif_data:[];this.giphy=null;this.gif_offset=0;this.gif_q=null;this.gif_limit=20;this.gif_requests=[];this.gif_data=[];this.gif_container_key=false;bp.Nouveau.Media.documentCodeMirror();b(window).on("scroll resize",function(){bp.Nouveau.Media.documentCodeMirror()})},addListeners:function(){var d=b(".bp-nouveau");var c=b(".bp-existing-media-wrap");d.on("click","#bp-add-media",this.openUploader.bind(this));d.on("click","#bp-add-document",this.openDocumentUploader.bind(this));d.on("click","#bp-media-submit",this.submitMedia.bind(this));d.on("click","#bp-media-document-submit",this.submitDocumentMedia.bind(this));d.on("click","#bp-media-uploader-close",this.closeUploader.bind(this));d.on("click","#bb-delete-media",this.deleteMedia.bind(this));d.on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this));b('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request);d.on("click","#bb-create-album",this.openCreateAlbumModal.bind(this));b(document).on("click","#bb-create-folder",this.openCreateFolderModal.bind(this));b(document).on("click","#bb-create-folder-child",this.openCreateFolderChildModal.bind(this));b(document).on("click","#bp-edit-folder-open",this.openEditFolderChildModal.bind(this));b(document).on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this));b(document).on("click","#bp-media-create-folder-submit",this.saveFolder.bind(this));b(document).on("click","#bp-media-create-child-folder-submit",this.saveChildFolder.bind(this));d.on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this));b(document).on("click","#bp-media-create-folder-close",this.closeCreateFolderModal.bind(this));b(document).on("click","#bp-media-edit-folder-close",this.closeEditFolderModal.bind(this));b(document).on("click",".open-popup .errorPopup",this.closeErrorPopup.bind(this));d.on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this));b("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this));b('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this));b(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this));c.on("click","li.load-more",this.appendMedia.bind(this));d.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this));c.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this));d.on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this));b(document).on("click","#bp-edit-folder-title",this.editFolderTitle.bind(this));d.on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this));d.on("click","#bp-save-album-title",this.saveAlbum.bind(this));b(document).on("click","#bp-save-folder-title",this.saveFolder.bind(this));d.on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this));d.on("change","#media-stream select#bb-folder-privacy",this.savePrivacy.bind(this));d.on("click","#bb-delete-album",this.deleteAlbum.bind(this));b(document).on("click","#bb-delete-folder",this.deleteFolder.bind(this));b(document).on("click","ul.document-nav li",this.resetPageDocumentDirectory.bind(this));b(document).on("click","ul.document-nav li a",this.resetPageDocumentDirectory.bind(this));b(document).on("click","#forums-media-button",this.openForumsUploader.bind(this));b(document).on("click","#forums-document-button",this.openForumsDocumentUploader.bind(this));b(document).on("click","#forums-video-button",this.openForumsVideoUploader.bind(this));b(document).on("click","#forums-gif-button",this.toggleGifSelector.bind(this));b(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keyup",".search-query-input",this.searchGif.bind(this));b(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this));b(document).find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this));if(!b(".buddypress.groups.messages").length){b(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this))}b(document).find("form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this));b(document).find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this));b(document).on("click",".gif-image-container",this.playVideo.bind(this));b(document).on("click",".directory.document  .media-folder_action__anchor, .directory.document  .media-folder_action__anchor li a, .bb-media-container .media-folder_action__anchor, .bb-media-container  .media-folder_action__list li a",this.fileActionButton.bind(this));b(document).on("click",".bb-activity-media-elem .copy_download_file_url a, .media-folder_action__list .copy_download_file_url a, .media .bb-photo-thumb .copy_download_file_url a",this.copyDownloadLink.bind(this));b(document).on("click",".bb-activity-media-elem.media-activity .media-action-wrap .media-action_more, #media-stream.media .bb-photo-thumb .media-action-wrap .media-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_list li a",this.fileActivityActionButton.bind(this));b(document).click(this.toggleFileActivityActionButton);b(document).on("click",".bb-activity-media-elem.document-activity .document-expand .document-expand-anchor",this.expandCodePreview.bind(this));b(document).on("click",".bb-activity-media-elem.document-activity .document-action-wrap .document-action_collapse",this.collapseCodePreview.bind(this));b(document).on("click",".activity .bp-document-move-activity, #media-stream .bp-document-move-activity",this.moveDocumentIntoFolder.bind(this));b(document).on("click",'.bp-nouveau [data-bp-list="document"] .pager .dt-more-container.load-more',this.injectDocuments.bind(this));b(document).on("click",'.bp-nouveau [data-bp-list="document"] .data-head',this.sortDocuments.bind(this));b(document).on("click",".modal-container .bb-field-steps-actions",this.documentPopupNavigate.bind(this));b(document).on("click",".bp-media-document-uploader .modal-container .bb-field-uploader-actions",this.uploadDocumentNavigate.bind(this));b(document).on("click",".bp-media-photo-uploader .modal-container .bb-field-uploader-actions",this.uploadMediaNavigate.bind(this));b(document).on("click",".modal-container #bp-media-edit-child-folder-submit",this.renameChildFolder.bind(this));b(document).on("click",".activity .bp-media-move-activity, #media-stream .bp-media-move-activity",this.moveMediaIntoAlbum.bind(this));var f=b("#bb-media-model-container .activity-list, #media-stream");b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-move, .ac-folder-move",this.openDocumentMove.bind(this));b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream, .group-media #media-stream').on("click",".ac-media-move",this.openMediaMove.bind(this));b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-close-button, .ac-folder-close-button",this.closeDocumentMove.bind(this));b('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-media-close-button",this.closeMediaMove.bind(this));f.on("click",".ac-document-rename",this.renameDocument.bind(this));f.on("click",".ac-document-privacy",this.editPrivacyDocument.bind(this));f.on("keyup",".media-folder_name_edit",this.renameDocumentSubmit.bind(this));f.on("click",".name_edit_cancel, .name_edit_save",this.renameDocumentSubmit.bind(this));b(document).on("click",".document-file-delete",this.deleteDocument.bind(this));b(document).on("click",".media-file-delete",this.deleteMedia.bind(this));b(document).on("click",".bp-folder-move",this.folderMove.bind(this));b(document).on("click",".bp-document-open-create-popup-folder",this.createFolderInPopup.bind(this));b(document).on("click",".bp-media-open-create-popup-folder",this.createAlbumInPopup.bind(this));b(document).on("click",".close-create-popup-folder",this.closeCreateFolderInPopup.bind(this));b(document).on("click",".close-create-popup-album",this.closeCreateAlbumInPopup.bind(this));b(document).on("click",".bp-document-create-popup-folder-submit",this.submitCreateFolderInPopup.bind(this));b(document).on("click",".bp-media-create-popup-album-submit",this.submitCreateAlbumInPopup.bind(this));var g=b(".buddypress.groups.messages");var j=b(".buddypress.groups.messages form#send_group_message_form #whats-new-toolbar");var i=b(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container .gif-search-results");var h=b(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container");g.on("click","#bp-group-messages-media-button",this.openGroupMessagesUploader.bind(this));g.on("click","#bp-group-messages-document-button",this.openGroupMessagesDocumentUploader.bind(this));g.on("click","#bp-group-messages-video-button",this.openGroupMessagesVideoUploader.bind(this));g.on("click","#bp-group-messages-gif-button",this.toggleGroupMessagesGifSelector.bind(this));j.on("keyup",".search-query-input",this.searchGroupMessagesGif.bind(this));j.on("click",".found-media-item",this.selectGroupMessagesGif.bind(this));i.scroll(this.loadMoreGroupMessagesGif.bind(this));b(".groups.messages form#send_group_message_form #whats-new-toolbar .bp-group-messages-attached-gif-container .gif-search-results").scroll(this.loadMoreGroupMessagesGif.bind(this));h.on("click",".gif-image-remove",this.removeGroupMessagesSelectedGif.bind(this));b(document).on("click",".gif-image-container",this.playVideo.bind(this));b(".bp-existing-media-wrap").on("scroll",this.loadExistingMedia.bind(this));document.addEventListener("keyup",this.closePopup.bind(this));document.addEventListener("keyup",this.submitPopup.bind(this));if(!_.isUndefined(BP_Nouveau.media.gif_api_key)){window.addEventListener("scroll",this.autoPlayGifVideos,false);window.addEventListener("resize",this.autoPlayGifVideos,false);document.addEventListener("keydown",_.bind(this.closePickersOnEsc,this));b(document).on("click",_.bind(this.closePickersOnClick,this))}if((this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)){b("#forums-media-button").trigger("click")}if((this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)){b("#forums-document-button").trigger("click")}if((this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)){b("#forums-video-button").trigger("click")}if((this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)){this.editGifPreview();var e=jQuery("#forums-gif-button").addClass("active").closest("form");if(e.find("#forums-document-button")){e.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(e.find("#forums-media-button")){e.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(e.find("#forums-video-button")){e.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}}if(window.location.hash=="#openEditFolder"&&b("#bp-media-edit-child-folder").length){history.pushState(null,null,window.location.href.split("#")[0]);b("#bp-media-edit-child-folder").show()}},loadExistingMedia:function(){b(window).scroll()},resetPageDocumentDirectory:function(c){c.preventDefault();this.current_page=1},submitCreateFolderInPopup:function(c){c.preventDefault();var m=b(c.currentTarget).closest(".open-popup");var l=b(m).find(".bp-document-create-popup-folder-submit");var f=m.find(".bb-folder-selected-id").val();var n=b.trim(b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder-title").val());var e=b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder-title");var k=/[\\/?%*:|"<>]+/g;var i=k.exec(e.val());var j=Boolean(i);if(b.trim(e.val())===""||j){e.addClass("error");return false}else{e.removeClass("error")}if(""===f){f=0}this.currentTargetParent=f;var h=this.currentTargetParent;var g=0;var d="";var p="";var o=0;if("group"===this.moveToTypePopup){d="grouponly";g=this.moveToIdPopup}else{d=b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder #bb-folder-privacy").val();p=b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder #bb-folder-privacy")}if(""===n){alert(BP_Nouveau.media.create_folder_error_title);return false}l.addClass("loading");setTimeout(function(){var q={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:n,privacy:d,parent:h,group_id:g};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:q,async:false,success:function(s){if(s.success){if(b(".document-data-table-head").length){if(parseInt(h)===parseInt(BP_Nouveau.media.current_folder)){bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",s.data.document,"prepend");jQuery(window).scroll()}}else{}m.find(".location-folder-list-wrap .location-folder-list").remove();m.find(".location-folder-list-wrap").append(s.data.tree_view);var r="#"+b(m).attr("id");if(bp.Nouveau.Media.folderLocationUI){bp.Nouveau.Media.folderLocationUI(r,s.data.folder_id)}o=s.data.folder_id;if(""===s.data.tree_view){m.find(".location-folder-list-wrap").hide();m.find(".location-folder-list-wrap-main span.no-folder-exists").show()}else{m.find(".location-folder-list-wrap-main span.no-folder-exists").hide();m.find(".location-folder-list-wrap").show()}m.find("ul.location-folder-list span#"+o).trigger("click");m.find(".bb-model-footer").show();m.find(".bb-model-footer, #bp-media-document-prev").show();m.find(".bb-field-wrap-search").show();m.find(".bp-document-open-create-popup-folder").show();m.find(".location-folder-list-wrap-main").show();m.find(".create-popup-folder-wrap").hide();m.find(".bb-folder-selected-id").val();m.find(".bb-folder-selected-id").val(o);m.find(".bb-model-header").children().show();m.find(".bb-model-header p").hide();e.val("");if(""!==p){p.val("public")}b(m).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(t){if(t>0){if(b(m).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(m).find(".breadcrumbs-append-ul-li .breadcrumb").width()){b(m).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(m).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2));if(!b(m).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length){b('<span class="more_options">...</span>').insertAfter(b(m).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0))}}}});l.removeClass("loading");setTimeout(function(){var u=m.find("ul.location-folder-list span#"+o);u.trigger("click");var t=b(m).find("#bb-document-privacy");if(Number(u.data("id"))!==0){t.find("option").removeAttr("selected");t.val(u.parent().data("privacy"));t.prop("disabled",true)}else{t.find("option").removeAttr("selected");t.val("public");t.prop("disabled",false)}},200)}}});this.currentTargetParent=o;m.find(".location-folder-list li.is_active").show().children("span, i").show().siblings("ul").hide();m.find(".location-folder-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide();m.find(".location-folder-list li span.selected").removeClass("selected");m.find(".location-folder-list li.is_active").children("span").addClass("selected")},0)},submitCreateAlbumInPopup:function(c){c.preventDefault();var j=b(c.currentTarget).closest(".open-popup");var i=b(j).find(".bp-media-create-popup-album-submit");var g=j.find(".bb-album-selected-id").val();if(""===g){g=0}this.currentTargetParent=g;var f=this.currentTargetParent;var h=0;var k=b.trim(b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title").val());var e=b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album-title");var d="";var m="";var l=0;if("group"===this.moveToTypePopup){d="grouponly";h=this.moveToIdPopup}else{d=b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy").val();m=b(c.currentTarget).closest(".modal-container").find(".popup-on-fly-create-album #bb-album-privacy")}if(""===k){alert(BP_Nouveau.media.create_album_error_title);return false}i.addClass("loading");setTimeout(function(){var n={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:k,privacy:d,parent:f,group_id:h};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,async:false,success:function(o){if(o.success){j.find(".location-album-list-wrap .location-album-list").remove();j.find(".location-album-list-wrap").append(o.data.tree_view);if(bp.Nouveau.Media.folderLocationUI){bp.Nouveau.Media.folderLocationUI(j,o.data.album_id)}l=o.data.album_id;if(""===o.data.tree_view){j.find(".location-album-list-wrap").hide();j.find(".location-album-list-wrap-main span.no-album-exists").show()}else{j.find(".location-album-list-wrap-main span.no-album-exists").hide();j.find(".location-album-list-wrap").show()}j.find("ul.location-album-list span#"+l).trigger("click");j.find(".bb-model-footer").show();j.find(".bb-field-wrap-search").show();j.find(".bp-media-open-create-popup-album").show();j.find(".location-album-list-wrap-main").show();j.find(".create-popup-album-wrap").hide();j.find(".bb-field-steps-2 #bp-media-prev").show();j.find(".bb-album-selected-id").val();j.find(".bb-album-selected-id").val(l);j.find(".bb-model-header").children().show();j.find(".bb-model-header p").hide();e.val("");if(""!==m){m.val("public")}b(j).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(p){if(p>0){if(b(j).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(j).find(".breadcrumbs-append-ul-li .breadcrumb").width()){b(j).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(j).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2));if(!b(j).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length){b('<span class="more_options">...</span>').insertAfter(b(j).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0))}}}});i.removeClass("loading")}else{i.removeClass("loading")}}});this.currentTargetParent=l;j.find(".location-album-list li.is_active").show().children("span, i").show().siblings("ul").hide();j.find(".location-album-list li.is_active").siblings("li").show().children("span, i").show().siblings("ul").hide();j.find(".location-album-list li span.selected").removeClass("selected");j.find(".location-album-list li.is_active").children("span").addClass("selected")},0)},closeCreateFolderInPopup:function(c){c.preventDefault();b(".modal-container .bb-model-footer").show();b(".bb-field-wrap-search").show();b(".bp-document-open-create-popup-folder").show();b(".location-folder-list-wrap-main").show();b("#bp-media-document-prev").show();b(".create-popup-folder-wrap").hide();b(c.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().show();b(c.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header p").hide()},closeCreateAlbumInPopup:function(c){c.preventDefault();b(".modal-container .bb-model-footer").show();b(".bb-field-wrap-search").show();b(".bp-document-open-create-popup-folder").show();b(".modal-container:visible .bp-video-open-create-popup-album").show();b(".location-album-list-wrap-main").show();b(".bb-field-steps-2 #bp-media-prev").show();b(".bb-field-steps-2 #bp-video-next").show();b(".create-popup-album-wrap").hide();b(".bp-media-create-popup-album-submit.loading").removeClass("loading");b(c.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().show();b(c.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header p").hide()},createFolderInPopup:function(e){e.preventDefault();var d=parseInt(b(document).find(".open-popup .bb-folder-selected-id").val());var c=b(document).find(".open-popup .bb-folder-create-from").val();if(d>0){b(document).find(".open-popup .privacy-field-wrap-hide-show").hide()}else{b(document).find(".open-popup .privacy-field-wrap-hide-show").show()}if("group"===c){b(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide()}else{if(d>0){b(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide()}else{b(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show()}}b(".modal-container .bb-model-footer, .modal-container #bp-media-document-prev").hide();b(".bb-field-wrap-search").hide();b(".bp-document-open-create-popup-folder").hide();b(".location-folder-list-wrap-main").hide();b(".create-popup-folder-wrap").show();b(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().hide();b(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").append("<p>"+BP_Nouveau.media.create_folder+"</p>");b(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy");b(document).find(".open-popup .error").hide()},createAlbumInPopup:function(e){e.preventDefault();var d=parseInt(b(document).find(".open-popup .bb-album-selected-id").val());var c=b(document).find(".open-popup .bb-album-create-from").val();if(d>0){b(document).find(".open-popup .privacy-field-wrap-hide-show").hide()}else{b(document).find(".open-popup .privacy-field-wrap-hide-show").show()}if("group"===c){b(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide()}else{b(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show()}b(".modal-container .bb-model-footer").hide();b(".bb-field-wrap-search").hide();b(".bp-document-open-create-popup-folder").hide();b(".location-album-list-wrap-main").hide();b(".bb-field-steps-2 #bp-media-prev").hide();b(".create-popup-album-wrap").show();b(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").children().hide();b(e.currentTarget).closest(".has-folderlocationUI").find(".bb-model-header").append("<p>Create Album</p>");b(".modal-container #bb-folder-privacy").addClass("new-folder-create-privacy");b(document).find(".open-popup .error").hide()},savePrivacy:function(d){var g=b(d.currentTarget),i=0,c="",f="",h="";d.preventDefault();if(g.hasClass("new-folder-create-privacy")){return false}i=parseInt(g.data("item-id"));c=g.data("item-type");f=g.val();h=b(d.currentTarget).find("option:selected").text();this.privacySelectorSelect.addClass("hide");this.privacySelectorSpan.text("");this.privacySelectorSpan.text(h);this.privacySelectorSpan.show();if(i>0){var e={action:"document_save_privacy",item_id:i,type:c,value:f,_wpnonce:BP_Nouveau.nonces.media};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(j){if(j.success){b(document).find("#div-listing-"+i+" li#"+i+" a").attr("data-privacy",f);if(j.data.document&&j.data.document.video_symlink){b(document).find('a.bb-open-document-theatre[data-id="'+i+'"]').attr("data-video-preview",j.data.document.video_symlink)}}else{g.find('option[value="'+g.attr("data-privacy")+'"]').attr("selected","selected");g.siblings("span").text(g.find('option[value="'+g.attr("data-privacy")+'"]').text());alert(j.data.feedback.replace("'","'"))}}})}},folderMove:function(d){var g=b(d.currentTarget);var c=this;d.preventDefault();var f=g.attr("id");var h=b("#media-folder-document-data-table #bp-media-move-folder .modal-mask .modal-wrapper #boss-media-create-album-popup .bb-field-wrap .bb-folder-selected-id").val();if(""===f||""===h){alert(BP_Nouveau.media.i18n_strings.folder_move_error);return false}g.addClass("loading");var e={action:"document_folder_move",current_folder_id:f,folder_move_to_id:h,group_id:c.group_id,_wpnonce:BP_Nouveau.nonces.media,};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(j){if(j.success){if("yes"===BP_Nouveau.media.is_document_directory){var i=bp.Nouveau.getStorage("bp-document");var k=i.scope;if("personal"===k){b(document).find("li#document-personal a").trigger("click");b(document).find("li#document-personal").trigger("click")}else{b(document).find("li#document-all a").trigger("click");b(document).find("li#document-all").trigger("click")}}else{var l=b("#media-stream");l.html("");l.html(j.data.html);b(document).find(".open-popup .error").hide();b(document).find(".open-popup .error").html("");g.removeClass("loading");b(document).removeClass("open-popup")}}else{b(document).find(".open-popup .error").show();b(document).find(".open-popup .error").html(j.data.feedback);g.removeClass("loading");return false}}})},deleteDocument:function(d){var h=b(d.currentTarget);d.preventDefault();var j=h.attr("data-type");var e=h.attr("data-item-id");var f=h.attr("data-item-attachment-id");var m=h.attr("data-item-preview-attachment-id");var i=h.attr("data-item-from");var g=[];if("activity"!==i){if("folder"===j){if(!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm)){return false}}else{if("document"===j){if(!confirm(BP_Nouveau.media.i18n_strings.document_delete_confirm)){return false}}}g={action:"document_delete",id:e,preview_attachment_id:m,type:j,attachment_id:f,_wpnonce:BP_Nouveau.nonces.media,};if("yes"===BP_Nouveau.media.is_document_directory){var k=bp.Nouveau.getStorage("bp-document"),l=k.scope;if(""===l){g.scope="all"}else{g.scope=l}}b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,asyc:false,data:g,success:function(n){if(n.success){var o=b("#media-stream");o.html("");o.html(n.data.html)}}});this.current_page=1}else{if(!confirm(BP_Nouveau.media.i18n_strings.document_delete_confirm)){return false}var c=h.attr("data-item-activity-id");g={action:"document_activity_delete",id:e,preview_attachment_id:m,type:j,activity_id:c,attachment_id:f,_wpnonce:BP_Nouveau.nonces.media,};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:g,success:function(n){if(n.success){b("body #buddypress .activity-list li#activity-"+c+" .document-activity .activity-inner .bb-activity-media-wrap .document-activity."+e).remove();b("body #buddypress .activity-list .activity-comments .document-activity."+e).remove();if(true===n.data.delete_activity){b("body #buddypress .activity-list li#activity-"+c).remove();b("body .bb-activity-media-elem.document-activity."+e).remove();b("body .activity-comments li#acomment-"+c).remove()}else{b("body #buddypress .activity-list li#activity-"+c).replaceWith(n.data.activity_content)}}}})}},bp_ajax_media_request:function(c,d){if(BP_Nouveau.media.group_id&&typeof d!=="undefined"&&typeof d.response.scopes.groups!=="undefined"&&d.response.scopes.groups===0){b(".bb-photos-actions").hide()}else{if(BP_Nouveau.media.group_id&&typeof d!=="undefined"&&typeof d.response.scopes.groups!=="undefined"&&d.response.scopes.groups!==0){b(".bb-photos-actions").show()}else{if(typeof d!=="undefined"&&typeof d.response.scopes.personal!=="undefined"&&d.response.scopes.personal===0){b(".bb-photos-actions").hide()}}}},addSelectedClassToWrapper:function(d){var e=d.currentTarget;if(b(e).is(":checked")){b(e).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect);b(e).closest(".bb-item-thumb").addClass("selected")}else{b(e).closest(".bb-item-thumb").removeClass("selected");b(e).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select);var c=b(".bp-nouveau #bb-select-deselect-all-media");if(c.hasClass("selected")){c.removeClass("selected")}}},moveDocumentIntoFolder:function(g){var i=b(g.currentTarget);var f=this;g.preventDefault();var d=i.attr("id");var c=i.closest(".bp-media-move-file").find(".bb-folder-selected-id").val();if(""===d||""===c){i.closest(".modal-container").find(".location-folder-list").addClass("has-error");return false}if("yes"!==BP_Nouveau.media.is_document_directory){this.current_page=1}i.closest(".modal-container").find(".location-folder-list").removeClass("has-error");i.addClass("loading");var e="";e=b(document).find('a[data-media-id="'+d+'"]').attr("data-parent-activity-id");var h={action:"document_move",_wpnonce:BP_Nouveau.nonces.media,document_id:d,folder_id:c,group_id:f.group_id,activity_id:e};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:h,success:function(k){if(k.success){if("yes"===BP_Nouveau.media.is_document_directory){var j=bp.Nouveau.getStorage("bp-document");var l=j.scope;if("personal"===l){b(document).find("li#document-personal a").trigger("click");b(document).find("li#document-personal").trigger("click")}else{b(document).find("li#document-all a").trigger("click");b(document).find("li#document-all").trigger("click")}}else{if(parseInt(BP_Nouveau.media.current_folder)>0){b('#document-stream ul.media-list li[data-id="'+d+'"]').remove()}else{if(b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+d+'"]').length&&!b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+d+'"]').parent().hasClass("bb-media-length-1")){b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+d+'"]').remove();if(e&&e.length){b('#activity-stream ul.activity-list li[data-bp-activity-id="'+e+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove();b('#activity-stream ul.activity-list li[data-bp-activity-id="'+e+'"] .activity-content .activity-inner').append(k.data.document_content)}}}var m=b("#media-stream");m.html("");m.html(k.data.html);b(document).find(".open-popup .error").hide();b(document).find(".open-popup .error").html("");i.removeClass("loading");b(document).removeClass("open-popup")}i.closest(".bp-media-move-file").find(".ac-document-close-button").trigger("click")}else{alert(k.data.feedback.replace("'","'"))}}})},moveMediaIntoAlbum:function(h){var j=b(h.currentTarget);var e=this;h.preventDefault();var g=j.attr("id");var c=j.closest(".bp-media-move-file").find(".bb-album-selected-id").val();if(""===g||""===c){j.closest(".modal-container").find(".location-album-list").addClass("has-error");return false}j.closest(".modal-container").find(".location-album-list").removeClass("has-error");j.addClass("loading");var d="";d=b(document).find('a[data-media-id="'+g+'"]').attr("data-parent-activity-id");var f=parseInt(e.group_id);if(!f){f=false;if("group"===b(document).find('a[data-media-id="'+g+'"]').attr("data-type")){f=b(document).find('a[data-media-id="'+g+'"]').attr("id")}}var i={action:"media_move",_wpnonce:BP_Nouveau.nonces.media,media_id:g,album_id:c,group_id:f,activity_id:d};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(l){if(l.success){if("yes"===BP_Nouveau.media.is_media_directory){var k=bp.Nouveau.getStorage("bp-media");var m=k.scope;if("personal"===m){b(document).find("li#media-personal a").trigger("click");b(document).find("li#media-personal").trigger("click")}else{b(document).find("li#media-all a").trigger("click");b(document).find("li#media-all").trigger("click")}}else{if(parseInt(BP_Nouveau.media.current_album)>0){b('#media-stream ul.media-list li[data-id="'+g+'"]').remove()}else{if(b('#media-stream ul.media-list li.bb-photo-li[data-id="'+g+'"]').length){b('#media-stream ul.media-list li.bb-photo-li[data-id="'+g+'"]').remove()}else{if(b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+g+'"]').length&&!b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+g+'"]').parent().hasClass("bb-media-length-1")){b('#activity-stream ul.activity-list li .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+g+'"]').remove();if(d&&d.length){b('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove();b('#activity-stream ul.activity-list li[data-bp-activity-id="'+d+'"] .activity-content .activity-inner').append(l.data.media_content);jQuery(window).scroll()}}}}b(document).find(".open-popup .error").hide();b(document).find(".open-popup .error").html("");j.removeClass("loading");b(document).removeClass("open-popup")}j.closest(".bp-media-move-file").find(".ac-media-close-button").trigger("click");b(document).find('a.bb-open-media-theatre[data-id="'+g+'"]').data("album-id",c)}else{alert(l.data.feedback.replace("'","'"))}}})},deleteMedia:function(d){var i=b(d.currentTarget),l=this;d.preventDefault();var f=[];var g=b("#buddypress");var k=i.attr("data-type");var j=i.data("item-from");var e="";var c="";if("album"===k){if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm)){return false}}else{if("media"===k){if(!confirm(BP_Nouveau.media.i18n_strings.media_delete_confirm)){return false}}}if(i.hasClass("bb-delete")){if(!confirm(BP_Nouveau.media.i18n_strings.media_delete_confirm)){return false}g.find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){b(this).closest(".bb-photo-thumb").addClass("loading deleting");f.push(b(this).val())})}c=i.data("parent-activity-id");if(j&&j.length&&"activity"===j&&f.length==0){e=i.attr("data-item-id");f.push(e)}if(f.length==0){f.push(i.data("item-id"))}if(f.length==0){return false}i.prop("disabled",true);b("#buddypress #media-stream.media .bp-feedback").remove();var h={action:"media_delete",_wpnonce:BP_Nouveau.nonces.media,media:f,activity_id:c,from_where:j,};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:h,success:function(o){l.current_page=1;var m="";if(j&&j.length&&"activity"===j){if(o.success){b.each(f,function(r,s){if(b('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+s+'"]').length){b('#activity-stream ul.activity-list li.activity .activity-content .activity-inner .bb-activity-media-wrap div[data-id="'+s+'"]').remove()}if(b("body .bb-activity-media-elem.media-activity."+s).length){b("body .bb-activity-media-elem.media-activity."+s).remove()}});b('#activity-stream ul.activity-list li[data-bp-activity-id="'+c+'"] .activity-content .activity-inner .bb-activity-media-wrap').remove();b('#activity-stream ul.activity-list li[data-bp-activity-id="'+c+'"] .activity-content .activity-inner').append(o.data.media_content);var q=b('#activity-stream ul.activity-list li[data-bp-activity-id="'+c+'"] .activity-content .activity-inner .bb-activity-media-elem').length;if(q==0){b('#activity-stream ul.activity-list li[data-bp-activity-id="'+c+'"]').remove()}if(true===o.data.delete_activity){b("body #buddypress .activity-list li#activity-"+c).remove();b("body .bb-activity-media-elem.media-activity."+e).remove();b("body .activity-comments li#acomment-"+c).remove()}else{b("body #buddypress .activity-list li#activity-"+c).replaceWith(o.data.activity_content)}}}else{if(j&&j.length&&"media"===j){if(o.success){if("yes"===BP_Nouveau.media.is_media_directory){var n=bp.Nouveau.getStorage("bp-media");var p=n.scope;if("personal"===p){b(document).find("li#media-personal a").trigger("click");b(document).find("li#media-personal").trigger("click")}else{if("groups"===p){b(document).find("li#media-groups a").trigger("click");b(document).find("li#media-groups").trigger("click")}else{b(document).find("li#media-all a").trigger("click");b(document).find("li#media-all").trigger("click")}}}else{if(o.data.media_personal_count){b("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(o.data.media_personal_count)}if(o.data.media_group_count){b("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(o.data.media_group_count)}b.each(f,function(r,s){if(b('#media-stream ul.media-list li[data-id="'+s+'"]').length){b('#media-stream ul.media-list li[data-id="'+s+'"]').remove()}});if(b("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length==0){b(".bb-photos-actions").hide();m='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n\t</aside>";b('#buddypress [data-bp-list="media"]').html(m)}}}}else{setTimeout(function(){i.prop("disabled",false)},500);if(o.success){g.find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){b(this).closest("li").remove()});if(b("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length==0){b(".bb-photos-actions").hide();m='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n\t</aside>";b('#buddypress [data-bp-list="media"]').html(m)}}else{b("#buddypress #media-stream.media").prepend(o.data.feedback)}}}jQuery(window).scroll()}})},toggleSelectAllMedia:function(c){c.preventDefault();if(b(c.currentTarget).hasClass("selected")){b(c.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall);this.deselectAllMedia(c)}else{b(c.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall);this.selectAllMedia(c)}b(c.currentTarget).toggleClass("selected")},selectAllMedia:function(c){c.preventDefault();b("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){b(this).prop("checked",true);b(this).closest(".bb-item-thumb").addClass("selected");b(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllMedia:function(c){c.preventDefault();b("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){b(this).prop("checked",false);b(this).closest(".bb-item-thumb").removeClass("selected");b(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},editAlbumTitle:function(c){c.preventDefault();b("#bb-album-title").show();b("#bp-save-album-title").show();b("#bp-cancel-edit-album-title").show();b("#bp-edit-album-title").hide();b("#bp-media-single-album #bp-single-album-title").hide()},editFolderTitle:function(c){c.preventDefault();b("#bb-album-title").show();b("#bp-save-folder-title").show();b("#bp-cancel-edit-album-title").show();b("#bp-edit-folder-title").hide();b("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(c){c.preventDefault();b("#bb-album-title").hide();b("#bp-save-album-title,#bp-save-folder-title").hide();b("#bp-cancel-edit-album-title").hide();b("#bp-edit-album-title,#bp-edit-folder-title").show();b("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){var c=this;c.dropzone_obj.hiddenFileInput.click()},closeUploader:function(c){c.preventDefault();b("#bp-media-uploader").hide();b("#bp-media-add-more").hide();b("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload);b("#bp-media-uploader-modal-status-text").text("");b("#bp-media-post-content").val("");this.dropzone_obj.element?this.dropzone_obj.destroy():"";this.dropzone_media=[];var d=b(c.currentTarget).closest("#bp-media-uploader");b(".close-create-popup-album").trigger("click");b(".close-create-popup-folder").trigger("click");d.find('.breadcrumbs-append-ul-li .item span[data-id="0"]').trigger("click");if(d.find(".bb-field-steps").length){d.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide();d.find(".bb-field-steps-1 #bp-media-photo-next, .bb-field-steps-1 #bp-media-document-next ").hide();d.find(".bb-field-steps-1").removeClass("controls-added");d.find("#bp-media-document-prev, #bp-media-prev, #bp-media-document-submit, #bp-media-submit, .bp-media-open-create-popup-folder, .bp-document-open-create-popup-folder, .create-popup-folder-wrap, .create-popup-album-wrap, .bp-video-open-create-popup-album").hide()}this.clearFolderLocationUI(c)},closeChildFolderUploader:function(c){c.preventDefault();b(document).find(".open-popup #bb-album-child-title").val("");b(document).find(".open-popup #bp-media-create-child-folder-submit").removeClass("loading");b(document).find("#bp-media-create-child-folder").removeClass("open-popup");b(document).find("#bp-media-create-child-folder").hide();b(document).find(".open-popup #bb-album-title").text("");b(document).find(".open-popup #bp-media-create-folder").hide();b(document).find("#bp-media-create-folder").removeClass("open-popup")},closeFolderUploader:function(c){c.preventDefault();b(document).find(".open-popup #bb-album-title").val("");b(document).find(".open-popup #bp-media-create-folder-submit").removeClass("loading");b(document).find(".open-popup #bp-media-document-submit").hide();b(document).find("#bp-media-create-folder").removeClass("open-popup");b(document).find("#bp-media-create-folder").hide()},loadMoreGif:function(i){var d=i.target,c=this;var h=b(i.target).closest("form").find(".forums-attached-gif-container");var g=h.data("key");c.gif_container_key=g;if(d.scrollTop+d.offsetHeight>=d.scrollHeight&&!h.hasClass("loading")){if(c.gif_data[g].total_count>0&&c.gif_data[g].offset<=c.gif_data[g].total_count){var j={offset:c.gif_data[g].offset,fmt:"json",limit:c.gif_data[g].limit};h.addClass("loading");var f=null;if(_.isNull(c.gif_data[g].q)){f=c.giphy.trending(j,_.bind(c.loadMoreGifResponse,c))}else{f=c.giphy.search(_.extend({q:c.gif_data[g].q},j),_.bind(c.loadMoreGifResponse,c))}c.gif_data[g].requests.push(f);c.gif_data[g].offset=c.gif_data[g].offset+c.gif_data[g].limit}}},loadMoreGroupMessagesGif:function(h){var d=h.target,c=this;var j=b(h.target).closest("form").find(".bp-group-messages-attached-gif-container");var g=j.data("key");c.gif_container_key=g;if(d.scrollTop+d.offsetHeight>=d.scrollHeight&&!b(h.target).closest(".bp-group-messages-attached-gif-container").hasClass("loading")){if(c.gif_total_count>0&&c.gif_offset<=c.gif_total_count){var i={offset:c.gif_offset,fmt:"json",limit:c.gif_limit};b(h.target).closest(".bp-group-messages-attached-gif-container").addClass("loading");var f=null;if(_.isNull(c.gif_q)){f=c.giphy.trending(i,_.bind(c.loadMoreGroupMessagesGifResponse,c))}else{f=c.giphy.search(_.extend({q:c.gif_q},i),_.bind(c.loadMoreGroupMessagesGifResponse,c))}c.gif_requests.push(f);c.gif_offset=c.gif_offset+c.gif_limit;c.gif_data[g].requests.push(f);c.gif_data[g].offset=c.gif_data[g].offset+c.gif_data[g].limit}}},loadMoreGroupMessagesGifResponse:function(d){var c=this,e=0;b(".bp-group-messages-attached-gif-container").removeClass("loading");if(typeof d.data!=="undefined"&&d.data.length){var f="";for(e=0;e<d.data.length;e++){var g=Math.floor(Math.random()*(6-1+1))+1;f+='<li class="bg'+g+'" style="height: '+d.data[e].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+d.data[e].images.original.url+'" data-id="'+d.data[e].id+'">\n\t\t<img src="'+d.data[e].images.fixed_width.url+'">\n\t</a>\n</li>';d.data[e].saved=false;c.gif_data.push(d.data[e])}b(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(f)}if(typeof d.pagination!=="undefined"&&typeof d.pagination.total_count!=="undefined"){c.gif_total_count=d.pagination.total_count}},loadMoreGifResponse:function(d){var c=this,e=0;b('div.forums-attached-gif-container[data-key="'+c.gif_container_key+'"]').removeClass("loading");if(typeof d.data!=="undefined"&&d.data.length){var f="";for(e=0;e<d.data.length;e++){var g=Math.floor(Math.random()*(6-1+1))+1;f+='<li class="bg'+g+'" style="height: '+d.data[e].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+d.data[e].images.original.url+'" data-id="'+d.data[e].id+'">\n\t\t<img src="'+d.data[e].images.fixed_width.url+'">\n\t</a>\n</li>';d.data[e].saved=false;c.gif_data[c.gif_container_key].data.push(d.data[e])}b('div.forums-attached-gif-container[data-key="'+c.gif_container_key+'"]').closest("form").find(".gif-search-results-list").append(f)}if(typeof d.pagination!=="undefined"&&typeof d.pagination.total_count!=="undefined"){c.gif_data[c.gif_container_key].total_count=d.pagination.total_count}},editGifPreview:function(){var c=this,e={};if(c.bbp_is_reply_edit&&Object.keys(c.bbp_reply_edit_gif_data).length){e=c.bbp_reply_edit_gif_data.gif_raw_data}else{if(c.bbp_is_topic_edit&&Object.keys(c.bbp_topic_edit_gif_data).length){e=c.bbp_topic_edit_gif_data.gif_raw_data}else{if(c.bbp_is_forum_edit&&Object.keys(c.bbp_forum_edit_gif_data).length){e=c.bbp_forum_edit_gif_data.gif_raw_data}}}if(typeof e.images==="undefined"){return false}var d=b("#whats-new-attachments .forums-attached-gif-container");d[0].style.backgroundImage="url("+e.images.fixed_width.url+")";d[0].style.backgroundSize="contain";d[0].style.height=e.images.original.height+"px";d[0].style.width=e.images.original.width+"px";d.find(".gif-image-container img").attr("src",e.images.original.url);d.removeClass("closed");if(b("#bbp_media_gif").length){b("#bbp_media_gif").val(JSON.stringify(e))}},selectGif:function(k){var d=this,f=0,j=b(k.currentTarget),g=j.closest("form").find(".forums-attached-gif-container");k.preventDefault();g.closest("form").find(".gif-media-search-dropdown").removeClass("open");var h=g.data("key");if(typeof d.gif_data[h]!=="undefined"&&typeof d.gif_data[h].data!=="undefined"&&d.gif_data[h].data.length){for(f=0;f<d.gif_data[h].data.length;f++){if(d.gif_data[h].data[f].id==k.currentTarget.dataset.id){j.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+d.gif_data[h].data[f].images.fixed_width.url+")";j.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain";j.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=d.gif_data[h].data[f].images.original.height+"px";j.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=d.gif_data[h].data[f].images.original.width+"px";j.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",d.gif_data[h].data[f].images.original.url);j.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed");if(j.closest("form").find("#bbp_media_gif").length){j.closest("form").find("#bbp_media_gif").val(JSON.stringify(d.gif_data[h].data[f]))}break}}var c=j.closest("form");if(c.find("#forums-document-button")){c.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(c.find("#forums-media-button")){c.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(c.find("#forums-video-button")){c.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}}},selectGroupMessagesGif:function(j){var d=this,h=0;j.preventDefault();var f=b("#whats-new-attachments .bp-group-messages-attached-gif-container");var g=b("#bp_group_messages_gif");b("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open");if(d.gif_data.length){for(h=0;h<d.gif_data.length;h++){if(d.gif_data[h].id==j.currentTarget.dataset.id){f[0].style.backgroundImage="url("+d.gif_data[h].images.fixed_width.url+")";f[0].style.backgroundSize="contain";f[0].style.height=d.gif_data[h].images.original.height+"px";f[0].style.width=d.gif_data[h].images.original.width+"px";f.find(".gif-image-container img").attr("src",d.gif_data[h].images.original.url);f.removeClass("closed");if(g.length){g.val(JSON.stringify(d.gif_data[h]))}break}}var c=b("#send_group_message_form");if(c.find("#bp-group-messages-media-button")){c.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(c.find("#bp-group-messages-document-button")){c.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(c.find("#bp-group-messages-video-button")){c.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("disable")}}},removeSelectedGif:function(c){c.preventDefault();this.resetForumsGifComponent(c)},removeGroupMessagesSelectedGif:function(c){c.preventDefault();this.resetGroupMessagesGifComponent()},resetForumsGifComponent:function(g){var f=b(g.target);f.closest("form").find("#whats-new-toolbar #forums-gif-button").removeClass("active");f.closest("form").find(".gif-media-search-dropdown").removeClass("open");var d=f.closest("form").find("#whats-new-attachments .forums-attached-gif-container");if(d.length){d.addClass("closed");d.find(".gif-image-container img").attr("src","");d[0].style=""}if(f.closest("form").find("#bbp_media_gif").length){f.closest("form").find("#bbp_media_gif").val("")}var c=f.closest("form");if(c.find("#forums-document-button")){c.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(c.find("#forums-media-button")){c.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(c.find("#forums-video-button")){c.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable")}},resetGroupMessagesGifComponent:function(){var e=b("#whats-new-attachments .bp-group-messages-attached-gif-container");var d=b("#bp_group_messages_gif");b("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open");b("#whats-new-toolbar #bp-group-messages-gif-button").removeClass("active");e.addClass("closed");e.find(".gif-image-container img").attr("src","");e[0].style="";if(d.length){d.val("")}var c=b("#send_group_message_form");if(c.find("#bp-group-messages-media-button")){c.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(c.find("#bp-group-messages-document-button")){c.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(c.find("#bp-group-messages-video-button")){c.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").removeClass("disable")}},searchGif:function(d){var c=this;if(c.gif_timeout!=null){clearTimeout(this.gif_timeout)}c.gif_timeout=setTimeout(function(){c.gif_timeout=null;c.searchGifRequest(d,d.target.value)},1000)},searchGroupMessagesGif:function(d){var c=this;if(c.gif_timeout!=null){clearTimeout(this.gif_timeout)}c.gif_timeout=setTimeout(function(){c.gif_timeout=null;c.searchGroupMessagesGifRequest(d,d.target.value)},1000)},searchGroupMessagesGifRequest:function(g){var c=this;c.gif_q=g.target.value;c.gif_offset=0;var d=0;c.clearGifRequests();b(g.target).closest(".bp-group-messages-attached-gif-container").addClass("loading");var f=c.giphy.search({q:c.gif_q,offset:c.gif_offset,fmt:"json",limit:c.gif_limit},function(e){if(typeof e.data!=="undefined"&&e.data.length){var h="";for(d=0;d<e.data.length;d++){var i=Math.floor(Math.random()*(6-1+1))+1;h+='<li class="bg'+i+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n\t\t<img src="'+e.data[d].images.fixed_width.url+'">\n\t</a>\n</li>';e.data[d].saved=false;c.gif_data.push(e.data[d])}b(g.target).closest(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(h)}if(typeof e.pagination!=="undefined"&&typeof e.pagination.total_count!=="undefined"){c.gif_total_count=e.pagination.total_count}b(g.target).closest(".bp-group-messages-attached-gif-container").removeClass("loading")});c.gif_requests.push(f);c.gif_offset=c.gif_offset+c.gif_limit},searchGifRequest:function(j){var c=this,d=0;var h=b(j.target).closest("form").find(".forums-attached-gif-container");h.addClass("loading");var g=h.data("key");c.clearGifRequests(g);c.gif_data[g].q=j.target.value;c.gif_data[g].offset=0;var f=c.giphy.search({q:c.gif_data[g].q,offset:c.gif_data[g].offset,fmt:"json",limit:c.gif_data[g].limit},function(e){if(typeof e.data!=="undefined"&&e.data.length){var i="";for(d=0;d<e.data.length;d++){var k=Math.floor(Math.random()*(6-1+1))+1;i+='<li class="bg'+k+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n\t\t<img src="'+e.data[d].images.fixed_width.url+'">\n\t</a>\n</li>';e.data[d].saved=false;c.gif_data[g].data.push(e.data[d])}b(j.target).closest(".gif-search-content").find(".gif-search-results-list").append(i)}if(typeof e.pagination!=="undefined"&&typeof e.pagination.total_count!=="undefined"){c.gif_data[g].total_count=e.pagination.total_count}h.removeClass("loading")});c.gif_data[g].requests.push(f);c.gif_data[g].offset=c.gif_data[g].offset+c.gif_data[g].limit},clearGifRequests:function(e){var c=this;if(typeof c.gif_data[e]!=="undefined"&&typeof c.gif_data[e].requests!=="undefined"){for(var d=0;d<c.gif_data[e].requests.length;d++){c.gif_data[e].requests[d].abort()}b('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove();c.gif_data[e].requests=[];c.gif_data[e].data=[];c.gif_data.splice(e,1)}},toggleGifSelector:function(d){var n=this,m=b(d.currentTarget),o=m.closest("form").find(".gif-media-search-dropdown"),k=0;d.preventDefault();if(typeof window.Giphy!=="undefined"&&typeof BP_Nouveau.media.gif_api_key!=="undefined"){n.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key);var f=m.closest("form").find(".forums-attached-gif-container");f.addClass("loading");var l=f.data("key");n.clearGifRequests(l);n.gif_data[l]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]};var j=n.giphy.trending({offset:n.gif_data[l].offset,fmt:"json",limit:n.gif_data[l].limit},function(i){if(typeof i.data!=="undefined"&&i.data.length){var p="";for(k=0;k<i.data.length;k++){var q=Math.floor(Math.random()*(6-1+1))+1;p+='<li class="bg'+q+'" style="height: '+i.data[k].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+i.data[k].images.original.url+'" data-id="'+i.data[k].id+'">\n\t\t<img src="'+i.data[k].images.fixed_width.url+'">\n\t</a>\n</li>';i.data[k].saved=false;n.gif_data[l].data.push(i.data[k])}m.closest("form").find(".gif-search-results-list").append(p)}if(typeof i.pagination!=="undefined"&&typeof i.pagination.total_count!=="undefined"){n.gif_data[l].total_count=i.pagination.total_count}f.removeClass("loading")});n.gif_data[l].requests.push(j);n.gif_data[l].offset=n.gif_data[l].offset+n.gif_data[l].limit}o.toggleClass("open");var c=m.parents("form").find("#whats-new-attachments .forums-attached-gif-container img");if(c.length>0&&c.attr("src")!=""){m.addClass("active")}else{m.toggleClass("active")}var e=m.closest("form").find("#forums-post-media-uploader");if(e.length){n.resetForumsMediaComponent(e.data("key"))}var h=m.closest("form").find("#forums-post-document-uploader");if(h.length){n.resetForumsDocumentComponent(h.data("key"))}var g=m.closest("form").find("#forums-post-video-uploader");if(g.length){n.resetForumsVideoComponent(g.data("key"))}},closePickersOnEsc:function(c){var d=b(c.currentTarget);if(c.key==="Escape"||c.keyCode===27){if(!_.isUndefined(BP_Nouveau.media)&&!_.isUndefined(BP_Nouveau.media.gif_api_key)){d.find("form").find(".gif-media-search-dropdown").removeClass("open");d.find("#bbpress-forums form").each(function(){var f=jQuery(this);var e=f.find("#whats-new-attachments .forums-attached-gif-container img");if(e.length>0&&e.attr("src")!=""){f.find("#forums-gif-button").addClass("active")}else{f.find("#forums-gif-button").removeClass("active")}});d.find("#send_group_message_form").each(function(){var e=jQuery(this);var f=e.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");if(f.length>0&&f.attr("src")!=""){e.find("#bp-group-messages-gif-button").addClass("active")}else{e.find("#bp-group-messages-gif-button").removeClass("active")}});d.find(".activity-comments form").each(function(){var e=jQuery(this);var f=e.find(".ac-textarea").find(".ac-reply-attachments .activity-attached-gif-container");if(f.length&&b.trim(f.html())!=""){e.find(".ac-reply-gif-button").addClass("active")}else{e.find(".ac-reply-gif-button").removeClass("active")}})}}},closePickersOnClick:function(c){var d=b(c.target);var e=b(c.currentTarget);if(!_.isUndefined(BP_Nouveau.media)&&!_.isUndefined(BP_Nouveau.media.gif_api_key)&&!d.closest(".post-gif").length){e.find("form").find(".gif-media-search-dropdown").removeClass("open");e.find("#bbpress-forums form").each(function(){var g=jQuery(this);var f=g.find("#whats-new-attachments .forums-attached-gif-container img");if(f.length>0&&f.attr("src")!=""){g.find("#forums-gif-button").addClass("active")}else{g.find("#forums-gif-button").removeClass("active")}});e.find("#send_group_message_form").each(function(){var f=jQuery(this);var g=f.find("#whats-new-attachments .bp-group-messages-attached-gif-container img");if(g.length>0&&g.attr("src")!=""){f.find("#bp-group-messages-gif-button").addClass("active")}else{f.find("#bp-group-messages-gif-button").removeClass("active")}});e.find(".activity-comments form").each(function(){var f=jQuery(this);var g=f.find(".ac-textarea").find(".ac-reply-attachments .activity-attached-gif-container");if(g.length&&b.trim(g.html())!=""){f.find(".ac-reply-gif-button").addClass("active")}else{f.find(".ac-reply-gif-button").removeClass("active")}})}},toggleGroupMessagesGifSelector:function(h){var d=this,j=b(h.currentTarget),c=j.closest("form").find(".gif-media-search-dropdown"),e=0;h.preventDefault();if(typeof window.Giphy!=="undefined"&&typeof BP_Nouveau.media.gif_api_key!=="undefined"&&d.giphy==null){d.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key);d.gif_offset=0;d.gif_q=null;d.gif_limit=20;d.gif_requests=[];d.gif_data=[];d.clearGifRequests();b(".gif-search-query").closest(".bp-group-messages-attached-gif-container").addClass("loading");var g=d.giphy.trending({offset:d.gif_offset,fmt:"json",limit:d.gif_limit},function(i){if(typeof i.data!=="undefined"&&i.data.length){var k="";for(e=0;e<i.data.length;e++){var l=Math.floor(Math.random()*(6-1+1))+1;k+='<li class="bg'+l+'" style="height: '+i.data[e].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+i.data[e].images.original.url+'" data-id="'+i.data[e].id+'">\n\t\t<img src="'+i.data[e].images.fixed_width.url+'">\n\t</a>\n</li>';i.data[e].saved=false;d.gif_data.push(i.data[e])}j.closest("form").find(".gif-search-results-list").append(k)}if(typeof i.pagination!=="undefined"&&typeof i.pagination.total_count!=="undefined"){d.gif_total_count=i.pagination.total_count}b(".gif-search-query").closest(".bp-group-messages-attached-gif-container").removeClass("loading")});d.gif_requests.push(g);d.gif_offset=d.gif_offset+d.gif_limit}var f=j.parents("form").find("#whats-new-attachments .bp-group-messages-attached-gif-container img");if(f.length>0&&f.attr("src")!=""){j.addClass("active")}else{j.toggleClass("active")}c.toggleClass("open");d.resetGroupMessagesMediaComponent();d.resetGroupMessagesDocumentComponent();d.resetGroupMessagesVideoComponent()},resetGroupMessagesMediaComponent:function(){var c=this;if(c.dropzone_obj&&typeof c.dropzone_obj!=="undefined",c.dropzone_obj.length){c.dropzone_obj.destroy()}c.dropzone_media=[];b("div#bp-group-messages-post-media-uploader").html("");b("div#bp-group-messages-post-media-uploader").addClass("closed").removeClass("open");b("#bp-group-messages-media-button").removeClass("active");b("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_media").val("")},resetGroupMessagesDocumentComponent:function(){var c=this;if(c.document_dropzone_obj&&typeof c.document_dropzone_obj!=="undefined"){c.document_dropzone_obj.destroy()}c.dropzone_media=[];b("div#bp-group-messages-post-document-uploader").html("");b("div#bp-group-messages-post-document-uploader").addClass("closed").removeClass("open");b("#bp-group-messages-document-button").removeClass("active");b("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_document").val("")},resetGroupMessagesVideoComponent:function(){var c=this;if(c.video_dropzone_obj&&typeof c.video_dropzone_obj!=="undefined"){c.video_dropzone_obj.destroy()}c.dropzone_media=[];b("div#bp-group-messages-post-video-uploader").html("");b("div#bp-group-messages-post-video-uploader").addClass("closed").removeClass("open");b("#bp-group-messages-video-button").removeClass("active");b("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_video").val("")},resetForumsMediaComponent:function(e){var c=this;b("#forums-media-button").removeClass("active");if(typeof e!=="undefined"){if(typeof c.dropzone_obj[e]!=="undefined"){c.dropzone_obj[e].destroy();c.dropzone_obj.splice(e,1);c.dropzone_media.splice(e,1)}var d=b("div#forums-post-media-uploader");d.html("");d.addClass("closed").removeClass("open")}},resetForumsDocumentComponent:function(e){var c=this;b("#forums-document-button").removeClass("active");if(typeof e!=="undefined"){if(typeof c.dropzone_obj[e]!=="undefined"){c.dropzone_obj[e].destroy();c.dropzone_obj.splice(e,1);c.dropzone_media.splice(e,1)}var d=b("div#forums-post-document-uploader");d.html("");d.addClass("closed").removeClass("open")}},resetForumsVideoComponent:function(e){var c=this;b("#forums-video-button").removeClass("active");if(typeof e!=="undefined"){if(typeof c.dropzone_obj[e]!=="undefined"){c.dropzone_obj[e].destroy();c.dropzone_obj.splice(e,1);c.dropzone_media.splice(e,1)}var d=b("div#forums-post-video-uploader");d.html("");d.addClass("closed").removeClass("open")}},openForumsUploader:function(e){var o=this,k=b(e.currentTarget),h=k.closest("form").find("#forums-post-media-uploader"),d=k.closest("form").find("#forums-post-document-uploader"),n=k.closest("form").find("#forums-post-video-uploader"),g=[];e.preventDefault();k.toggleClass("active");var p=d.data("key");var f=n.data("key");o.resetForumsDocumentComponent(p);o.resetForumsVideoComponent(f);if(typeof window.Dropzone!=="undefined"&&h.length){var c=h.data("key");if(h.hasClass("closed")){o.dropzone_obj[c]=new Dropzone(h[0],o.options);o.dropzone_media[c]=[];o.dropzone_obj[c].on("sending",function(q,s,r){r.append("action","media_upload");r.append("_wpnonce",BP_Nouveau.nonces.media);var i=k.closest("form");if(i.find("#forums-document-button")){i.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(i.find("#forums-gif-button")){i.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(i.find("#forums-video-button")){i.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(i.find("#forums-media-button")){i.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("no-click")}});o.dropzone_obj[c].on("uploadprogress",function(r){var s=b(r.previewElement).find(".dz-progress-ring circle")[0];var i=s.r.baseVal.value;var q=i*2*Math.PI;s.style.strokeDasharray=q+" "+q;s.style.strokeDashoffset=q;var t=q-r.upload.progress.toFixed(0)/100*q;s.style.strokeDashoffset=t});o.dropzone_obj[c].on("error",function(q,i){if(q.accepted){if(typeof i!=="undefined"&&typeof i.data!=="undefined"&&typeof i.data.feedback!=="undefined"){b(q.previewElement).find(".dz-error-message span").text(i.data.feedback)}}else{if(!jQuery(".forum-document-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i+"</p></div></div></div></div></transition></div>")}this.removeFile(q)}});o.dropzone_obj[c].on("success",function(q,i){if(i.data.id){q.id=i.id;i.data.uuid=q.upload.uuid;i.data.menu_order=b(q.previewElement).closest(".dropzone").find(q.previewElement).index()-1;i.data.album_id=o.album_id;i.data.group_id=o.group_id;i.data.saved=false;o.dropzone_media[c].push(i.data);o.addMediaIdsToForumsForm(h)}else{if(!jQuery(".forum-media-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button" id="bp-media-create-folder-close" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+i.data.feedback+"</p></div></div></div></div></transition></div>")}this.removeFile(q)}});o.dropzone_obj[c].on("removedfile",function(s){if(o.dropzone_media[c].length){for(var r in o.dropzone_media[c]){if(s.upload.uuid==o.dropzone_media[c][r].uuid){if((!this.bbp_is_reply_edit&&!this.bbp_is_topic_edit&&!this.bbp_is_forum_edit)&&typeof o.dropzone_media[c][r].saved!=="undefined"&&!o.dropzone_media[c][r].saved){o.removeAttachment(o.dropzone_media[c][r].id)}o.dropzone_media[c].splice(r,1);o.addMediaIdsToForumsForm(h);break}}}if(!_.isNull(o.dropzone_obj[c].files)&&o.dropzone_obj[c].files.length===0){var q=k.closest("form");if(q.find("#forums-document-button")){q.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(q.find("#forums-video-button")){q.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable")}if(q.find("#forums-gif-button")){q.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(q.find("#forums-media-button")){q.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});h.removeClass("closed").addClass("open");o.resetForumsGifComponent(e);if((this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)){if(this.bbp_reply_edit_media.length){g=this.bbp_reply_edit_media}else{if(this.bbp_topic_edit_media.length){g=this.bbp_topic_edit_media}else{if(this.bbp_forum_edit_media.length){g=this.bbp_forum_edit_media}}}if(g.length){var l=false;for(var j=0;j<g.length;j++){l=false;o.dropzone_media[c].push({id:g[j].attachment_id,media_id:g[j].id,name:g[j].title,thumb:g[j].thumb,url:g[j].full,uuid:g[j].id,menu_order:j,saved:true});l={name:g[j].title,accepted:true,kind:"image",upload:{filename:g[j].title,uuid:g[j].id},dataURL:g[j].url,id:g[j].id};o.dropzone_obj[c].files.push(l);o.dropzone_obj[c].emit("addedfile",l);o.createThumbnailFromUrl(l,h)}o.addMediaIdsToForumsForm(h);if(!_.isNull(o.dropzone_obj[c].files)&&o.dropzone_obj[c].files.length!==0){var m=k.closest("form");if(m.find("#forums-document-button")){m.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find("#forums-video-button")){m.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find("#forums-gif-button")){m.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find("#forums-media-button")){m.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("no-click")}}}}}else{o.resetForumsMediaComponent(c)}}},openGroupMessagesUploader:function(d){var c=this,f=b("div#bp-group-messages-post-media-uploader"),e=b(d.currentTarget);d.preventDefault();e.toggleClass("active");if(typeof window.Dropzone!=="undefined"&&f.length){if(f.hasClass("closed")){c.dropzone_obj=new Dropzone("div#bp-group-messages-post-media-uploader",c.options);c.dropzone_obj.on("sending",function(h,j,i){i.append("action","media_upload");i.append("_wpnonce",BP_Nouveau.nonces.media);var g=b("#send_group_message_form");if(g.find("#bp-group-messages-document-button")){g.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-video-button")){g.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-gif-button")){g.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-media-button")){g.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("no-click")}});c.dropzone_obj.on("uploadprogress",function(i){var j=b(i.previewElement).find(".dz-progress-ring circle")[0];var g=j.r.baseVal.value;var h=g*2*Math.PI;j.style.strokeDasharray=h+" "+h;j.style.strokeDashoffset=h;var k=h-i.upload.progress.toFixed(0)/100*h;j.style.strokeDashoffset=k});c.dropzone_obj.on("error",function(h,g){if(h.accepted){if(typeof g!=="undefined"&&typeof g.data!=="undefined"&&typeof g.data.feedback!=="undefined"){b(h.previewElement).find(".dz-error-message span").text(g.data.feedback)}}else{if(!jQuery(".group-media-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+g+"</p></div></div></div></div></transition></div>")}this.removeFile(h)}});c.dropzone_obj.on("success",function(h,g){if(g.data.id){h.id=g.id;g.data.uuid=h.upload.uuid;g.data.menu_order=b(h.previewElement).closest(".dropzone").find(h.previewElement).index()-1;g.data.album_id=c.album_id;g.data.group_id=c.group_id;g.data.saved=false;c.dropzone_media.push(g.data);c.addMediaIdsToGroupMessagesForm()}else{if(!jQuery(".group-message-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-message-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+g.data.feedback+"</p></div></div></div></div></transition></div>")}this.removeFile(h)}});c.dropzone_obj.on("removedfile",function(j){if(c.dropzone_media.length){for(var h in c.dropzone_media){if(j.upload.uuid==c.dropzone_media[h].uuid){if(typeof c.dropzone_media[h].saved!=="undefined"&&!c.dropzone_media[h].saved){c.removeAttachment(c.dropzone_media[h].id)}c.dropzone_media.splice(h,1);c.addMediaIdsToGroupMessagesForm();break}}}if(!_.isNull(c.dropzone_obj.files)&&c.dropzone_obj.files.length===0){var g=b("#send_group_message_form");if(g.find("#bp-group-messages-document-button")){g.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-video-button")){g.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-gif-button")){g.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-media-button")){g.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});f.removeClass("closed").addClass("open");c.resetGroupMessagesGifComponent();c.resetGroupMessagesDocumentComponent();c.resetGroupMessagesVideoComponent()}else{c.resetGroupMessagesMediaComponent()}}},openGroupMessagesDocumentUploader:function(e){var c=this,d=b("div#bp-group-messages-post-document-uploader"),f=b(e.currentTarget);e.preventDefault();f.toggleClass("active");if(typeof window.Dropzone!=="undefined"&&d.length){if(d.hasClass("closed")){c.document_dropzone_obj=new Dropzone("div#bp-group-messages-post-document-uploader",c.documentOptions);c.document_dropzone_obj.on("sending",function(h,j,i){i.append("action","document_document_upload");i.append("_wpnonce",BP_Nouveau.nonces.media);var g=b("#send_group_message_form");if(g.find("#bp-group-messages-media-button")){g.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-video-button")){g.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-gif-button")){g.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-document-button")){g.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("no-click")}});c.document_dropzone_obj.on("uploadprogress",function(i){var j=b(i.previewElement).find(".dz-progress-ring circle")[0];var g=j.r.baseVal.value;var h=g*2*Math.PI;j.style.strokeDasharray=h+" "+h;j.style.strokeDashoffset=h;var k=h-i.upload.progress.toFixed(0)/100*h;j.style.strokeDashoffset=k});c.document_dropzone_obj.on("error",function(h,g){if(h.accepted){if(typeof g!=="undefined"&&typeof g.data!=="undefined"&&typeof g.data.feedback!=="undefined"){b(h.previewElement).find(".dz-error-message span").text(g.data.feedback)}}else{if(!jQuery(".group-document-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup group-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+g+"</p></div></div></div></div></transition></div>")}this.removeFile(h)}});c.document_dropzone_obj.on("accept",function(h,g){if(h.size==0){g(BP_Nouveau.media.empty_document_type)}else{g()}});c.document_dropzone_obj.on("success",function(j,i){if(i.data.id){j.id=i.id;i.data.uuid=j.upload.uuid;i.data.menu_order=b(j.previewElement).closest(".dropzone").find(j.previewElement).index()-1;i.data.folder_id=c.current_folder;i.data.group_id=c.current_group_id;i.data.saved=false;c.dropzone_media.push(i.data);c.addDocumentIdsToGroupMessagesForm()}else{var l,n,h,m,g;var k=i.data.feedback;j.previewElement.classList.add("dz-error");m=j.previewElement.querySelectorAll("[data-dz-errormessage]");g=[];for(n=0,h=m.length;n<h;n++){l=m[n];g.push(l.textContent=k)}return g}});c.document_dropzone_obj.on("removedfile",function(i){if(c.dropzone_media.length){for(var h in c.dropzone_media){if(i.upload.uuid==c.dropzone_media[h].uuid){if(typeof c.dropzone_media[h].saved!=="undefined"&&!c.dropzone_media[h].saved){c.removeAttachment(c.dropzone_media[h].id)}c.dropzone_media.splice(h,1);c.addDocumentIdsToGroupMessagesForm();break}}}if(!_.isNull(c.document_dropzone_obj.files)&&c.document_dropzone_obj.files.length===0){var g=b("#send_group_message_form");if(g.find("#bp-group-messages-media-button")){g.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-video-button")){g.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-gif-button")){g.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-document-button")){g.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});d.removeClass("closed").addClass("open");c.resetGroupMessagesGifComponent();c.resetGroupMessagesMediaComponent();c.resetGroupMessagesVideoComponent()}else{c.resetGroupMessagesDocumentComponent()}}},openGroupMessagesVideoUploader:function(d){var c=this,f=b("div#bp-group-messages-post-video-uploader"),e=b(d.currentTarget);d.preventDefault();e.toggleClass("active");if(typeof window.Dropzone!=="undefined"&&f.length){if(f.hasClass("closed")){c.video_dropzone_obj=new Dropzone("div#bp-group-messages-post-video-uploader",c.videoOptions);c.video_dropzone_obj.on("sending",function(h,j,i){i.append("action","video_upload");i.append("_wpnonce",BP_Nouveau.nonces.video);var g=b("#send_group_message_form");if(g.find("#bp-group-messages-document-button")){g.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-gif-button")){g.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-media-button")){g.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(g.find("#bp-group-messages-video-button")){g.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").addClass("no-click")}});c.video_dropzone_obj.on("error",function(h,g){if(h.accepted){if(typeof g!=="undefined"&&typeof g.data!=="undefined"&&typeof g.data.feedback!=="undefined"){b(h.previewElement).find(".dz-error-message span").text(g.data.feedback)}}else{b("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-video-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button open-popup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+g+"</p></div></div></div></div></transition></div>");this.removeFile(h)}});c.video_dropzone_obj.on("accept",function(h,g){if(h.size==0){g(BP_Nouveau.video.empty_video_type)}else{g()}});c.video_dropzone_obj.on("addedfile",function(g){if(g.dataURL){}else{if(bp.Nouveau.getVideoThumb){bp.Nouveau.getVideoThumb(g,".dz-video-thumbnail")}}});c.video_dropzone_obj.on("uploadprogress",function(j,i){b(j.previewElement).find(".dz-progress-count").text(j.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text);var k=b(j.previewElement).find(".dz-progress-ring circle")[0];var g=k.r.baseVal.value;var h=g*2*Math.PI;k.style.strokeDasharray=h+" "+h;k.style.strokeDashoffset=h;var l=h-j.upload.progress.toFixed(0)/100*h;k.style.strokeDashoffset=l;if(j.upload.progress===100){b(i.previewElement).closest(".dz-preview").addClass("dz-complete")}});c.video_dropzone_obj.on("success",function(j,i){if(i.data.id){j.id=i.id;i.data.uuid=j.upload.uuid;i.data.menu_order=b(j.previewElement).closest(".dropzone").find(j.previewElement).index()-1;i.data.album_id=c.album_id;i.data.group_id=c.group_id;i.data.js_preview=b(j.previewElement).find(".dz-video-thumbnail img").attr("src");i.data.saved=false;c.dropzone_media.push(i.data);c.addVideoIdsToGroupMessagesForm()}else{var l,n,h,m,g;var k=i.data.feedback;j.previewElement.classList.add("dz-error");m=j.previewElement.querySelectorAll("[data-dz-errormessage]");g=[];for(n=0,h=m.length;n<h;n++){l=m[n];g.push(l.textContent=k)}return g}});c.video_dropzone_obj.on("removedfile",function(j){if(c.dropzone_media.length){for(var h in c.dropzone_media){if(j.upload.uuid==c.dropzone_media[h].uuid){if(typeof c.dropzone_media[h].saved!=="undefined"&&!c.dropzone_media[h].saved){c.removeAttachment(c.dropzone_media[h].id)}c.dropzone_media.splice(h,1);c.addVideoIdsToGroupMessagesForm();break}}}if(!_.isNull(c.video_dropzone_obj.files)&&c.video_dropzone_obj.files.length===0){var g=b("#send_group_message_form");if(g.find("#bp-group-messages-document-button")){g.find("#bp-group-messages-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-gif-button")){g.find("#bp-group-messages-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-media-button")){g.find("#bp-group-messages-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(g.find("#bp-group-messages-video-button")){g.find("#bp-group-messages-video-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});f.removeClass("closed").addClass("open");c.resetGroupMessagesMediaComponent();c.resetGroupMessagesGifComponent();c.resetGroupMessagesDocumentComponent()}else{c.resetGroupMessagesVideoComponent()}}},openForumsDocumentUploader:function(e){var o=this,j=b(e.currentTarget),h=j.closest("form").find("#forums-post-document-uploader"),p=j.closest("form").find("#forums-post-media-uploader"),n=j.closest("form").find("#forums-post-video-uploader"),i=[];e.preventDefault();j.toggleClass("active");var f=p.data("key");var g=n.data("key");o.resetForumsMediaComponent(f);o.resetForumsVideoComponent(g);if(typeof window.Dropzone!=="undefined"&&h.length){var c=h.data("key");if(h.hasClass("closed")){o.dropzone_obj[c]=new Dropzone(h[0],o.documentOptions);o.dropzone_media[c]=[];o.dropzone_obj[c].on("sending",function(q,s,r){r.append("action","document_document_upload");r.append("_wpnonce",BP_Nouveau.nonces.media);var d=j.closest("form");if(d.find("#forums-media-button")){d.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(d.find("#forums-gif-button")){d.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(d.find("#forums-video-button")){d.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(d.find("#forums-document-button")){d.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("no-click")}});o.dropzone_obj[c].on("uploadprogress",function(r){var s=b(r.previewElement).find(".dz-progress-ring circle")[0];var d=s.r.baseVal.value;var q=d*2*Math.PI;s.style.strokeDasharray=q+" "+q;s.style.strokeDashoffset=q;var t=q-r.upload.progress.toFixed(0)/100*q;s.style.strokeDashoffset=t});o.dropzone_obj[c].on("error",function(q,d){if(q.accepted){if(typeof d!=="undefined"&&typeof d.data!=="undefined"&&typeof d.data.feedback!=="undefined"){b(q.previewElement).find(".dz-error-message span").text(d.data.feedback)}}else{if(!jQuery(".forum-document-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup forum-document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+d+"</p></div></div></div></div></transition></div>")}this.removeFile(q)}});o.dropzone_obj[c].on("accept",function(q,d){if(q.size==0){d(BP_Nouveau.media.empty_document_type)}else{d()}});o.dropzone_obj[c].on("success",function(s,r){if(r.data.id){s.id=r.id;r.data.uuid=s.upload.uuid;r.data.menu_order=b(s.previewElement).closest(".dropzone").find(s.previewElement).index()-1;r.data.folder_id=o.current_folder;r.data.group_id=o.current_group_id;r.data.saved=false;o.dropzone_media[c].push(r.data);o.addDocumentIdsToForumsForm(h)}else{var u,w,q,v,d;var t=r.data.feedback;s.previewElement.classList.add("dz-error");v=s.previewElement.querySelectorAll("[data-dz-errormessage]");d=[];for(w=0,q=v.length;w<q;w++){u=v[w];d.push(u.textContent=t)}return d}});o.dropzone_obj[c].on("removedfile",function(r){if(o.dropzone_media[c].length){for(var q in o.dropzone_media[c]){if(r.upload.uuid==o.dropzone_media[c][q].uuid){if((!this.bbp_is_reply_edit&&!this.bbp_is_topic_edit&&!this.bbp_is_forum_edit)&&typeof o.dropzone_media[c][q].saved!=="undefined"&&!o.dropzone_media[c][q].saved){o.removeAttachment(o.dropzone_media[c][q].id)}o.dropzone_media[c].splice(q,1);o.addDocumentIdsToForumsForm(h);break}}}if(!_.isNull(o.dropzone_obj[c].files)&&o.dropzone_obj[c].files.length===0){var d=j.closest("form");if(d.find("#forums-media-button")){d.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(d.find("#forums-video-button")){d.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("disable")}if(d.find("#forums-gif-button")){d.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(d.find("#forums-document-button")){d.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});h.removeClass("closed").addClass("open");o.resetForumsGifComponent(e);if((this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)){if(this.bbp_reply_edit_document.length){i=this.bbp_reply_edit_document}else{if(this.bbp_topic_edit_document.length){i=this.bbp_topic_edit_document}else{if(this.bbp_forum_edit_document.length){i=this.bbp_forum_edit_document}}}if(i.length){var l=false;for(var k=0;k<i.length;k++){l=false;o.dropzone_media[c].push({id:i[k].attachment_id,document_id:i[k].id,name:i[k].name,type:"document",title:i[k].name,size:i[k].size,url:i[k].url,uuid:i[k].id,menu_order:k,saved:true});l={name:i[k].name,size:i[k].size,accepted:true,kind:"document",upload:{name:i[k].name,title:i[k].name,size:i[k].size,uuid:i[k].id},dataURL:i[k].url,id:i[k].id};o.dropzone_obj[c].files.push(l);o.dropzone_obj[c].emit("addedfile",l);o.dropzone_obj[c].emit("complete",l)}o.addDocumentIdsToForumsForm(h);if(!_.isNull(o.dropzone_obj[c].files)&&o.dropzone_obj[c].files.length!==0){var m=j.closest("form");if(m.find("#forums-media-button")){m.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find("#forums-video-button")){m.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find("#forums-gif-button")){m.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(m.find("#forums-document-button")){m.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("no-click")}}}}}else{o.resetForumsDocumentComponent(c)}}},openForumsVideoUploader:function(f){var n=this,j=b(f.currentTarget),h=j.closest("form").find("#forums-post-video-uploader"),e=j.closest("form").find("#forums-post-media-uploader"),i=j.closest("form").find("#forums-post-document-uploader"),o=[];f.preventDefault();j.toggleClass("active");var g=e.data("key");var d=i.data("key");n.resetForumsMediaComponent(g);n.resetForumsDocumentComponent(d);if(typeof window.Dropzone!=="undefined"&&h.length){var c=h.data("key");if(h.hasClass("closed")){n.dropzone_obj[c]=new Dropzone(h[0],n.videoOptions);n.dropzone_media[c]=[];n.dropzone_obj[c].on("sending",function(q,s,r){r.append("action","video_upload");r.append("_wpnonce",BP_Nouveau.nonces.video);var p=j.closest("form");if(p.find("#forums-media-button")){p.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(p.find("#forums-gif-button")){p.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(p.find("#forums-document-button")){p.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(p.find("#forums-video-button")){p.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("no-click")}});n.dropzone_obj[c].on("error",function(q,p){if(q.accepted){if(typeof p!=="undefined"&&typeof p.data!=="undefined"&&typeof p.data.feedback!=="undefined"){b(q.previewElement).find(".dz-error-message span").text(p.data.feedback)}}else{if(!jQuery(".forum-video-error-popup").length){b("body").append('<div id="bp-video-create-album" style="display: block;" class="open-popup forum-video-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-video-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.video.invalid_video_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+p+"</p></div></div></div></div></transition></div>")}this.removeFile(q)}});n.dropzone_obj[c].on("accept",function(q,p){if(q.size==0){p(BP_Nouveau.video.empty_video_type)}else{p()}});n.dropzone_obj[c].on("addedfile",function(p){if(p.dataURL&&p.dataThumb&&p.dataThumb.length){b(p.previewElement).find(".dz-video-thumbnail").prepend('<img src=" '+p.dataThumb+' " />')}else{if(bp.Nouveau.getVideoThumb){bp.Nouveau.getVideoThumb(p,".dz-video-thumbnail")}}});n.dropzone_obj[c].on("uploadprogress",function(s,r){b(s.previewElement).find(".dz-progress-count").text(s.upload.progress.toFixed(0)+"% "+BP_Nouveau.video.i18n_strings.video_uploaded_text);var t=b(s.previewElement).find(".dz-progress-ring circle")[0];var p=t.r.baseVal.value;var q=p*2*Math.PI;t.style.strokeDasharray=q+" "+q;t.style.strokeDashoffset=q;var u=q-s.upload.progress.toFixed(0)/100*q;t.style.strokeDashoffset=u;if(s.upload.progress===100){b(r.previewElement).closest(".dz-preview").addClass("dz-complete")}});n.dropzone_obj[c].on("success",function(s,r){if(r.data.id){s.id=r.id;r.data.uuid=s.upload.uuid;r.data.menu_order=b(s.previewElement).closest(".dropzone").find(s.previewElement).index()-1;r.data.album_id=n.album_id;r.data.group_id=n.group_id;r.data.js_preview=b(s.previewElement).find(".dz-video-thumbnail img").attr("src");r.data.saved=false;n.dropzone_media[c].push(r.data);n.addVideoIdsToForumsForm(h)}else{var u,w,q,v,p;var t=r.data.feedback;s.previewElement.classList.add("dz-error");v=s.previewElement.querySelectorAll("[data-dz-errormessage]");p=[];for(w=0,q=v.length;w<q;w++){u=v[w];p.push(u.textContent=t)}return p}});n.dropzone_obj[c].on("removedfile",function(r){if(n.dropzone_media[c].length){for(var q in n.dropzone_media[c]){if(r.upload.uuid==n.dropzone_media[c][q].uuid){if((!this.bbp_is_reply_edit&&!this.bbp_is_topic_edit&&!this.bbp_is_forum_edit)&&typeof n.dropzone_media[c][q].saved!=="undefined"&&!n.dropzone_media[c][q].saved){n.removeAttachment(n.dropzone_media[c][q].id)}n.dropzone_media[c].splice(q,1);n.addVideoIdsToForumsForm(h);break}}}if(!_.isNull(n.dropzone_obj[c].files)&&n.dropzone_obj[c].files.length===0){var p=j.closest("form");if(p.find("#forums-media-button")){p.find("#forums-media-button").parents(".post-elements-buttons-item").removeClass("disable")}if(p.find("#forums-gif-button")){p.find("#forums-gif-button").parents(".post-elements-buttons-item").removeClass("disable")}if(p.find("#forums-document-button")){p.find("#forums-document-button").parents(".post-elements-buttons-item").removeClass("disable")}if(p.find("#forums-video-button")){p.find("#forums-video-button").parents(".post-elements-buttons-item").removeClass("no-click")}}});h.removeClass("closed").addClass("open");n.resetForumsGifComponent(f);if((this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_video.length||this.bbp_topic_edit_video.length||this.bbp_forum_edit_video.length)){if(this.bbp_reply_edit_video.length){o=this.bbp_reply_edit_video}else{if(this.bbp_topic_edit_video.length){o=this.bbp_topic_edit_video}else{if(this.bbp_forum_edit_video.length){o=this.bbp_forum_edit_video}}}if(o.length){var k=false;for(var m=0;m<o.length;m++){k=false;n.dropzone_media[c].push({id:o[m].attachment_id,video_id:o[m].id,name:o[m].name,type:"video",title:o[m].name,size:o[m].size,url:o[m].url,uuid:o[m].id,thumb:o[m].thumb,menu_order:m,saved:true,});k={name:o[m].name,size:o[m].size,accepted:true,kind:"video",upload:{name:o[m].name,title:o[m].name,size:o[m].size,uuid:o[m].id},dataURL:o[m].url,dataThumb:o[m].thumb,id:o[m].id};n.dropzone_obj[c].files.push(k);n.dropzone_obj[c].emit("addedfile",k);n.dropzone_obj[c].emit("complete",k)}n.addVideoIdsToForumsForm(h);if(!_.isNull(n.dropzone_obj[c].files)&&n.dropzone_obj[c].files.length!==0){var l=j.closest("form");if(l.find("#forums-media-button")){l.find("#forums-media-button").parents(".post-elements-buttons-item").addClass("disable")}if(l.find("#forums-gif-button")){l.find("#forums-gif-button").parents(".post-elements-buttons-item").addClass("disable")}if(l.find("#forums-document-button")){l.find("#forums-document-button").parents(".post-elements-buttons-item").addClass("disable")}if(l.find("#forums-video-button")){l.find("#forums-video-button").parents(".post-elements-buttons-item").addClass("no-click")}}}}}else{n.resetForumsVideoComponent(c)}}},addMediaIdsToForumsForm:function(e){var d=this,c=e.data("key");if(e.closest("#whats-new-attachments").find("#bbp_media").length){e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(d.dropzone_media[c]))}},addDocumentIdsToForumsForm:function(e){var d=this,c=e.data("key");if(e.closest("#whats-new-attachments").find("#bbp_document").length){e.closest("#whats-new-attachments").find("#bbp_document").val(JSON.stringify(d.dropzone_media[c]))}},addVideoIdsToForumsForm:function(e){var d=this,c=e.data("key");if(e.closest("#whats-new-attachments").find("#bbp_video").length){e.closest("#whats-new-attachments").find("#bbp_video").val(JSON.stringify(d.dropzone_media[c]))}},createThumbnailFromUrl:function(e,f){var d=this,c=f.data("key");d.dropzone_obj[c].createThumbnailFromUrl(e,d.dropzone_obj[c].options.thumbnailWidth,d.dropzone_obj[c].options.thumbnailHeight,d.dropzone_obj[c].options.thumbnailMethod,true,function(g){d.dropzone_obj[c].emit("thumbnail",e,g);d.dropzone_obj[c].emit("complete",e)})},openUploader:function(e){var d=this;e.preventDefault();var g,c;if(typeof window.Dropzone!=="undefined"&&b("div#media-uploader").length){b("#bp-media-uploader").addClass("open-popup").show();if(b(e.currentTarget).closest("#bp-media-single-album").length){b("#bb-media-privacy").hide()}if(b("#bp-media-uploader").find(".bb-field-steps.bb-field-steps-2").length){g="#bp-media-uploader.bp-media-photo-uploader";if(Number(b(g).find(".bb-album-selected-id").data("value"))!==0){c=b(g).find(".bb-album-selected-id").data("value");b(g).find("#bb-document-privacy").prop("disabled",true)}else{c=0}if(""!==this.moveToIdPopup){b.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup,},success:function(h){b(document).find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-media").html(h.data.first_span_text);if(""===h.data.html){b(document).find(".open-popup .location-album-list-wrap").hide();b(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()}else{b(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide();b(document).find(".open-popup .location-album-list-wrap").show()}if(false===h.data.create_album){b(document).find(".open-popup .bp-media-open-create-popup-folder").removeClass("create-album");b(document).find(".open-popup .bp-media-open-create-popup-folder").hide()}else{b(document).find(".open-popup .bp-media-open-create-popup-folder").addClass("create-album")}b(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show();b(document).find(".open-popup .bb-album-create-from").val("profile");b(g).find(".location-album-list-wrap .location-album-list").remove();b(g).find(".location-album-list-wrap").append(h.data.html);b(g).find('ul.location-album-list span[data-id="'+c+'"]').trigger("click");b(g).find(".bb-album-selected-id").val(c)}})}}b(document).on("click",g+" .location-album-list li span",function(i){i.preventDefault();if(b(this).parent().hasClass("is_active")){return}if(b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")!=0){b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove()}b(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+b(this).attr("id")+'">'+b(this).text()+"</span>");b(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected");if(c==b(i.currentTarget).data("id")){b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled")}else{b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled")}if(b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")){return}b(i.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(b(i.currentTarget).data("id"));var h=b(i.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy");if(Number(b(i.currentTarget).data("id"))!==0){h.find("option").removeAttr("selected");h.val(b(i.currentTarget).parent().data("privacy"));h.prop("disabled",true)}else{h.find("option").removeAttr("selected");h.val("public");h.prop("disabled",false)}});b(document).on("click",g+" .breadcrumb .item > span",function(j){if(b(this).hasClass("is-disabled")){return}b(j.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val(0);b(j.currentTarget).closest(".bb-field-wrap").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active");if(b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")){b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove()}if(c==b(j.currentTarget).data("id")){b(j.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled")}else{b(j.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled")}var h=b(j.currentTarget).closest("#bp-media-uploader").find("#bb-media-privacy");var i=b(j.currentTarget).closest("#bp-media-uploader").find(".location-album-list li.is_active").data("privacy");if(Number(b(j.currentTarget).closest(".bb-field-wrap").find(".bb-album-selected-id").val())!==0){h.find("option").removeAttr("selected");h.val(i===undefined?"public":i);h.prop("disabled",true)}else{h.find("option").removeAttr("selected");h.val("public");h.prop("disabled",false)}});var f=document.getElementsByClassName("uploader-post-media-template").length?document.getElementsByClassName("uploader-post-media-template")[0].innerHTML:"";d.options.previewTemplate=f;d.dropzone_obj=new Dropzone("div#media-uploader",d.options);d.dropzone_obj.on("sending",function(h,j,i){i.append("action","media_upload");i.append("_wpnonce",BP_Nouveau.nonces.media)});d.dropzone_obj.on("uploadprogress",function(j){var k=b(j.previewElement).find(".dz-progress-ring circle")[0];var h=k.r.baseVal.value;var i=h*2*Math.PI;k.style.strokeDasharray=i+" "+i;k.style.strokeDashoffset=i;var l=i-j.upload.progress.toFixed(0)/100*i;k.style.strokeDashoffset=l});d.dropzone_obj.on("addedfile",function(){setTimeout(function(){if(d.dropzone_obj.getAcceptedFiles().length){b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,d.dropzone_media.length,d.dropzone_obj.getAcceptedFiles().length)).show()}},1000)});d.dropzone_obj.on("error",function(i,h){if(i.accepted){if(typeof h!=="undefined"&&typeof h.data!=="undefined"&&typeof h.data.feedback!=="undefined"){b(i.previewElement).find(".dz-error-message span").text(h.data.feedback)}}else{if(!jQuery(".media-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+h+"</p></div></div></div></div></transition></div>")}this.removeFile(i)}});d.dropzone_obj.on("queuecomplete",function(){b("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)});d.dropzone_obj.on("processing",function(){b("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")});d.dropzone_obj.on("success",function(i,h){if(h.data.id){i.id=h.id;h.data.uuid=i.upload.uuid;h.data.menu_order=d.dropzone_media.length;h.data.album_id=d.album_id;h.data.group_id=d.group_id;h.data.saved=false;d.dropzone_media.push(h.data)}else{if(!jQuery(".media-error-popup").length){b("body").append('<div id="bp-media-create-folder" style="display: block;" class="open-popup media-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_media_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+h.data.feedback+"</p></div></div></div></div></transition></div>")}this.removeFile(i)}b(".bb-field-steps-1 #bp-media-photo-next, #bp-media-submit").show();b(".bb-field-steps-1").addClass("controls-added");b("#bp-media-add-more").show();b("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...");b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,d.dropzone_media.length,d.dropzone_obj.getAcceptedFiles().length)).show()});d.dropzone_obj.on("removedfile",function(j){if(d.dropzone_media.length){for(var h in d.dropzone_media){if(j.upload.uuid==d.dropzone_media[h].uuid){if(typeof d.dropzone_media[h].saved!=="undefined"&&!d.dropzone_media[h].saved){d.removeAttachment(d.dropzone_media[h].id)}d.dropzone_media.splice(h,1);break}}}if(!d.dropzone_obj.getAcceptedFiles().length){b("#bp-media-uploader-modal-status-text").text("");b("#bp-media-add-more, #bp-media-photo-next").hide();b(".bb-field-steps-1").removeClass("controls-added");b("#bp-media-submit").hide()}else{b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,d.dropzone_media.length,d.dropzone_obj.getAcceptedFiles().length)).show()}})}},openDocumentUploader:function(f){var e=this;var g;f.preventDefault();if(typeof window.Dropzone!=="undefined"&&b("div#media-uploader").length){if(b("#bp-media-uploader").hasClass("bp-media-document-uploader")){if(!this.currentTargetParent){this.currentTargetParent=0}}if(b(f.currentTarget).closest("#bp-media-single-folder").length){b("#bb-document-privacy").hide()}b(document).removeClass("open-popup");b("#bp-media-uploader").show();b("#bp-media-uploader").addClass("open-popup");if(b("#bp-media-uploader.bp-media-document-uploader").find(".bb-field-steps.bb-field-steps-2").length){g="#bp-media-uploader.bp-media-document-uploader";var d;if(Number(b(g).find(".bb-folder-selected-id").data("value"))!==0){d=b(g).find(".bb-folder-selected-id").data("value");b(g).find("#bb-document-privacy").prop("disabled",true)}else{d=0}if(""!==this.moveToIdPopup){b.ajax({url:BP_Nouveau.ajaxurl,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup,},success:function(h){b(document).find(".bp-media-document-uploader .location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(h.data.first_span_text);if(""===h.data.html){b(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap").hide();b(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap-main span.no-folder-exists").show()}else{b(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap-main span.no-folder-exists").hide();b(document).find(".bp-media-document-uploader.open-popup .location-folder-list-wrap").show()}b(document).find(".bp-media-document-uploader .popup-on-fly-create-album .privacy-field-wrap-hide-show").show();b(document).find(".bp-media-document-uploader .open-popup .bb-folder-create-from").val("profile");b(g).find(".location-folder-list-wrap .location-folder-list").remove();b(g).find(".location-folder-list-wrap").append(h.data.html);if(bp.Nouveau.Media.folderLocationUI){bp.Nouveau.Media.folderLocationUI(g,d)}b(g).find("ul.location-folder-list span#"+d).trigger("click");b(g).find(".bb-folder-selected-id").val(d)}})}}b(document).on("click",g+" .location-folder-list li span",function(i){i.preventDefault();if(b(this).parent().hasClass("is_active")){return}if(b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").data("id")!=0){b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove()}b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+b(this).attr("id")+'">'+b(this).text()+"</span>");b(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected");if(d==b(i.currentTarget).data("id")){b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled")}else{b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled")}if(b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")){return}b(i.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val(b(i.currentTarget).data("id"));var h=b(i.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy");if(Number(b(i.currentTarget).data("id"))!==0){h.find("option").removeAttr("selected");h.val(b(i.currentTarget).parent().data("privacy"));h.prop("disabled",true)}else{h.find("option").removeAttr("selected");h.val("public");h.prop("disabled",false)}});b(document).on("click",g+" .breadcrumb .item > span",function(i){if(b(this).hasClass("is-disabled")){return}b(i.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val(b(i.currentTarget).data("id"));b(i.currentTarget).closest(".bb-field-wrap").find(".location-folder-list li span").removeClass("selected").parent().removeClass("is_active");b(i.currentTarget).closest(".bb-field-wrap").find('.location-folder-list li[data-id="'+b(i.currentTarget).data("id")+'"]').addClass("is_active");if(b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")){b(this).closest(".location-folder-list-wrap").find(".breadcrumb .item span:last-child").remove()}if(d==b(i.currentTarget).data("id")){b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").addClass("is-disabled")}else{b(i.currentTarget).closest(".bb-field-wrap").find(".bb-model-footer .bp-media-move").removeClass("is-disabled")}var h=b(i.currentTarget).closest("#bp-media-uploader").find("#bb-document-privacy");var j=b(i.currentTarget).closest("#bp-media-uploader").find(".location-folder-list li.is_active").data("privacy");if(Number(b(i.currentTarget).closest(".bb-field-wrap").find(".bb-folder-selected-id").val())!==0){h.find("option").removeAttr("selected");h.val(j===undefined?"public":j);h.prop("disabled",true)}else{h.find("option").removeAttr("selected");h.val("public");h.prop("disabled",false)}});var c=document.getElementsByClassName("uploader-post-document-template").length?document.getElementsByClassName("uploader-post-document-template")[0].innerHTML:"";e.options.previewTemplate=c;e.dropzone_obj=new Dropzone("div#media-uploader",e.options);e.dropzone_obj.on("sending",function(h,j,i){i.append("action","document_document_upload");i.append("_wpnonce",BP_Nouveau.nonces.media)});e.dropzone_obj.on("uploadprogress",function(j){var k=b(j.previewElement).find(".dz-progress-ring circle")[0];var h=k.r.baseVal.value;var i=h*2*Math.PI;k.style.strokeDasharray=i+" "+i;k.style.strokeDashoffset=i;var l=i-j.upload.progress.toFixed(0)/100*i;k.style.strokeDashoffset=l});e.dropzone_obj.on("addedfile",function(){setTimeout(function(){if(e.dropzone_obj.getAcceptedFiles().length){b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,e.dropzone_media.length,e.dropzone_obj.getAcceptedFiles().length)).show()}},1000)});e.dropzone_obj.on("error",function(i,h){if(i.accepted){if(typeof h!=="undefined"&&typeof h.data!=="undefined"&&typeof h.data.feedback!=="undefined"){b(i.previewElement).find(".dz-error-message span").text(h.data.feedback)}}else{if(!jQuery(".document-error-popup").length){b("body").append('<div id="bp-media-create-album" style="display: block;" class="open-popup document-error-popup"><transition name="modal"><div class="modal-mask bb-white bbm-model-wrap"><div class="modal-wrapper"><div id="boss-media-create-album-popup" class="modal-container has-folderlocationUI"><header class="bb-model-header"><h4>'+BP_Nouveau.media.invalid_file_type+'</h4><a class="bb-model-close-button errorPopup" href="#"><span class="dashicons dashicons-no-alt"></span></a></header><div class="bb-field-wrap"><p>'+h+"</p></div></div></div></div></transition></div>")}this.removeFile(i)}});e.dropzone_obj.on("accept",function(i,h){if(i.size==0){h(BP_Nouveau.media.empty_document_type)}else{h()}});e.dropzone_obj.on("queuecomplete",function(){b("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)});e.dropzone_obj.on("processing",function(){b("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")});e.dropzone_obj.on("success",function(k,j){if(j.data.id){k.id=j.id;j.data.uuid=k.upload.uuid;j.data.menu_order=e.dropzone_media.length;j.data.folder_id=e.current_folder;j.data.group_id=e.current_group_id;j.data.saved=false;e.dropzone_media.push(j.data)}else{var m,o,i,n,h;var l=j.data.feedback;k.previewElement.classList.add("dz-error");n=k.previewElement.querySelectorAll("[data-dz-errormessage]");h=[];for(o=0,i=n.length;o<i;o++){m=n[o];h.push(m.textContent=l)}return h}b(".bb-field-steps-1 #bp-media-document-next, #bp-media-document-submit").show();b(".bb-field-steps-1").addClass("controls-added");b("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...");b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,e.dropzone_media.length,e.dropzone_obj.getAcceptedFiles().length)).show()});e.dropzone_obj.on("removedfile",function(j){if(e.dropzone_media.length){for(var h in e.dropzone_media){if(j.upload.uuid==e.dropzone_media[h].uuid){if(typeof e.dropzone_media[h].saved!=="undefined"&&!e.dropzone_media[h].saved){e.removeAttachment(e.dropzone_media[h].id)}e.dropzone_media.splice(h,1);break}}}if(!e.dropzone_obj.getAcceptedFiles().length){b("#bp-media-uploader-modal-status-text").text("");b("#bp-media-document-submit").hide()}else{b("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,e.dropzone_media.length,e.dropzone_obj.getAcceptedFiles().length)).show()}})}},openMediaMove:function(g){g.preventDefault();var c,h,f,i;this.moveToIdPopup=b(g.currentTarget).attr("id");this.moveToTypePopup=b(g.currentTarget).attr("data-type");if(b(g.currentTarget).closest(".activity-inner").length>0){c=b(g.currentTarget).closest(".activity-inner")}else{if(b(g.currentTarget).closest("#media-stream.media").length>0){c=b(g.currentTarget).closest("#media-stream.media")}else{if(b(g.currentTarget).closest(".comment-item").length>0){c=b(g.currentTarget).closest(".comment-item")}}}b(c).find(".bp-media-move-file").addClass("open").show();f=b(g.currentTarget).closest(".media-action-wrap").siblings("a").data("id");h=b(g.currentTarget).closest(".media-action-wrap").siblings("a").data("album-id");c.find(".bp-media-move").attr("id",f);c.find(".bb-model-footer .bp-media-move").addClass("is-disabled");if(b(g.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li.comment-item").length){i="#"+b(g.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bp-media-move-file"}else{i="#"+b(g.currentTarget).closest("li.activity-item").attr("id")+" > .activity-content .bp-media-move-file"}b(i).find(".bp-document-move").attr("id",b(g.currentTarget).closest(".document-activity").attr("data-id"));if(b(g.currentTarget).closest(".media-list").length>0){i=".bp-media-move-file"}if("group"===this.moveToTypePopup){b(document).find(".location-album-list-wrap h4").show()}else{b(document).find(".location-album-list-wrap h4").hide()}b(i).addClass("open-popup");b(i).find(".location-album-list-wrap .location-album-list").remove();b(i).find(".location-album-list-wrap").append('<ul class="location-album-list is-loading"><li><i class="bb-icon-loader animate-spin"></i></li></ul>');var d=h;var e=this.moveToTypePopup;if(""!==this.moveToIdPopup){b.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"media_get_album_view",id:this.moveToIdPopup,type:this.moveToTypePopup,},success:function(j){b(document).find(".location-album-list-wrap h4 span.where-to-move-profile-or-group-media").html(j.data.first_span_text);if(""===j.data.html){b(document).find(".open-popup .location-album-list-wrap").hide();b(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").show()}else{b(document).find(".open-popup .location-album-list-wrap-main span.no-album-exists").hide();b(document).find(".open-popup .location-album-list-wrap").show()}if("group"===e){b(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").hide();b(document).find(".open-popup .bb-album-create-from").val("group")}else{b(document).find(".popup-on-fly-create-album .privacy-field-wrap-hide-show").show();b(document).find(".open-popup .bb-album-create-from").val("profile")}if(false===j.data.create_album){b(document).find(".open-popup .bp-media-open-create-popup-folder").removeClass("create-album");b(document).find(".open-popup .bp-media-open-create-popup-folder").hide()}else{b(document).find(".open-popup .bp-media-open-create-popup-folder").addClass("create-album");b(document).find(".open-popup .bp-media-open-create-popup-folder").show()}b(i).find(".location-album-list-wrap .location-album-list").remove();b(i).find(".location-album-list-wrap").append(j.data.html);b(i).find("ul.location-album-list span#"+d).trigger("click")}})}b(document).on("click",i+" .location-album-list li span",function(k){k.preventDefault();if(b(this).parent().hasClass("is_active")){return}if(b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").data("id")!=0){b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove()}b(this).closest(".location-album-list-wrap").find(".breadcrumb .item").append('<span class="is-disabled" data-id="'+b(this).attr("id")+'">'+b(this).text()+"</span>");b(this).addClass("selected").parent().addClass("is_active").siblings().removeClass("is_active").children("span").removeClass("selected");var j=b(document).find('a.bb-open-media-theatre[data-id="'+f+'"]').data("album-id");if(Number(j)==Number(b(k.currentTarget).data("id"))){b(k.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").addClass("is-disabled")}else{b(k.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").removeClass("is-disabled")}if(b(k.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").hasClass("is-disabled")){return}b(k.currentTarget).closest(".bp-media-move-file").find(".bb-album-selected-id").val(b(k.currentTarget).data("id"))});b(document).on("click",i+" .breadcrumb .item > span",function(j){if(b(this).hasClass("is-disabled")){return}b(j.currentTarget).closest(".bp-media-move-file").find(".bb-album-selected-id").val(0);b(j.currentTarget).closest(".bp-media-move-file").find(".location-album-list li span").removeClass("selected").parent().removeClass("is_active");if(b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").hasClass("is-disabled")){b(this).closest(".location-album-list-wrap").find(".breadcrumb .item span:last-child").remove()}if(d==b(j.currentTarget).data("id")){b(j.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").addClass("is-disabled")}else{b(j.currentTarget).closest(".bp-media-move-file").find(".bb-model-footer .bp-media-move").removeClass("is-disabled")}})},openDocumentMove:function(f){f.preventDefault();var h;var e=b(f.currentTarget).closest(".bb-activity-media-elem").find(".document-title").text();this.moveToIdPopup=b(f.currentTarget).attr("id");this.moveToTypePopup=b(f.currentTarget).attr("data-type");var g=b(f.currentTarget).attr("data-action");if(b(f.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li.comment-item").length){h="#"+b(f.currentTarget).closest(".conflict-activity-ul-li-comment").closest("li").attr("id")+".comment-item .bp-media-move-file"}else{h="#"+b(f.currentTarget).closest("li.activity-item").attr("id")+" > .activity-content .bp-media-move-file"}b(h).find(".bp-document-move").attr("id",b(f.currentTarget).closest(".document-activity").attr("data-id"));this.currentTargetParent=b(f.currentTarget).closest(".bb-activity-media-elem").attr("data-parent-id");if(b(f.currentTarget).closest(".media-folder_items").length>0){e=b(f.currentTarget).closest(".media-folder_items").find(".media-folder_name").text();this.currentTargetParent=b(f.currentTarget).closest(".media-folder_items").attr("data-parent-id");if(b(f.currentTarget).hasClass("ac-document-move")){h=".bp-media-move-file";b(h).find(".bp-document-move").attr("id",b(f.currentTarget).closest(".media-folder_items").attr("data-id"))}else{h=".bp-media-move-folder";b(h).find(".bp-folder-move").attr("id",b(f.currentTarget).closest(".media-folder_items").attr("data-id"))}}b(h).find(".location-folder-list-wrap .location-folder-list").remove();b(h).find(".location-folder-list-wrap").append('<ul class="location-folder-list is-loading"><li><i class="bb-icon-loader animate-spin"></i></li></ul>');if("document"===g){b(h).find(".bb-model-header h4 .target_name").text(BP_Nouveau.media.move_to_file)}else{b(h).find(".bb-model-header h4 .target_name").text(BP_Nouveau.media.move_to_folder)}b(h).show();b(h).addClass("open-popup");if("group"===this.moveToTypePopup){b(document).find(".location-folder-list-wrap h4").show();b(h).addClass("move-folder-popup-group")}else{b(document).find(".location-folder-list-wrap h4").hide();b(".move-folder-popup-group").removeClass("move-folder-popup-group")}var c=this.currentTargetParent;var d=this.moveToTypePopup;if(""!==this.moveToIdPopup){b.ajax({url:BP_Nouveau.ajaxurl,type:"GET",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup,},success:function(i){b(document).find(".location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(i.data.first_span_text);if(""===i.data.html){b(document).find(".open-popup .location-folder-list-wrap").hide();b(document).find(".open-popup .location-folder-list-wrap-main span.no-folder-exists").show()}else{b(document).find(".open-popup .location-folder-list-wrap-main span.no-folder-exists").hide();b(document).find(".open-popup .location-folder-list-wrap").show()}if("group"===d){b(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide();b(document).find(".open-popup .bb-folder-create-from").val("group")}else{b(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show();b(document).find(".open-popup .bb-folder-create-from").val("profile")}b(h).find(".location-folder-list-wrap .location-folder-list").remove();b(h).find(".location-folder-list-wrap").append(i.data.html);if(bp.Nouveau.Media.folderLocationUI){bp.Nouveau.Media.folderLocationUI(h,c);b(h).find("ul.location-folder-list span#"+c).trigger("click")}}})}},closeMediaMove:function(c){c.preventDefault();if(b(c.currentTarget).closest(".bp-media-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").data("id")!=0){b(c.currentTarget).closest(".bp-media-move-file").find(".location-album-list-wrap .breadcrumb .item span:last-child").remove()}b(c.currentTarget).closest(".bp-media-move-file").hide()},closeDocumentMove:function(d){d.preventDefault();var c=jQuery(d.currentTarget).closest(".has-folderlocationUI");if(b(d.currentTarget).hasClass("ac-document-close-button")){b(d.currentTarget).closest(".bp-media-move-file").hide().find(".bp-document-move").attr("id","")}else{b(d.currentTarget).closest(".bp-media-move-folder").hide().find(".bp-folder-move").attr("id","")}c.find(".bp-document-move.loading").removeClass("loading");this.clearFolderLocationUI(d)},renameDocument:function(e){var d=b(e.currentTarget).closest(".media-folder_items").find(".media-folder_name");var c=d.children("span").text();d.hide().siblings(".media-folder_name_edit_wrap").show().children(".media-folder_name_edit").val(c).focus().select();e.preventDefault()},editPrivacyDocument:function(d){d.preventDefault();var c=b(d.currentTarget).closest(".media-folder_items").find(".media-folder_visibility");c.find(".media-folder_details__bottom span").hide().siblings("select").removeClass("hide");c.find(".media-folder_details__bottom span").hide().siblings("select").val(b(d.currentTarget).attr("data-privacy"));c.find(".media-folder_details__bottom #bb-folder-privacy").attr("data-privacy",b(d.currentTarget).attr("data-privacy"));this.privacySelectorSelect=c.find(".media-folder_details__bottom span").hide().siblings("select");this.privacySelectorSpan=c.find(".media-folder_details__bottom span")},editPrivacyDocumentSubmit:function(d){var c=b(d.currentTarget);if(c.attr("data-mouseup")=="true"){c.attr("data-mouseup","false");c.addClass("hide").siblings("span").show().text(c.find("option:selected").text())}else{c.attr("data-mouseup","true")}},renameDocumentSubmit:function(d){var i=b(d.currentTarget).closest(".media-folder_items").find(".media-folder_name_edit");var l=b(d.currentTarget).closest(".media-folder_items").find(".media-folder_name > span");var c=b(d.currentTarget).closest(".media-folder_items").find(".media-folder_name");var g=b(d.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-id").attr("data-item-id");var f=b(d.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-attachment-id").attr("data-item-id");var m=b(d.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-type").attr("data-item-id");var e=i.val().trim();var k="";if(b(d.currentTarget).closest(".ac-document-list").length){k=/[?\[\]=<>:;,'"&$#*()|~`!{}%+ \/]+/g}else{if(b(d.currentTarget).closest(".ac-folder-list").length){k=/[\\/?%*:|"<>]+/g}}var h=k.exec(e);var j=Boolean(h);if(!j){i.removeClass("error")}else{i.addClass("error")}if(b(d.currentTarget).closest(".ac-document-list").length){if(e.indexOf("\\\\")!=-1||j){i.addClass("error")}else{i.removeClass("error")}}if(b(d.currentTarget).hasClass("name_edit_cancel")||d.keyCode==27){i.removeClass("error");i.parent().hide().siblings(".media-folder_name").show()}if(b(d.currentTarget).hasClass("name_edit_save")||d.keyCode==13){if(j){return}i.parent().addClass("submitting").append('<i class="animate-spin bb-icon-loader"></i>');b.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"document_update_file_name",document_id:g,attachment_document_id:f,document_type:m,name:e,_wpnonce:BP_Nouveau.nonces.media},success:function(n){if(n.success){c.attr("data-document-title",n.data.response.title+"."+c.data("extension"));l.html(n.data.response.title);i.removeClass("submitting");i.parent().find(".animate-spin").remove();i.parent().hide().siblings(".media-folder_name").show()}else{i.removeClass("submitting");i.parent().find(".animate-spin").remove();i.parent().hide().siblings(".media-folder_name").show();alert(n.data.feedback.replace("'","'"))}},})}d.preventDefault()},removeAttachment:function(d){var c={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:d};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:c})},changeUploadModalTab:function(d){d.preventDefault();var c=b(d.currentTarget).data("content");var e=b(d.currentTarget).closest("#bp-media-uploader");b(".bp-media-upload-tab-content").hide();b("#"+c).show();this.current_tab=c;e.find(".bp-media-upload-tab").removeClass("selected");b(d.currentTarget).addClass("selected");this.toggleSubmitMediaButton();e.find(".bb-field-steps-2").slideUp(200);e.find("#bb-media-privacy").hide();e.find(".bp-media-open-create-popup-folder").hide();if(c==="bp-dropzone-content"){e.find(".bb-field-steps-1").show();e.find("#bb-media-privacy").show();e.find(".bp-media-open-create-popup-folder, .bp-document-open-create-popup-folder, #bb-media-privacy").hide()}if(c==="bp-existing-media-content"){e.find(".bb-field-uploader-actions").hide()}jQuery(window).scroll()},openCreateAlbumModal:function(c){c.preventDefault();this.openUploader(c);b("#bp-media-create-album").show();if(b("body").hasClass("directory")){b("#bp-media-uploader").hide()}},openCreateFolderModal:function(c){c.preventDefault();b("#bp-media-create-folder").show();b("#bp-media-create-folder").addClass("open-popup");b(document).find(".open-popup #boss-media-create-album-popup #bb-album-title").show();b(document).find(".open-popup #boss-media-create-album-popup #bb-album-title").removeClass("error")},openCreateFolderChildModal:function(c){c.preventDefault();b("#bp-media-create-child-folder").show();b("#bp-media-create-child-folder").addClass("open-popup");b(document).find(".open-popup #boss-media-create-album-popup #bb-album-child-title").show();b(document).find(".open-popup #boss-media-create-album-popup #bb-album-child-title").removeClass("error")},openEditFolderChildModal:function(f){f.preventDefault();var d=BP_Nouveau.media.current_user_id;var c=BP_Nouveau.media.current_group_id;var e=BP_Nouveau.media.current_type;var g=0;if("group"===e){g=c;b(document).find(".location-folder-list-wrap h4").show()}else{g=d;b(document).find(".location-folder-list-wrap h4").hide()}b.ajax({url:BP_Nouveau.ajaxurl,type:"GET",data:{action:"document_get_folder_view",id:g,type:e,},success:function(h){b(document).find(".location-folder-list-wrap h4 span.where-to-move-profile-or-group-document").html(h.data.first_span_text);b(".location-folder-list-wrap .location-folder-list").remove();b(".location-folder-list-wrap").append(h.data.html);if(bp.Nouveau.Media.folderLocationUI){bp.Nouveau.Media.folderLocationUI("#bp-media-edit-child-folder",BP_Nouveau.media.current_folder);b(f.currentTarget).closest("#bp-media-single-folder").find("ul.location-folder-list span#"+BP_Nouveau.media.current_folder).trigger("click")}if("group"===e){b(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").hide();b(document).find(".open-popup .bb-folder-create-from").val("group")}else{b(document).find(".popup-on-fly-create-folder .privacy-field-wrap-hide-show").show();b(document).find(".open-popup .bb-folder-create-from").val("profile")}}});b("#bp-media-edit-child-folder").show()},folderLocationUI:function(c,f){if(b(c).find(".bb-folder-destination").length>0){if(!b(c).find(".location-folder-list-wrap").hasClass("is_loaded")){b(document).on("click",c+" .bb-folder-destination",function(){b(this).parent().find(".location-folder-list-wrap").slideToggle()});b(c).find(".location-folder-list-wrap").addClass("is_loaded");b(document).on("click",c+" .location-folder-list span",function(){this.currentTargetParent=b(this).attr("id");var i=b(this),h=b('<div class="item"></div>');i.parents("li").each(function(l,j){var k=b(j).children("span").clone();h.prepend("",k)});b(c).find(".breadcrumbs-append-ul-li .breadcrumb").html(h.prepend('<span data-id="0">'+BP_Nouveau.media.target_text+"</span>"));if(!b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length){b(c).find(".breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>')}b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(j){if(j>0){if(b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(c).find(".breadcrumbs-append-ul-li .breadcrumb").width()){b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2));if(!b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length){b('<span class="more_options">...</span>').insertAfter(b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0))}}}});if(b(this).hasClass("selected")&&!b(this).hasClass("disabled")){b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val("");b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val("0");if(b(c).find(".location-folder-list li.is_active").length){b(c).find(".bb-folder-selected-id").val(b(c).find(".location-folder-list li.is_active").attr("data-id"))}else{b(c).find(".bb-folder-selected-id").val("0")}}else{b(this).closest(".location-folder-list-wrap-main").find(".location-folder-list li span").removeClass("selected");b(this).addClass("selected");b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(b(this).text());b(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val(b(this).parent().attr("data-id"))}b(this).closest(".location-folder-list-wrap").find(".location-folder-title").text(b(this).siblings("span").text()).siblings(".location-folder-back").css("display","inline-block");b(this).siblings("ul").show().siblings("span, i").hide().parent().siblings().hide();b(this).siblings("ul").children("li").show().children("span,i").show();b(this).closest(".is_active").removeClass("is_active");b(c).find("li.is_active").removeClass("is_active");b(this).parent().addClass("is_active");b(c).find(".bb-folder-selected-id").val(b(c).find(".location-folder-list li.is_active").attr("data-id"));b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span").each(function(){b(this).show()});if(f===b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(b(c).hasClass("bp-media-move-file")||b(c).hasClass("bp-media-move-folder"))){b(c).find(".bp-document-move").addClass("is-disabled");b(c).find(".bp-folder-move").addClass("is-disabled")}else{b(c).find(".bp-document-move").removeClass("is-disabled");b(c).find(".bp-folder-move").removeClass("is-disabled")}setTimeout(function(){var j=0;if(b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")){j=b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").prev().attr("id")}else{j=b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("id")}if(f===j&&(b(c).hasClass("bp-media-move-file")||b(c).hasClass("bp-media-move-folder"))){b(c).find(".bp-document-move").addClass("is-disabled");b(c).find(".bp-folder-move").addClass("is-disabled")}else{b(c).find(".bp-document-move").removeClass("is-disabled");b(c).find(".bp-folder-move").removeClass("is-disabled")}},100)});b(document).on("click",c+" .breadcrumbs-append-ul-li .item span",function(i){if(b(this).parent().hasClass("is-disabled")||b(this).hasClass("more_options")){return}var h=b(i.currentTarget).attr("data-id");b(c).find(".location-folder-list-wrap").find(".location-folder-title").text(b(c).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block");b(c).find(".bb-folder-selected-id").val(h);b(c).find(".location-folder-list li").hide();b(c).find(".location-folder-list li.is_active").removeClass("is_active");b(c).find(".location-folder-list li > span.selected").removeClass("selected");b(c).find('.location-folder-list li[data-id="'+h+'"]').addClass("is_active").children("span").addClass("selected");b(c).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide();if(b(c).find(".location-folder-list li.is_active").children("ul").length&&!b(c).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")){setTimeout(function(){b(c).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100)}else{if(b(c).find(".location-folder-list li.is_active").hasClass("has-ul").length){b(c).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show()}else{setTimeout(function(){b(c).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10)}}if(h==="0"){b(c).find(".location-folder-list").children("li").show().children("span,i").show();b(c).find(".location-folder-list-wrap").find(".location-folder-title").text(BP_Nouveau.media.target_text);b(c).find(".location-folder-back").hide()}b(i.currentTarget).nextAll().remove();if(f===b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("data-id")&&(b(c).hasClass("bp-media-move-file")||b(c).hasClass("bp-media-move-folder"))){b(c).find(".bp-document-move").addClass("is-disabled");b(c).find(".bp-folder-move").addClass("is-disabled")}else{b(c).find(".bp-document-move").removeClass("is-disabled");b(c).find(".bp-folder-move").removeClass("is-disabled")}var k=b(c).find(".location-folder-list .is_active > span"),j=b('<div class="item"></div>');k.parents("li").each(function(o,l){var m=b(l).children("span").clone();j.prepend("",m)});b(c).find(".breadcrumbs-append-ul-li .breadcrumb").html(j.prepend('<span data-id="0">'+BP_Nouveau.media.target_text+"</span>"));if(b(c).find('.breadcrumbs-append-ul-li .breadcrumb .item > span[data-id="'+h+'"]').length===0){b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item").append(b(c).find('.location-folder-list li[data-id="'+h+'"]').children("span").clone())}if(!b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").length){b(c).find(".breadcrumbs-append-ul-li .breadcrumb").find(".item").append('<span class="hidden"></span>')}b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(l){if(l>0){if(b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(c).find(".breadcrumbs-append-ul-li .breadcrumb").width()){b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2));if(!b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length){b('<span class="more_options">...</span>').insertAfter(b(c).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0))}}}});b(c).find(".bb-folder-selected-id").val(h)})}b(c).find(".location-folder-list li").each(function(){b(this).children("ul").parent().addClass("has-ul").append('<i class="bb-icon-angle-right sub-menu-anchor"></i>')});if(b(c).hasClass("bp-media-move-folder")){b(c).find(".location-folder-list li>span").removeClass("is-disabled");b(c).find('.location-folder-list li>span[id="'+b(c).find(".bp-folder-move").attr("id")+'"]').parent().addClass("is-disabled")}var g=b(c).find(".bp-folder-move").attr("id");if(b(c).find('.location-folder-list li[data-id="'+g+'"]').siblings().length==0){b(c).find('.location-folder-list li[data-id="'+g+'"]').parent("ul").addClass("no-folder-list a")}if(f){b(c).find(".location-folder-list li").hide();b(c).find(".location-folder-list li.is_active").removeClass("is_active");b(c).find('.location-folder-list li[data-id="'+f+'"]').addClass("is_active");b(c).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide();if(b(c).find(".location-folder-list li.is_active").children("ul").length&&!b(c).find(".location-folder-list li.is_active").children("ul").hasClass("no-folder-list")){setTimeout(function(){b(c).find(".location-folder-list li.is_active").show().children("ul").show().children("li").show().children("span,i").show().closest("ul").siblings("span, i").hide()},100)}else{if(b(c).find(".location-folder-list li.is_active").hasClass("has-ul").length){b(c).find(".location-folder-list li.is_active").children("span,i").hide().parent().children("ul").show().children("li").show()}else{setTimeout(function(){b(c).find(".location-folder-list li.is_active").show().children("span").show().parent().siblings("li").show().children("span,i").show()},10)}}b(c).find(".location-folder-list-wrap").find(".location-folder-title").text(b(c).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block");b(c).find(".bb-folder-selected-id").val(b(c).find(".location-folder-list li.is_active").attr("data-id"));b(c).find('.location-folder-list li[data-id="'+g+'"]').children().hide()}if(f==="0"){b(c).find(".location-folder-list").children("li").show();b(c).find(".location-folder-list-wrap").find(".location-folder-title").text(BP_Nouveau.media.target_text);b(c).find(".location-folder-back").hide()}setTimeout(function(){var h=0;if(b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").hasClass("hidden")){h=b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").prev().attr("id")}else{h=b(c).find(".breadcrumbs-append-ul-li .item > span:last-child").attr("id")}if(f===h&&(b(c).hasClass("bp-media-move-file")||b(c).hasClass("bp-media-move-folder"))){b(c).find(".bp-document-move").addClass("is-disabled");b(c).find(".bp-folder-move").addClass("is-disabled")}else{b(c).find(".bp-document-move").removeClass("is-disabled");b(c).find(".bp-folder-move").removeClass("is-disabled")}},100);var e=b(c).find(".location-folder-list .is_active > span"),d=b('<div class="item"></div>');e.parents("li").each(function(j,h){var i=b(h).children("span").clone();d.prepend("",i)});b(c).find(".breadcrumbs-append-ul-li .breadcrumb").html(d.prepend('<span data-id="0">'+BP_Nouveau.media.target_text+"</span>"))}},clearFolderLocationUI:function(d){var c=jQuery(d.currentTarget).closest(".has-folderlocationUI");if(c.length>0){c.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected");jQuery(this).find("ul").hide()});c.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show();c.find(".location-folder-title").text(BP_Nouveau.media.target_text);c.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0");c.find(".ac_document_search_folder").val("");c.find(".bb-model-header h4 span").text("...");c.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show()}},closeCreateAlbumModal:function(c){c.preventDefault();this.closeUploader(c);b("#bp-media-create-album").hide();b("#bb-album-title").val("")},closeCreateFolderModal:function(c){c.preventDefault();b("#bp-media-create-folder, #bp-media-create-child-folder").hide();b("#bb-album-title, #bb-album-child-title").val("");b("#bp-media-create-child-folder-submit").removeClass("loading")},closeEditFolderModal:function(c){c.preventDefault();var d=b(c.currentTarget).closest("#bp-media-edit-child-folder");b("#bp-media-edit-child-folder").hide();d.find(".bb-field-steps-1").show().siblings(".bb-field-steps").hide();this.clearFolderLocationUI(c)},closeErrorPopup:function(c){c.preventDefault();b(c.currentTarget).closest(".open-popup").remove()},submitMedia:function(c){var l=this,j=b(c.currentTarget),h,d=b("#bb-media-privacy");c.preventDefault();if(j.hasClass("saving")){return false}j.addClass("saving");if(l.current_tab==="bp-dropzone-content"){var e=b("#bp-media-post-content").val();var k=b(c.currentTarget).closest(".open-popup");var m=k.find(".bb-album-selected-id").val();if(m.length&&parseInt(m)>0){m=m;for(var g=0;g<l.dropzone_media.length;g++){l.dropzone_media[g].album_id=m}}else{m=l.album_id}h={action:"media_save",_wpnonce:BP_Nouveau.nonces.media,medias:l.dropzone_media,content:e,album_id:m,group_id:l.group_id,privacy:d.val()};b("#bp-dropzone-content .bp-feedback").remove();b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:h,success:function(n){if(n.success){if(!b("#media-stream ul.media-list").length){b("#media-stream").html(b("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid"));b(".bb-photos-actions").show()}bp.Nouveau.inject("#media-stream ul.media-list",n.data.media,"prepend");if(n.data.media_personal_count){b("#buddypress").find(".bp-wrap .users-nav ul li#media-personal-li a span.count").text(n.data.media_personal_count)}if(n.data.media_group_count){b("#buddypress").find(".bp-wrap .groups-nav ul li#photos-groups-li a span.count").text(n.data.media_group_count)}for(var o=0;o<l.dropzone_media.length;o++){l.dropzone_media[o].saved=true}k.find(".bb-album-selected-id").val(0);l.closeUploader(c);jQuery(window).scroll()}else{b("#bp-dropzone-content").prepend(n.data.feedback)}j.removeClass("saving")}})}else{if(l.current_tab==="bp-existing-media-content"){var f=[];b('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){f.push(b(this).val())});h={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:f,album_id:l.album_id,group_id:l.group_id};b("#bp-existing-media-content .bp-feedback").remove();b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:h,success:function(i){if(i.success){if(!b("#media-stream ul.media-list").length){b("#media-stream").html(b("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid"));b(".bb-photos-actions").show()}bp.Nouveau.inject("#media-stream ul.media-list",i.data.media,"prepend");b('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){if(b(this).closest("li").data("id")===b(this).val()){b(this).closest("li").remove()}});jQuery(window).scroll();l.closeUploader(c)}else{b("#bp-existing-media-content").prepend(i.data.feedback)}j.removeClass("saving")}})}else{if(!l.current_tab){l.closeUploader(c);j.removeClass("saving")}}}},submitDocumentMedia:function(c){var m=this,k=b(c.currentTarget),j,d=b(c.currentTarget).closest("#bp-media-uploader");c.preventDefault();if(k.hasClass("saving")){return false}k.addClass("saving");if(m.current_tab==="bp-dropzone-content"){var f=b("#bp-media-post-content").val();var e=b("#bb-document-privacy").val();var l=b(c.currentTarget).closest(".open-popup");var n=l.find(".bb-folder-selected-id").val();var g=true;if(n.length&&parseInt(n)>0){g=false;n=n;for(var h=0;h<m.dropzone_media.length;h++){m.dropzone_media[h].folder_id=n}}else{n=m.album_id}j={action:"document_document_save",_wpnonce:BP_Nouveau.nonces.media,documents:m.dropzone_media,content:f,privacy:e,folder_id:m.current_folder,group_id:m.current_group_id};b("#bp-dropzone-content .bp-feedback").remove();b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:j,success:function(p){if(p.success){if(!b("#media-stream div#media-folder-document-data-table").length){b("#media-stream").html(b("<div></div>").addClass("display"));b("#media-stream div").attr("id","media-folder-document-data-table");b(".bb-photos-actions").show()}if(b(".document-data-table-head").length){if("yes"===BP_Nouveau.media.is_document_directory){var o=bp.Nouveau.getStorage("bp-document");var r=o.scope;if("groups"===r){b(document).find("li#document-personal a").trigger("click");b(document).find("li#document-personal").trigger("click")}else{g?bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",p.data.document,"prepend"):""}}else{g?bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",p.data.document,"prepend"):""}}else{location.reload(true)}b("#bp-media-post-content").val("");for(var q=0;q<m.dropzone_media.length;q++){m.dropzone_media[q].saved=true}m.closeUploader(c);b(document).removeClass("open-popup");jQuery(window).scroll()}else{b(document).removeClass("open-popup");b("#bp-dropzone-content").prepend(p.data.feedback)}k.removeClass("saving");d.find("#bp-media-document-submit").hide()}})}else{if(!m.current_tab){m.closeUploader(c);k.removeClass("saving")}}},saveAlbum:function(e){var g=b(e.currentTarget),c=this,h=b("#bb-album-title"),d=b("#bb-album-privacy");if(g.hasClass("saving")){return false}e.preventDefault();if(b.trim(h.val())===""){h.addClass("error");return false}else{h.removeClass("error")}if(!c.group_id&&b.trim(d.val())===""){d.addClass("error");return false}else{d.removeClass("error")}g.addClass("saving");g.attr("disabled",true);var f={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:h.val(),medias:c.dropzone_media,privacy:d.val()};if(c.album_id){f.album_id=c.album_id}if(c.group_id){f.group_id=c.group_id}b("#bp-media-single-album .bp-feedback").remove();b("#boss-media-create-album-popup .bp-feedback").remove();b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:f,success:function(i){setTimeout(function(){g.removeClass("saving");g.prop("disabled",false)},500);if(i.success){if(c.album_id){b("#bp-single-album-title").text(h.val());b("#bb-album-privacy").val(d.val());c.cancelEditAlbumTitle(e)}else{b("#buddypress .bb-albums-list").prepend(i.data.album);window.location.href=i.data.redirect_url}}else{if(c.album_id){b("#bp-media-single-album").prepend(i.data.feedback)}else{b("#boss-media-create-album-popup .bb-model-header").after(i.data.feedback)}}}})},saveFolder:function(c){var g=b(c.currentTarget),k=this,j=b("#bb-album-title"),d=b(c.currentTarget).parents().find(".open-popup #bb-folder-privacy option:selected");c.preventDefault();var h=/[\\/?%*:|"<>]+/g;var f=h.exec(j.val());var i=Boolean(f);if(b.trim(j.val())===""||i){j.addClass("error");return false}else{j.removeClass("error")}if(!k.group_id&&b.trim(d.val())===""){d.addClass("error");return false}else{d.removeClass("error")}g.prop("disabled",true).addClass("loading");var e={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:j.val().trim(),privacy:d.val(),album_id:k.current_folder,group_id:k.current_group_id};b(".bb-single-album-header .bp-feedback").remove();b("#boss-media-create-album-popup .bp-feedback").remove();b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(m){setTimeout(function(){g.prop("disabled",false)},500);if(m.success){k.closeFolderUploader(c);if(b(".document-data-table-head").length){if("yes"===BP_Nouveau.media.is_document_directory){var l=bp.Nouveau.getStorage("bp-document");var n=l.scope;if("groups"===n){b(document).find("li#document-personal a").trigger("click");b(document).find("li#document-personal").trigger("click")}else{bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",m.data.document,"prepend");jQuery(window).scroll()}}else{bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",m.data.document,"prepend");jQuery(window).scroll()}}else{location.reload(true)}}else{alert(m.data.feedback.replace("'","'"))}}})},saveChildFolder:function(e){var i=b(e.currentTarget),d=this,j=b("#bp-media-create-child-folder #bb-album-child-title");e.preventDefault();var h=/[\\/?%*:|"<>]+/g;var g=h.exec(j.val());var c=Boolean(g);if(b.trim(j.val())===""||c){j.addClass("error");return false}else{j.removeClass("error")}i.prop("disabled",true).addClass("loading");var f={action:"document_child_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:j.val(),folder_id:d.current_folder,group_id:d.current_group_id,};b(".bb-single-album-header .bp-feedback").remove();b("#boss-media-create-album-popup .bp-feedback").remove();b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:f,success:function(k){if(k.success){d.closeChildFolderUploader(e);location.reload(true)}else{alert(k.data.feedback.replace("'","'"))}}})},renameChildFolder:function(c){c.preventDefault();var h=b(c.currentTarget),l=this,k=b("#bp-media-edit-child-folder #bb-album-child-title"),e=b("#bp-media-edit-child-folder #bb-folder-privacy"),d=this.currentTargetParent;var j=/[\\/?%*:|"<>]+/g;var g=j.exec(k.val());var i=Boolean(g);if(b.trim(k.val())===""||i){k.addClass("error");return false}else{k.removeClass("error")}h.prop("disabled",true).addClass("loading");var f={action:"document_edit_folder",_wpnonce:BP_Nouveau.nonces.media,title:k.val(),privacy:e.val(),id:d,group_id:l.current_group_id,};b(".bb-single-album-header .bp-feedback").remove();b("#boss-media-create-album-popup .bp-feedback").remove();b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:f,success:function(m){setTimeout(function(){h.prop("disabled",false)},500);if(m.success){window.location.reload(true)}else{if(l.current_folder){b("#bp-media-single-album").prepend(m.data.feedback)}else{b("#boss-media-create-album-popup .bb-model-header").after(m.data.feedback)}}}})},deleteAlbum:function(c){c.preventDefault();if(!this.album_id){return false}if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm)){return false}b(c.currentTarget).prop("disabled",true);var d={action:"media_album_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){if(e.success){window.location.href=e.data.redirect_url}else{alert(BP_Nouveau.media.i18n_strings.album_delete_error);b(c.currentTarget).prop("disabled",false)}}})},deleteFolder:function(c){c.preventDefault();if(!BP_Nouveau.media.current_folder){return false}if(!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm)){return false}b(c.currentTarget).prop("disabled",true);var d={action:"document_folder_delete",_wpnonce:BP_Nouveau.nonces.media,folder_id:BP_Nouveau.media.current_folder,group_id:BP_Nouveau.media.current_group_id};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){if(e.success){window.location.href=e.data.redirect_url}else{alert(BP_Nouveau.media.i18n_strings.folder_delete_error);b(c.currentTarget).prop("disabled",false)}}})},addMediaIdsToGroupMessagesForm:function(){var c=this;if(b("#bp_group_messages_media").length){b("#bp_group_messages_media").val(JSON.stringify(c.dropzone_media))}},addDocumentIdsToGroupMessagesForm:function(){var c=this;if(b("#bp_group_messages_document").length){b("#bp_group_messages_document").val(JSON.stringify(c.dropzone_media))}},addVideoIdsToGroupMessagesForm:function(){var c=this;if(b("#bp_group_messages_video").length){b("#bp_group_messages_video").val(JSON.stringify(c.dropzone_media))}},injectMedias:function(h){var e=bp.Nouveau.getStorage("bp-media"),g=e.scope||null,f=e.filter||null;if(b(h.currentTarget).hasClass("load-more")){var i=(Number(this.current_page)*1)+1,d=this,c="";h.preventDefault();b(h.currentTarget).find("a").first().addClass("loading");if(b("#buddypress .dir-search input[type=search]").length){c=b("#buddypress .dir-search input[type=search]").val()}bp.Nouveau.objectRequest({object:"media",scope:g,filter:f,search_terms:c,page:i,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(j){if(true===j.success){b(h.currentTarget).remove();d.current_page=i;jQuery(window).scroll()}})}},injectDocuments:function(c){var j=bp.Nouveau.getStorage("bp-document"),g="",f="",l=j.scope||null,d=j.filter||null,e=b(c.currentTarget);if(e.hasClass("load-more")){var h=(Number(this.current_page)*1)+1,k=this,i="";c.preventDefault();e.find("a").first().addClass("loading");if(b("#buddypress .dir-search input[type=search]").length){i=b("#buddypress .dir-search input[type=search]").val()}if(this.order_by&&this.sort_by){g=this.sort_by;f=this.order_by}else{if(undefined!==j.extras){g=j.extras.sort;f=j.extras.orderby}else{g="ASC";f="title"}}var m;m={object:"document",scope:l,filter:d,search_terms:i,page:h,method:"append",target:"#buddypress [data-bp-list] div#media-folder-document-data-table",order_by:f,sort:g};bp.Nouveau.objectRequest(m).done(function(n){if(true===n.success){e.parent(".pager").remove();k.current_page=h;jQuery(window).scroll()}})}},sortDocuments:function(c){var k=b(c.currentTarget),h=k.data("target"),o="",g="date_created",i="",l=1;var j=k.attr("class");switch(h){case"name":g="title";break;case"modified":g="date_modified";break;case"visibility":g="privacy";break;case"group":g="group_id";break}k.hasClass("asce")?k.removeClass("asce"):k.addClass("asce");var i=k.hasClass("asce")?"DESC":"ASC";var n=bp.Nouveau.getStorage("bp-document");var f={};f.orderby=g;f.sort=i;if("group"!==g){bp.Nouveau.setStorage("bp-document","extras",f)}var m=bp.Nouveau.getStorage("bp-document"),p=m.scope||null,d=m.filter||null,e=b(c.currentTarget);if(b("#buddypress .bp-dir-search-form input[type=search]").length){o=b("#buddypress .bp-dir-search-form input[type=search]").val()}this.sort_by=i;this.order_by=g;this.current_page=l;bp.Nouveau.objectRequest({object:"document",scope:p,filter:d,search_terms:o,page:l,order_by:g,sort:i,method:"reset",target:"#buddypress [data-bp-list]"}).done()},documentPopupNavigate:function(d){d.preventDefault();var e=b(d.currentTarget),f=e.closest(".bb-field-steps");var c=e.closest(".bp-document-listing").length==0?"#bb-album-child-title":"#bb-album-title";if(e.closest(".document-options").length){c="#bb-album-title"}if(e.hasClass("bb-field-steps-next")&&f.find(c).val().trim()==""){f.find(c).addClass("error");return}else{f.find(c).removeClass("error")}f.slideUp(200).siblings(".bb-field-steps").slideDown(200)},uploadDocumentNavigate:function(c){c.preventDefault();var d=b(c.currentTarget),e=b(d).closest("#bp-media-uploader");if(b(d).hasClass("bb-field-uploader-next")){e.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200);e.find("#bp-media-document-submit, #bp-media-document-prev, .bp-document-open-create-popup-folder, #bb-document-privacy").show();if(Number(b(e).find(".bb-folder-selected-id"))!==0&&b(e).find(".location-folder-list li.is_active").length){b(e).find(".location-folder-list").scrollTop(b(e).find(".location-folder-list li.is_active").offset().top-b(e).find(".location-folder-list").offset().top)}b(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span:not(.hidden)").each(function(f){if(f>0){if(b(e).find(".breadcrumbs-append-ul-li .breadcrumb .item").width()>b(e).find(".breadcrumbs-append-ul-li .breadcrumb").width()){b(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span.hidden").append(b(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(2));if(!b(e).find(".breadcrumbs-append-ul-li .breadcrumb .item .more_options").length){b('<span class="more_options">...</span>').insertAfter(b(e).find(".breadcrumbs-append-ul-li .breadcrumb .item span").eq(0))}}}})}else{b(d).hide();e.find("#bp-media-document-prev, .bp-document-open-create-popup-folder").hide();e.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200);if(e.closest("#bp-media-single-folder").length){b("#bb-document-privacy").hide()}}},uploadMediaNavigate:function(c){c.preventDefault();var d=b(c.currentTarget),e=b(d).closest(".bp-media-photo-uploader");if(b(d).hasClass("bb-field-uploader-next")){e.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200);e.find("#bp-media-submit, #bp-media-prev, .bp-media-open-create-popup-folder.create-album").show();e.find("#bb-media-privacy").show();if(Number(b(e).find(".bb-album-selected-id"))!==0&&b(e).find(".location-album-list li.is_active").length){b(e).find(".location-album-list").scrollTop(b(e).find(".location-album-list li.is_active").offset().top-b(e).find(".location-album-list").offset().top)}}else{b(d).hide();e.find("#bp-media-prev, .bp-media-open-create-popup-folder").hide();e.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200);if(e.closest("#bp-media-single-album").length){b("#bb-media-privacy").hide()}}},appendMedia:function(h){var e=bp.Nouveau.getStorage("bp-media"),g=e.scope||null,f=e.filter||null;if(b(h.currentTarget).hasClass("load-more")){var i=(Number(this.current_page_existing_media)*1)+1,d=this,c="";h.preventDefault();b(h.currentTarget).find("a").first().addClass("loading");if(b("#buddypress .dir-search input[type=search]").length){c=b("#buddypress .dir-search input[type=search]").val()}bp.Nouveau.objectRequest({object:"media",scope:g,filter:f,search_terms:c,page:i,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(j){if(true===j.success){b(h.currentTarget).remove();d.current_page_existing_media=i;jQuery(window).scroll()}})}},appendAlbums:function(d){var f=(Number(this.current_page_albums)*1)+1,c=this;d.preventDefault();b(d.currentTarget).find("a").first().addClass("loading");var e={action:"media_albums_loader",_wpnonce:BP_Nouveau.nonces.media,page:f};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(g){if(true===g.success){b(d.currentTarget).remove();b("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){b("#albums-dir-list ul.bb-albums-list").append(g.data.albums);b(this).fadeIn(100)});c.current_page_albums=f}}})},toggleSubmitMediaButton:function(){var c=b("#bp-media-submit"),d=b("#bp-media-add-more");if(this.current_tab==="bp-dropzone-content"){if(this.dropzone_obj.getAcceptedFiles().length){c.show();d.show()}else{c.hide();d.hide()}}else{if(this.current_tab==="bp-existing-media-content"){if(b('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length){c.show()}else{c.hide()}d.hide()}}},playVideo:function(d){d.preventDefault();var c=b(d.currentTarget).find("video").get(0),e=b(d.currentTarget).find(".gif-play-button");if(c.paused==true){c.play();e.hide()}else{c.pause();e.show()}},autoPlayGifVideos:function(){b(".gif-player").each(function(){var c=b(this).find("video").get(0),d=b(this).find(".gif-play-button");if(b(this).is(":in-viewport")){c.play();d.hide()}else{c.pause();d.show()}})},fileActionButton:function(c){if(b(c.currentTarget).parent().hasClass("download_file")){return}if(b(c.currentTarget).parent().hasClass("copy_download_file_url")){return}if(b(c.currentTarget).parent().hasClass("redirect-activity-privacy-change")){return}c.preventDefault();b(c.currentTarget).closest(".media-folder_items").toggleClass("is-visible").siblings(".media-folder_items").removeClass("is-visible")},copyDownloadLink:function(e){e.preventDefault();var f=e.currentTarget,d="document_copy_link";b("body").append('<textarea style="position:absolute;opacity:0;" id="'+d+'"></textarea>');var c=b(f).text();b(f).text(BP_Nouveau.media.copy_to_clip_board_text);b("#"+d).val(b(f).attr("href"));b("#"+d).select();document.execCommand("copy");setTimeout(function(){b(f).text(c)},2000);return false},fileActivityActionButton:function(c){c.preventDefault();if(b(c.currentTarget).parent().hasClass("copy_download_file_url")){return}b(c.currentTarget).closest(".bb-activity-media-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-media-elem").removeClass("is-visible");if(b(c.currentTarget).closest(".bb-activity-media-elem").length<1){b(c.currentTarget).closest(".bb-photo-thumb").toggleClass("is-visible").parent().siblings().find(".bb-photo-thumb").removeClass("is-visible").removeClass("is-visible")}if(c.currentTarget.tagName.toLowerCase()=="a"&&(!b(c.currentTarget).hasClass("document-action_more")&&!b(c.currentTarget).hasClass("media-action_more"))){b(c.currentTarget).closest(".bb-activity-media-elem").removeClass("is-visible");b(c.currentTarget).closest(".bb-photo-thumb").removeClass("is-visible")}},toggleFileActivityActionButton:function(d){var c;d=d||window.event;if(d.target){c=d.target}else{if(d.srcElement){c=d.srcElement}}if(c.nodeType===3){c=c.parentNode}if(d.altKey===true||d.metaKey===true){return d}if(b(c).hasClass("document-action_more")||b(c).parent().hasClass("document-action_more")||b(c).hasClass("media-folder_action__anchor")||b(c).parent().hasClass("media-folder_action__anchor")||b(c).hasClass("media-action_more")||b(c).parent().hasClass("media-action_more")||b(c).hasClass("video-action_more")||b(c).parent().hasClass("video-action_more")){return d}b(".bb-activity-media-elem.is-visible").removeClass("is-visible");b(".media-folder_items.is-visible").removeClass("is-visible");b(".bb-photo-thumb.is-visible").removeClass("is-visible");b(".bb-item-thumb.is-visible").removeClass("is-visible");b(".bb-activity-video-elem.is-visible").removeClass("is-visible");b(".video-action-wrap.item-action-wrap.is-visible").removeClass("is-visible")},expandCodePreview:function(c){c.preventDefault();b(c.currentTarget).closest(".document-activity").addClass("code-full-view")},collapseCodePreview:function(c){c.preventDefault();b(c.currentTarget).closest(".document-activity").removeClass("code-full-view")},documentCodeMirror:function(){b(".document-text:not(.loaded)").each(function(){var e=b(this);var f=e.attr("data-extension");var c=e.attr("data-extension");if(f=="html"||f=="htm"){c="text/html"}if(f=="js"){var d=CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),lineNumbers:true,theme:"default",readOnly:true,lineWrapping:true,})}else{var d=CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),mode:c,lineNumbers:true,theme:"default",readOnly:true,lineWrapping:true,})}e.addClass("loaded");if(e.parent().height()>150){e.closest(".document-text-wrap").addClass("is_large")}})},closePopup:function(c){if(c.keyCode==27){b(".bp-media-move-folder.open-popup .ac-folder-close-button:visible, .bp-media-move-file .ac-media-close-button:visible, .bp-media-move-folder.open-popup .close-create-popup-folder:visible,.bp-media-move-file.open-popup .ac-document-close-button:visible, .bp-media-move-file .close-create-popup-folder:visible, .bp-media-move-photo.open .close-create-popup-album:visible").trigger("click");b("#bp-media-create-folder #bp-media-create-folder-close:visible, #bp-media-create-child-folder #bp-media-create-folder-close:visible").trigger("click");b("#bp-media-uploader #bp-media-uploader-close:visible").trigger("click");b("#bp-media-edit-child-folder #bp-media-edit-folder-close:visible").trigger("click");b("#bp-media-create-album #bp-media-create-album-close:visible").trigger("click");b(".media-folder_visibility select#bb-folder-privacy:not(.hide)").each(function(){b(this).attr("data-mouseup","false").addClass("hide").siblings("span").show().text(b(this).find("option:selected").text())});b(".bp-video-thumbnail-uploader .bp-video-thumbnail-uploader-close:visible").trigger("click")}},submitPopup:function(c){if(c.keyCode==13){b(".bp-media-move-folder.open-popup .bp-document-move:not(.is-disabled):visible, .bp-media-move-folder.open-popup  .bp-folder-move:not(.is-disabled):visible,.bp-media-move-file.open-popup .bp-document-move:not(.is-disabled):visible, .bp-media-move-file.open-popup .bp-document-create-popup-folder-submit:visible, .bp-media-move-folder.open-popup .bp-document-create-popup-folder-submit:visible, .bp-media-move-file.open .bp-media-move:not(.is-disabled):visible, .bp-media-move-file.open .bp-media-create-popup-album-submit:visible").trigger("click");b("#bp-media-create-folder #bp-media-create-folder-submit:visible, #bp-media-create-child-folder #bp-media-create-child-folder-submit:visible").trigger("click");b("#bp-media-uploader #bp-media-document-submit:visible, #bp-media-uploader #bp-media-submit:visible").trigger("click");b("#bp-media-edit-child-folder #bp-media-edit-child-folder-submit:visible").trigger("click");b("#bp-media-create-album #bp-media-create-album-submit:visible").trigger("click")}}};bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals();this.addListeners()},setupGlobals:function(){this.medias=[];this.documents=[];this.current_media=false;this.current_document=false;this.current_index=0;this.current_document_index=0;this.is_open_media=false;this.is_open_document=false;this.nextLink=b(".bb-next-media");this.nextDocumentLink=b(".bb-next-document");this.previousDocumentLink=b(".bb-prev-document");this.previousLink=b(".bb-prev-media");this.activity_ajax=false;this.group_id=typeof BP_Nouveau.media.group_id!=="undefined"?BP_Nouveau.media.group_id:false;this.manage_media=typeof BP_Nouveau.media.can_manage_media!=="undefined"?BP_Nouveau.media.can_manage_media:false;this.manage_document=typeof BP_Nouveau.media.can_manage_document!=="undefined"?BP_Nouveau.media.can_manage_document:false},addListeners:function(){b(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this));b(document).on("click",".bb-open-document-theatre",this.openDocumentTheatre.bind(this));b(document).on("click",".document-detail-wrap-description-popup",this.openDocumentTheatre.bind(this));b(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this));b(document).on("click",".bb-close-document-theatre",this.closeDocumentTheatre.bind(this));b(document).on("click",".bb-prev-media",this.previous.bind(this));b(document).on("click",".bb-next-media",this.next.bind(this));b(document).on("click",".bb-prev-document",this.previousDocument.bind(this));b(document).on("click",".bb-next-document",this.nextDocument.bind(this));b(document).on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this));b(document).on("click","#bb-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this));b(document).on("click","#bb-media-model-container .document-privacy>li",this.documentPrivacyChange.bind(this));b(document).on("click","#bb-media-model-container .bb-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this));b(document).on("click","#bb-media-model-container .bb-document-section span.privacy",bp.Nouveau,this.toggleDocumentPrivacyDropdown.bind(this));b(document).on("click",".bp-add-media-activity-description",this.openMediaActivityDescription.bind(this));b(document).on("click","#bp-activity-description-new-reset",this.closeMediaActivityDescription.bind(this));b(document).on("click","#bp-activity-description-new-submit",this.submitMediaActivityDescription.bind(this));b(document).click(this.togglePopupDropdown);document.addEventListener("keyup",this.checkPressedKeyDocuments.bind(this));document.addEventListener("keyup",this.checkPressedKey.bind(this))},checkPressedKey:function(d){var c=this;d=d||window.event;if(!c.is_open_media){return false}var f=(b("#add-activity-description").length&&b("#add-activity-description").is(":focus"))||(b(".ac-reply-content .ac-textarea > .ac-input").length&&b(".ac-reply-content .ac-textarea > .ac-input").hasClass("focus-visible"));switch(d.keyCode){case 27:c.closeTheatre(d);break;case 37:if(typeof c.medias[c.current_index-1]==="undefined"||f){return false}c.previous(d);break;case 39:if(typeof c.medias[c.current_index+1]==="undefined"||f){return false}c.next(d);break}},checkPressedKeyDocuments:function(d){d=d||window.event;var c=this;if(!c.is_open_document){return false}var f=(b("#add-activity-description").length&&b("#add-activity-description").is(":focus"))||(b(".ac-reply-content .ac-textarea > .ac-input").length&&b(".ac-reply-content .ac-textarea > .ac-input").hasClass("focus-visible"));switch(d.keyCode){case 27:c.closeDocumentTheatre(d);break;case 37:if(typeof c.documents[c.current_document_index-1]==="undefined"||f){return false}c.previousDocument(d);break;case 39:if(typeof c.documents[c.current_document_index+1]==="undefined"||f){return false}c.nextDocument(d);break}},openTheatre:function(e){e.preventDefault();var f=b(e.currentTarget),g,c=this;if(f.closest("#bp-existing-media-content").length){return false}c.setupGlobals();c.setMedias(f);g=f.data("id");c.setCurrentMedia(g);c.showMedia();c.navigationCommands();c.getMediasDescription();b(".bb-media-model-wrapper.document").hide();var d=document.getElementById(b(".bb-media-model-wrapper.video video").attr("id"));if(d){d.pause();d.src=""}b(".bb-media-model-wrapper.video").hide();b(".bb-media-model-wrapper.media").show();c.is_open_media=true},getMediasDescription:function(){var d=this;b(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>');if(d.activity_ajax!=false){d.activity_ajax.abort()}var c=b('[data-bp-activity-id="'+d.current_media.activity_id+'"] .activity-comments');if(c.length){d.current_media.parent_activity_comments=true;c.html("")}d.activity_ajax=b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_media_description",id:d.current_media.id,attachment_id:d.current_media.attachment_id,nonce:BP_Nouveau.nonces.media},success:function(e){if(e.success){b(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description);b(".bb-media-info-section:visible").show();b(window).scroll();setTimeout(function(){bp.Nouveau.reportPopUp();bp.Nouveau.reportedPopup()},10)}else{b(".bb-media-info-section.media").hide()}}})},openDocumentTheatre:function(e){e.preventDefault();var f=b(e.currentTarget),g,c=this;if(f.closest("#bp-existing-document-content").length){return false}if(f.closest(".document.document-theatre").length){c.closeDocumentTheatre(e)}g=f.data("id");c.setupGlobals();c.setDocuments(f);c.setCurrentDocument(g);c.showDocument();c.navigationDocumentCommands();c.getDocumentsDescription();if(b.inArray(c.current_document.extension,BP_Nouveau.document.mp3_preview_extension.split(","))!==-1){if(b(e.currentTarget).closest(".bb-activity-media-elem.document-activity").length&&b(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap").length){b(e.currentTarget).closest(".bb-activity-media-elem.document-activity").find(".document-audio-wrap audio")[0].pause()}}b(".bb-media-model-wrapper.media").hide();b(".bb-media-model-wrapper.document").show();var d=document.getElementById(b(".bb-media-model-wrapper.video video").attr("id"));if(d){d.pause();d.src=""}b(".bb-media-model-wrapper.video").hide();c.is_open_document=true},resetRemoveActivityCommentsData:function(){var d=this,g=false,i=false,c=false,h=false,f=false,e=false;if(d.current_media.parent_activity_comments){h=b('.bb-media-model-wrapper.media [data-bp-activity-id="'+d.current_media.activity_id+'"]');g=h.find(".activity-comments");if(g.length){f=g.html();e=g.attr("class");g.remove();g=b('[data-bp-activity-id="'+d.current_media.activity_id+'"] .activity-comments');if(g.length){g.html(f);g.attr("class",e)}}c=h.find(".activity-state");if(c.length){f=c.html();e=c.attr("class");c.remove();c=b('[data-bp-activity-id="'+d.current_media.activity_id+'"] .activity-state');if(c.length){c.html(f);c.attr("class",e)}}i=h.find(".activity-meta");if(i.length){f=i.html();e=i.attr("class");i.remove();i=b('[data-bp-activity-id="'+d.current_media.activity_id+'"] > .activity-meta');if(i.length){i.html(f);i.attr("class",e)}}h.remove()}if(d.current_document.parent_activity_comments){h=b('.bb-media-model-wrapper.document [data-bp-activity-id="'+d.current_document.activity_id+'"]');g=h.find(".activity-comments");if(g.length){f=g.html();e=g.attr("class");g.remove();g=b('[data-bp-activity-id="'+d.current_document.activity_id+'"] .activity-comments');if(g.length){g.html(f);g.attr("class",e);g.find(".document-text.loaded").removeClass("loaded").find(".CodeMirror").remove();jQuery(window).scroll()}}c=h.find(".activity-state");if(c.length){f=c.html();e=c.attr("class");c.remove();c=b('[data-bp-activity-id="'+d.current_document.activity_id+'"] .activity-state');if(c.length){c.html(f);c.attr("class",e)}}i=h.find(".activity-meta");if(i.length){f=i.html();e=i.attr("class");i.remove();i=b('[data-bp-activity-id="'+d.current_document.activity_id+'"] > .activity-meta');if(i.length){i.html(f);i.attr("class",e)}}h.remove()}bp.Nouveau.reportPopUp();bp.Nouveau.reportActions()},closeTheatre:function(d){d.preventDefault();var c=this;b(".bb-media-model-wrapper.media .bb-media-section").find("img").attr("src","");if(b(".bb-media-model-wrapper.video .bb-media-section").find("video").length){b(".bb-media-model-wrapper.video .bb-media-section").find("video").attr("src","")}b(".bb-media-model-wrapper").hide();c.is_open_media=false;c.resetRemoveActivityCommentsData();c.current_media=false},closeDocumentTheatre:function(e){e.preventDefault();var d=this;var c=b(document).find(".document-theatre");c.find(".bb-media-section").removeClass("bb-media-no-preview").find(".document-preview").html("");b(".bb-media-info-section.document").show();c.hide();d.is_open_document=false;d.resetRemoveActivityCommentsData();d.current_document=false},setMedias:function(h){var e=b(".bb-open-media-theatre"),f=0,d=this;if(b("body").hasClass("activity")){e=b(h).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre")}if(typeof e!=="undefined"){d.medias=[];for(f=0;f<e.length;f++){var g=b(e[f]);if(!g.closest("#bp-existing-media-content").length){var c={id:g.data("id"),attachment:g.data("attachment-full"),activity_id:g.data("activity-id"),attachment_id:g.data("attachment-id"),privacy:g.data("privacy"),parent_activity_id:g.data("parent-activity-id"),album_id:g.data("album-id"),group_id:g.data("group-id"),can_edit:g.data("can-edit"),is_forum:false};if(g.closest(".forums-media-wrap").length){c.is_forum=true}if(typeof c.privacy!=="undefined"&&c.privacy=="message"){c.is_message=true}else{c.is_message=false}d.medias.push(c)}}}},setDocuments:function(h){var g=b(".bb-open-document-theatre"),i=0,f=this;if(b(h).closest(".bp-search-ac-header").length){g=b(h).closest(".bp-search-ac-header").find(".bb-open-document-theatre")}else{if(b("body").hasClass("activity")&&b(h).closest(".search-document-list").length===0){g=b(h).closest(".bb-activity-media-wrap").find(".bb-open-document-theatre")}}if(typeof g!=="undefined"){f.documents=[];for(i=0;i<g.length;i++){var c=b(g[i]);if(!g.closest("#bp-existing-document-content").length){var e={id:c.data("id"),attachment:c.data("attachment-full"),activity_id:c.data("activity-id"),attachment_id:c.data("attachment-id"),privacy:c.data("privacy"),parent_activity_id:c.data("parent-activity-id"),album_id:c.data("album-id"),group_id:c.data("group-id"),extension:c.data("extension"),target_text:c.data("document-title"),preview:c.data("preview"),full_preview:c.data("full-preview"),text_preview:c.data("text-preview"),mirror_text:c.data("mirror-text"),target_icon_class:c.data("icon-class"),author:c.data("author"),download:c.attr("href"),mp3:c.data("mp3-preview"),can_edit:c.data("can-edit"),video:c.attr("data-video-preview"),is_forum:false};if(c.closest(".forums-media-wrap").length){e.is_forum=true}if(typeof e.privacy!=="undefined"&&e.privacy=="message"){e.is_message=true}else{e.is_message=false}f.documents.push(e)}}}},setCurrentMedia:function(e){var c=this,d=0;for(d=0;d<c.medias.length;d++){if(e===c.medias[d].id){c.current_media=c.medias[d];c.current_index=d;break}}},setCurrentDocument:function(f){var c=this,e=0;for(e=0;e<c.documents.length;e++){if(f===c.documents[e].id){c.current_document=c.documents[e];c.current_document_index=e;break}}},showMedia:function(){var c=this;if(typeof c.current_media==="undefined"){return false}b(".bb-media-model-wrapper.media .bb-media-section").find("img").attr("src",c.current_media.attachment);var d=b(".bb-media-section .bb-media-privacy-wrap");if(d.length){d.show();d.find("ul.media-privacy li").removeClass("selected");d.find(".bp-tooltip").attr("data-bp-tooltip","");var e=d.find("ul.media-privacy").find("li[data-value="+c.current_media.privacy+"]");e.addClass("selected");d.find(".bp-tooltip").attr("data-bp-tooltip",e.text());d.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(c.current_media.privacy);if((typeof BP_Nouveau.activity!=="undefined"&&typeof c.current_media.activity_id!=="undefined"&&c.current_media.activity_id!=0)||c.group_id||c.current_media.is_forum||c.current_media.group_id||c.current_media.album_id||c.current_media.is_message||!c.can_manage_media||!c.current_media.can_edit){d.hide()}}c.navigationCommands()},showDocument:function(){var g=this;if(typeof g.current_document==="undefined"){return false}var c=g.current_document.target_text;var f=g.current_document.target_icon_class;var e=b(document).find(".document-theatre");var j=g.current_document.extension;var d=g.current_document.mirror_text;e.find(".bb-document-section").removeClass("bb-video-preview");if(b.inArray(g.current_document.extension,["css","txt","js","html","htm","csv"])!==-1){e.find(".bb-document-section .document-preview").html('<i class="bb-icon-loader animate-spin"></i>');e.find(".bb-document-section").removeClass("bb-media-no-preview");e.find(".bb-document-section .document-preview").html("");e.find(".bb-document-section .document-preview").html("<h3>"+c+'</h3><div class="document-text"><textarea class="document-text-file-data-hidden"></textarea></div>');e.find(".bb-document-section .document-preview .document-text").attr("data-extension",j);e.find(".bb-document-section .document-preview .document-text textarea").html(d.replace("n",""));setTimeout(function(){bp.Nouveau.Media.documentCodeMirror()},1000)}else{if(b.inArray(g.current_document.extension,BP_Nouveau.document.mp3_preview_extension.split(","))!==-1){e.find(".bb-document-section .document-preview").html('<i class="bb-icon-loader animate-spin"></i>');e.find(".bb-document-section").removeClass("bb-media-no-preview");e.find(".bb-document-section .document-preview").html("");e.find(".bb-document-section .document-preview").html('<div class="img-section"><h3>'+c+'</h3><div class="document-audio"><audio src="'+g.current_document.mp3+'" controls controlsList="nodownload"></audio></div></div>')}else{if(b.inArray("."+g.current_document.extension,BP_Nouveau.video.video_type.split(","))!==-1){e.find(".bb-document-section").addClass("bb-video-preview");e.find(".bb-document-section .document-preview").html('<i class="bb-icon-loader animate-spin"></i>');e.find(".bb-document-section").removeClass("bb-media-no-preview");e.find(".bb-document-section .document-preview").html("");if("mov"===g.current_document.extension||"m4v"===g.current_document.extension){e.find(".bb-document-section .document-preview").html('<video playsinline id="video-'+g.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+g.current_document.video+'" type="video/mp4" ></source></video><span class="video-loader"><i class="bb-icon-loader animate-spin"></i></span>')}else{e.find(".bb-document-section .document-preview").html('<video playsinline id="video-'+g.current_document.id+'" class="video-js video-loading" controls  data-setup=\'{"aspectRatio": "16:9", "fluid": true,"playbackRates": [0.5, 1, 1.5, 2] }\' ><source src="'+g.current_document.video+'" type="video/'+g.current_document.extension+'" ></source></video><span class="video-loader"><i class="bb-icon-loader animate-spin"></i></span>')}b(window).scroll()}else{if(g.current_document.full_preview){e.find(".bb-document-section").removeClass("bb-media-no-preview");e.find(".bb-document-section .document-preview").html("");e.find(".bb-document-section .document-preview").html("<h3>"+c+'</h3><div class="img-section"><div class="img-block-wrap"> <img src="'+g.current_document.full_preview+'" /></div></div>')}else{e.find(".bb-document-section").addClass("bb-media-no-preview");e.find(".bb-document-section .document-preview").html("");e.find(".bb-document-section .document-preview").html('<div class="img-section"> <i class="'+f+'"></i><p>'+c+"</p></div>")}}}}var h=b(".bb-document-section .bb-document-privacy-wrap");if(h.length){h.show();h.parent().show();h.find("ul.document-privacy li").removeClass("selected");h.find(".bp-tooltip").attr("data-bp-tooltip","");var i=h.find("ul.document-privacy").find("li[data-value="+g.current_document.privacy+"]");i.addClass("selected");h.find(".bp-tooltip").attr("data-bp-tooltip",i.text());h.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(g.current_document.privacy);if((typeof BP_Nouveau.activity!=="undefined"&&typeof g.current_document.activity_id!=="undefined"&&g.current_document.activity_id!=0)||g.group_id||g.current_document.is_forum||g.current_document.group_id||g.current_document.album_id||!g.can_manage_document||!g.current_document.can_edit||g.current_document.is_message){h.parent().hide()}}g.navigationDocumentCommands()},next:function(e){e.preventDefault();var c=this,d;c.resetRemoveActivityCommentsData();if(typeof c.medias[c.current_index+1]!=="undefined"){c.current_index=c.current_index+1;d=c.current_media.activity_id;c.current_media=c.medias[c.current_index];c.showMedia();c.getMediasDescription()}else{c.nextLink.hide()}},previous:function(e){e.preventDefault();var c=this,d;c.resetRemoveActivityCommentsData();if(typeof c.medias[c.current_index-1]!=="undefined"){c.current_index=c.current_index-1;d=c.current_media.activity_id;c.current_media=c.medias[c.current_index];c.showMedia();c.getMediasDescription()}else{c.previousLink.hide()}},nextDocument:function(e){e.preventDefault();var c=this,d;c.resetRemoveActivityCommentsData();if(typeof c.documents[c.current_document_index+1]!=="undefined"){c.current_document_index=c.current_document_index+1;d=c.current_document.activity_id;c.current_document=c.documents[c.current_document_index];c.showDocument();c.getDocumentsDescription()}else{c.nextDocumentLink.hide()}},previousDocument:function(e){e.preventDefault();var c=this,d;c.resetRemoveActivityCommentsData();if(typeof c.documents[c.current_document_index-1]!=="undefined"){c.current_document_index=c.current_document_index-1;d=c.current_document.activity_id;c.current_document=c.documents[c.current_document_index];c.showDocument();c.getDocumentsDescription()}else{c.previousDocumentLink.hide()}},navigationCommands:function(){var c=this;if(c.current_index==0&&c.current_index!=(c.medias.length-1)){c.previousLink.hide();c.nextLink.show()}else{if(c.current_index==0&&c.current_index==(c.medias.length-1)){c.previousLink.hide();c.nextLink.hide()}else{if(c.current_index==(c.medias.length-1)){c.previousLink.show();c.nextLink.hide()}else{c.previousLink.show();c.nextLink.show()}}}},navigationDocumentCommands:function(){var c=this;if(c.current_document_index==0&&c.current_document_index!=(c.documents.length-1)){c.previousDocumentLink.hide();c.nextDocumentLink.show()}else{if(c.current_document_index==0&&c.current_document_index==(c.documents.length-1)){c.previousDocumentLink.hide();c.nextDocumentLink.hide()}else{if(c.current_document_index==(c.documents.length-1)){c.previousDocumentLink.show();c.nextDocumentLink.hide()}else{c.previousDocumentLink.show();c.nextDocumentLink.show()}}}},getActivity:function(){var d=this;b(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>');if(typeof BP_Nouveau.activity!=="undefined"&&d.current_media&&typeof d.current_media.activity_id!=="undefined"&&d.current_media.activity_id!=0&&!d.current_media.is_forum){if(d.activity_ajax!=false){d.activity_ajax.abort()}var c=b('[data-bp-activity-id="'+d.current_media.activity_id+'"] .activity-comments');if(c.length){d.current_media.parent_activity_comments=true;c.html("")}d.activity_ajax=b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:d.current_media.activity_id,group_id:!_.isUndefined(d.current_media.group_id)?d.current_media.group_id:0,nonce:BP_Nouveau.nonces.media},success:function(e){if(e.success){b(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity);b(".bb-media-info-section:visible").show();jQuery(window).scroll();setTimeout(function(){bp.Nouveau.reportPopUp();bp.Nouveau.reportedPopup()},10)}}})}else{b(".bb-media-info-section.media").hide()}},getDocumentsActivity:function(){var d=this;b(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>');if(typeof BP_Nouveau.activity!=="undefined"&&d.current_document&&typeof d.current_document.activity_id!=="undefined"&&d.current_document.activity_id!=0&&!d.current_document.is_forum){if(d.activity_ajax!=false){d.activity_ajax.abort()}var c=b('[data-bp-activity-id="'+d.current_document.activity_id+'"] .activity-comments');if(c.length){d.current_document.parent_activity_comments=true;c.html("")}d.activity_ajax=b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_get_activity",id:d.current_document.activity_id,group_id:!_.isUndefined(d.current_document.group_id)?d.current_document.group_id:0,nonce:BP_Nouveau.nonces.media},success:function(e){if(e.success){b(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.activity);b(".bb-media-info-section:visible").show();jQuery(window).scroll();setTimeout(function(){bp.Nouveau.reportPopUp();bp.Nouveau.reportedPopup()},10)}}})}else{b(".bb-media-info-section.document").hide()}},getDocumentsDescription:function(){var d=this;b(".bb-media-info-section .activity-list").addClass("loading").html('<i class="bb-icon-loader animate-spin"></i>');if(d.activity_ajax!=false){d.activity_ajax.abort()}var c=b('[data-bp-activity-id="'+d.current_document.activity_id+'"] .activity-comments');if(c.length){d.current_document.parent_activity_comments=true;c.html("")}d.activity_ajax=b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_get_document_description",id:d.current_document.id,attachment_id:d.current_document.attachment_id,nonce:BP_Nouveau.nonces.media},success:function(e){if(e.success){b(".bb-media-info-section:visible .activity-list").removeClass("loading").html(e.data.description);b(".bb-media-info-section:visible").show();b(window).scroll();setTimeout(function(){bp.Nouveau.reportPopUp();bp.Nouveau.reportedPopup()},10)}else{b(".bb-media-info-section.document").hide()}}})},activityDeleted:function(e,f){var c=this,d=0;if(c.is_open_media&&typeof f!=="undefined"&&f.action==="delete_activity"&&c.current_media.activity_id==f.id){b(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+c.current_media.id+'"]').closest("li").remove();b(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+c.current_media.id+'"]').closest(".bb-activity-media-elem").remove();for(d=0;d<c.medias.length;d++){if(c.medias[d].activity_id==f.id){c.medias.splice(d,1);break}}if(c.current_index==0&&c.current_index!=(c.medias.length)){c.current_index=-1;c.next(e)}else{if(c.current_index==0&&c.current_index==(c.medias.length)){b(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+c.current_media.activity_id+'"]').remove();c.closeTheatre(e)}else{if(c.current_index==(c.medias.length)){c.previous(e)}else{c.current_index=-1;c.next(e)}}}}if(c.is_open_document&&typeof f!=="undefined"&&f.action==="delete_activity"&&c.current_document.activity_id==f.id){b(document).find('[data-bp-list="document"] .bb-open-document-theatre[data-id="'+c.current_document.id+'"]').closest('div.ac-document-list[data-activity-id="'+c.current_document.activity_id+'"]').remove();b(document).find('[data-bp-list="activity"] .bb-open-document-theatre[data-id="'+c.current_document.id+'"]').closest(".bb-activity-media-elem").remove();for(d=0;d<c.documents.length;d++){if(c.documents[d].activity_id==f.id){c.documents.splice(d,1);break}}if(c.current_document_index==0&&c.current_document_index!=(c.documents.length)){c.current_document_index=-1;c.nextDocument(e)}else{if(c.current_document_index==0&&c.current_document_index==(c.documents.length)){b(document).find('[data-bp-list="activity"] li.activity-item[data-bp-activity-id="'+c.current_document.activity_id+'"]').remove();c.closeDocumentTheatre(e)}else{if(c.current_document_index==(c.documents.length)){c.previousDocument(e)}else{c.current_document_index=-1;c.nextDocument(e)}}}}},togglePopupDropdown:function(d){var c;d=d||window.event;if(d.target){c=d.target}else{if(d.srcElement){c=d.srcElement}}if(c.nodeType===3){c=c.parentNode}if(d.altKey===true||d.metaKey===true){return d}if(b(c).hasClass("privacy-wrap")||b(c).parent().hasClass("privacy-wrap")){return d}b("ul.media-privacy").removeClass("bb-open");b("ul.document-privacy").removeClass("bb-open")},togglePrivacyDropdown:function(c){var d=b(c.target);c.preventDefault();d.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(f){var g=b(f.target),d=this,e=g.data("value"),c="public";f.preventDefault();if(g.hasClass("selected")){return false}g.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading");c=g.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value");g.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected");g.addClass("selected");b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_update_privacy",id:d.current_media.id,_wpnonce:BP_Nouveau.nonces.media,privacy:e,},success:function(){g.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(c);g.closest(".bb-media-privacy-wrap").find(".privacy").addClass(e);g.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",g.text())},error:function(){g.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})},openMediaActivityDescription:function(c){c.preventDefault();var d=b(c.currentTarget);if(d.parents(".activity-media-description").find(".bp-edit-media-activity-description").length<1){return false}d.parents(".activity-media-description").find(".bp-edit-media-activity-description").show().addClass("open");d.parents(".activity-media-description").find(".bp-media-activity-description").hide();d.hide()},closeMediaActivityDescription:function(d){d.preventDefault();var e=b(d.currentTarget);if(e.parents(".activity-media-description").length<1){return false}var c=e.parents(".activity-media-description").find("#add-activity-description").get(0).defaultValue;e.parents(".activity-media-description").find(".bp-add-media-activity-description").show();e.parents(".activity-media-description").find(".bp-media-activity-description").show();e.parents(".activity-media-description").find("#add-activity-description").val(c);e.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open")},submitMediaActivityDescription:function(e){e.preventDefault();var h=b(e.currentTarget),g=h.parents(".activity-media-description"),d=g.find("#add-activity-description").val(),c=g.find("#bp-attachment-id").val();var f={action:"media_description_save",description:d,attachment_id:c,_wpnonce:BP_Nouveau.nonces.media,};b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:f,async:false,success:function(i){if(i.success){h.parents(".activity-media-description").find(".bp-media-activity-description").html(i.data.description).show();h.parents(".activity-media-description").find(".bp-add-media-activity-description").show();g.find("#add-activity-description").val(i.data.description);g.find("#add-activity-description").get(0).defaultValue=i.data.description;if(i.data.description==""){h.parents(".activity-media-description").find(".bp-add-media-activity-description").removeClass("show-edit").addClass("show-add")}else{h.parents(".activity-media-description").find(".bp-add-media-activity-description").addClass("show-edit").removeClass("show-add")}h.parents(".activity-media-description").find(".bp-edit-media-activity-description").hide().removeClass("open");h.parents(".activity-media-description").find(".bp-media-activity-description").show();h.parents(".activity-media-description").find(".bp-feedback.error").remove()}else{h.parents(".activity-media-description").prepend(i.data.feedback)}}})},toggleDocumentPrivacyDropdown:function(c){var d=b(c.target);c.preventDefault();d.closest(".bb-document-privacy-wrap").find(".document-privacy").toggleClass("bb-open")},documentPrivacyChange:function(f){var g=b(f.target),d=this,e=g.data("value"),c="public";f.preventDefault();if(g.hasClass("selected")){return false}g.closest(".bb-document-privacy-wrap").find(".privacy").addClass("loading");c=g.closest(".bb-document-privacy-wrap").find("ul.document-privacy li.selected").data("value");g.closest(".bb-document-privacy-wrap").find("ul.document-privacy li").removeClass("selected");g.addClass("selected");b.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_save_privacy",item_id:d.current_document.id,_wpnonce:BP_Nouveau.nonces.media,value:e,type:"document",},success:function(){g.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading").removeClass(c);g.closest(".bb-document-privacy-wrap").find(".privacy").addClass(e);g.closest(".bb-document-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",g.text())},error:function(){g.closest(".bb-document-privacy-wrap").find(".privacy").removeClass("loading")}})},};bp.Nouveau.Media.start();bp.Nouveau.Media.Theatre.start()})(bp,jQuery);